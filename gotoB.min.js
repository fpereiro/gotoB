!function(){if("object"==typeof exports)t=exports;else var t=window.dale={};var e=function(t,e){var n=typeof t;return"object"!==n&&"number"!==n?n:t instanceof Array?"array":"number"===n?isNaN(t)?"nan":isFinite(t)?t%1==0?"integer":"float":"infinity":"array"===(n=Object.prototype.toString.call(t).replace("[object ","").replace("]","").toLowerCase())||"date"===n||"null"===n?n:"regexp"===n?"regex":e?n:"object"},n=function(t){return function(n,r,i,o){if("do"===t)var a=r,s=!0===i,u=[],c=0;else if("fil"===t)var a=i,s=!0===o,u=[],c=0;else if("obj"!==t)var a=i,s=!0===o;else if("object"===e(r))var a=i,s=!0===o,u=r;else var a=r,s=!0===i,u={};if("function"!==e(a))return console.log(("do"===t||"obj"===t&&"object"!==e(r)?"Second":"Third")+" argument passed to dale."+t+" must be a function but instead is",a,"with type",e(a)),!1;if(void 0===n)return u;var l=e(n);"array"===l||("object"===l?"[object Arguments]"===Object.prototype.toString.call(n)&&(l="array",n=[].slice.call(n)):(l="array",n=[n]));for(var f in n){if("array"===l)f=parseInt(f);else if(!s&&!Object.prototype.hasOwnProperty.call(n,f))continue;var d=a(n[f],f);if("do"===t)u[c++]=d;else if("fil"===t)d!==r&&(u[c++]=d);else if("stop"===t){if(d===r)return d;u=d}else if("stopNot"===t){if(d!==r)return d;u=d}else{if(void 0===d)continue;if("array"!==e(d))return void console.log("Value returned by fun must be an array but instead is of type "+e(d));u[d[0]]=d[1]}}return u}};t.do=n("do"),t.fil=n("fil"),t.obj=n("obj"),t.stop=n("stop"),t.stopNot=n("stopNot"),t.keys=function(e,n){return t.do(e,function(t,e){return e},n)},t.times=function(t,n,r){if(0===t)return[];{if(!("integer"!==e(t)||t<0)){if(void 0===n)n=1;else if("integer"!==e(n)&&"float"!==e(n))return void console.log("start must be an integer or float.");if(void 0===r)r=1;else if("integer"!==e(r)&&"float"!==e(r))return void console.log("step must be an integer or float.");for(var i=[n];i.length<t;)n+=r,i.push(n);return i}console.log("steps must be a positive integer or zero.")}},t.acc=function(n,r,i,o){var a=arguments.length===("boolean"===e(arguments[arguments.length-1])?4:3),s=a?r:void 0,u=a?i:r,c=a?o:i;if("function"!==e(u))return console.log("fun must be a function but instead is of type",e(u)),!1;var l=!0;return t.do(n,function(t,e){if(!a&&l)return l=!1,s=t;s=u(s,t)},c),s}}(),function(){var t="object"==typeof exports,e=t?require("dale"):window.dale;if(t)n=exports;else var n=window.teishi={};n.t=function(t,e){var n=typeof t;return"object"!==n&&"number"!==n?n:t instanceof Array?"array":"number"===n?isNaN(t)?"nan":isFinite(t)?t%1==0?"integer":"float":"infinity":"array"===(n=Object.prototype.toString.call(t).replace("[object ","").replace("]","").toLowerCase())||"date"===n||"null"===n?n:"regexp"===n?"regex":e?n:"object"},n.s=function(){try{return JSON.stringify.apply(JSON.stringify,arguments)}catch(t){return!1}},n.p=function(){try{return JSON.parse.apply(JSON.parse,arguments)}catch(t){return!1}},n.simple=function(t){var e=n.t(t);return"array"!==e&&"object"!==e},n.complex=function(t){return!n.simple(t)},n.c=function(t,r,i){if(n.simple(t))return t;r=r||["$root"],i=i||[r,t];var o=n.t(t,!0),a="array"===o||"arguments"===o?[]:{};return e.do(t,function(t,o){if(n.simple(t))return a[o]=t;var s=e.stopNot(i,void 0,function(e,n){if(n%2!=0&&t===e)return i[n-1]});if(!s)return i.push(r.concat([o]))&&i.push(t),a[o]=n.c(t,r.concat([o]),i.concat());a[o]="CIRCULAR REFERENCE: "+s.join(".")}),a},n.time=function(){return(new Date).getTime()};var r,i=n.time(),o={end:function(){return t?"[0m":""},bold:function(){return t?"[1m":""},white:function(){return t?"[37m":""},color:function(e){if(!t)return"";for(var n=r;r===n;)n=Math.round(5*Math.random()+1);return r=n,"["+(e?"4":"3")+n+"m"}};n.l=function(){var t=o.bold();return function r(i,a){var s=n.t(i),a=a||0,u=!0;"object"===s&&"[object Arguments]"===Object.prototype.toString.call(i)&&(s="array");var c=a<2?"":"\n"+e.do(e.times(a-1),function(t){return"   "}).join("");a>0&&(t+="array"===s?o.white()+"[":o.white()+"{"),e.do(i,function(e,i){var l=n.t(e);if(0===a&&0===i&&("string"===l||"integer"===l))return u=!1,t+=o.color(!0)+e+":"+o.end()+o.bold();if(u||(t+=o.white()+(0===a?" ":", ")),u=!1,"string"===l&&a>0&&(e="'"+e+"'"),"function"===l){var f=(e+="").match(/\s+(?=}$)/);null!==f&&(e=e.replace(new RegExp(f[0],"g"),"\n")),e.length>150&&(e=e.slice(0,150)+"...\n"),a>1&&(e=e.replace(/\n/g,"array"===s?c:"\n"+(i+": ").replace(/./g," ")+c.slice(1)))}t+=o.color(),"object"===s&&(t+=c+(i.match(/^[0-9a-zA-Z_]+$/)?i:"'"+i+"'")+": "),"array"===l||"object"===l?r(e,a+1):t+="object"===s?e:c+e}),a>0&&("array"===s&&(t+=(a>1?"\n":"")+c.slice(4)+o.white()+"]"),"object"===s&&(t+=(a>1?"\n":"")+c.slice(4)+o.white()+"}"))}(n.c(arguments)),console.log("("+(n.time()-i)+"ms)",t+o.end()),!1},n.lno=function(){t=!1},n.makeTest=function(t,r){return"function"!==n.t(t)?n.l("teishi.makeTest","fun passed to teishi.makeTest should be a function but instead is",t,"with type",n.t(t)):("string"===n.t(r)&&(r=[r]),"array"!==n.t(r)?n.l("teishi.makeTest","clauses argument passed to teishi.makeTest should be an array but instead is",r,"with type",n.t(r)):"string"!==n.t(r[0])?n.l("teishi.makeTest","shouldClause passed to teishi.makeTest should be a string but instead is",r[0],"with type",n.t(r[0])):void 0===r[1]||("array"!==n.t(r[1])&&(r[1]=[r[1]]),!0===e.stopNot(r[1],!0,function(t){var e=n.t(t);return"string"===e||"function"===e||n.l("teishi.makeTest","Each finalClause passed to teishi.makeTest should be a string or a function but instead is",t,"with type",e)}))?function(i,o,a,s,u,c){var l=t(a,s);if(!0===l)return!0;if("array"===n.t(l))return l;var f=[],d=0;return void 0!==u&&(f[d++]="each of the"),o[0]&&(f[d++]=o[0]),i&&(f[d++]="passed to",f[d++]=i),f[d++]=r[0],void 0!==c&&(f[d++]="one of"),f[d++]=void 0!==c?c:s,o[1]&&(f[d++]="("+o[1]+")"),f[d++]=void 0!==u?"but one of":"but instead",void 0!==u&&(f[d++]=u),f[d++]="is",f[d++]=a,e.do(r[1],function(t){f[d++]="function"!=typeof t?t:t(a,s)}),f}:void 0)},n.test={type:n.makeTest(function(t,e){return n.t(t)===e},["should have as type",["with type",n.t]]),equal:n.makeTest(function(t,r){return function t(r,i){return n.simple(r)&&n.simple(i)?r===i:n.t(r,!0)===n.t(i,!0)&&(n.s(e.keys(r).sort())===n.s(e.keys(i).sort())&&!1!==e.stop(r,!1,function(e,n){return t(e,i[n])}))}(t,r)},"should be equal to"),notEqual:n.makeTest(function(t,r){return!function t(r,i){return n.simple(r)&&n.simple(i)?r===i:n.t(r,!0)===n.t(i,!0)&&(n.s(e.keys(r).sort())===n.s(e.keys(i).sort())&&!1!==e.stop(r,!1,function(e,n){return t(e,i[n])}))}(t,r)},"should not be equal to"),range:n.makeTest(function(t,r){return"object"!==n.t(r,!0)?["Range options object must be an object but instead is",r,"with type",n.t(r,!0)]:"{}"===n.s(r)||e.stopNot(r,!0,function(e,n){return"min"!==n&&"max"!==n&&"less"!==n&&"more"!==n?['Range options must be one of "min", "max", "less" and "more", but instead is',n]:"min"===n?t>=e:"max"===n?t<=e:"less"===n?t<e:t>e})},"should be in range"),match:n.makeTest(function(t,e){return"string"!==n.t(t)?["Invalid comparison string passed to teishi.test.match. Comparison string must be of type string but instead is",t,"with type",n.t(t)]:"regex"!==n.t(e)?["Invalid regex passed to teishi.test.match. Regex must be of type regex but instead is",e,"with type",n.t(e)]:null!==t.match(e)},"should match")},n.validateRule=function(t){var r=n.t(t);if("function"===r||"boolean"===r)return!0;if("array"!==r)return["each teishi rule must be an array or boolean or function but instead is",t,"with type",r];var i=n.t(t[0]);if("string"!==i&&("array"!==i||2!==t[0].length||"string"!==n.t(t[0][0])||"string"!==n.t(t[0][1])))return!0;if(3===t.length)return!0;if(t.length<3||t.length>5)return["Each teishi simple rule must be an array of length between 3 and 5, but instead is",t,"and has length",t.length];var o,a;return e.stopNot(t,!0,function(e,r){if(r<3)return!0;var i=n.t(e);if("string"===i){if("oneOf"!==e&&"each"!==e&&"eachOf"!==e)return["Invalid multi parameter",e,". Valid multi parameters are",["oneOf","each","eachOf"]];if(a)return["You can pass only one multi parameter to a teishi simple rule but instead you passed two:",t[3],"and",t[4]];a=e}else{if("function"!==i)return["Elements #4 and #5 of a teishi simple rule must be either a string or a function, but element","#"+(r+1),"is",e,"and has type",i];if(o)return["You can pass only one test function to a teishi simple rule but instead you passed two:",t[3],"and",t[4]];o=e}return!0})};var a=function(t,r){return void 0===r?n.l.apply(n.l,["teishi.v"].concat(t)):(t=e.do(t,function(t){return n.complex(t)?n.s(t):t+""}).join(" "),!0===r?t:(r(t),!1))};n.v=function(t,r,i){if("string"===n.t(t))var o=t,s=r,u=i;else var o="",s=t,u=r;if(void 0!==u&&!0!==u&&"function"!==n.t(u))return n.l("teishi.v","Invalid apres argument. Must be either undefined, true, or a function.");var c=n.validateRule(s);if(!0!==c)return a(c,u);var l=n.t(s);if("boolean"===l)return s;if("function"===l)return n.v(o,s(),u);if(0===s.length)return!0;var f=n.t(s[0]);if("boolean"===f&&2===s.length&&"array"===n.t(s[1]))return!1===s[0]||n.v(o,s[1],u);if("string"!==f&&("array"!==f||2!==s[0].length||"string"!==n.t(s[0][0])||"string"!==n.t(s[0][1])))return e.stopNot(s,!0,function(t){return n.v(o,t,u)});var d,p=n.t(s[3]),h=n.t(s[4]),g="function"===p?s[3]:"function"===h?s[4]:n.test.type,v="string"===p?s[3]:"string"===h?s[4]:void 0,m="array"===f?s[0]:[s[0]],b=n.t(s[1],!0),y=n.t(s[2],!0);return("each"===v||"eachOf"===v)&&("array"===b&&0===s[1].length||"object"===b&&0===Object.keys(s[1]).length||void 0===s[1])||(!0===(d="oneOf"!==v&&"eachOf"!==v||!("array"===y&&0===s[2].length||"object"===y&&0===Object.keys(s[2]).length||void 0===s[2])?void 0===v?g(o,m,s[1],s[2]):"each"===v?e.stopNot(s[1],!0,function(t){return g(o,m,t,s[2],s[1])}):"oneOf"===v?e.stop(s[2],!0,function(t){return g(o,m,s[1],t,void 0,s[2])}):e.stopNot(s[1],!0,function(t){return e.stop(s[2],!0,function(e){return g(o,m,t,e,s[1],s[2])})}):["To field of teishi rule is",s.to,"but multi attribute",v,"requires it to be non-empty, at teishi step",s])||a(d,u))},n.stop=function(){return!0!==n.v.apply(n.v,arguments)}}(),function(){var t="object"==typeof exports,e=t?require("dale"):window.dale,n=t?require("teishi"):window.teishi;if(t)r=exports;else var r=window.lith={};var i=n.t,o=n.l;r.k={lithbagElements:["string","integer","float","array","undefined"],tags:["!DOCTYPE HTML","LITERAL","a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","command","datalist","dd","del","details","dfn","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"],voidTags:["!DOCTYPE HTML","area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]},r.entityify=function(t){return!n.stop("lith.entityify",["Entityified string",t,"string"])&&t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/`/g,"&#96;")},r.v=function(t){var a=i(t);if("array"===a&&"string"===i(t[0])&&-1!==r.k.tags.indexOf(t[0])){var s="object"===i(t[1])?t[1]:void 0,u=t[s?2:1];return!!n.v([["lith length",t.length,{min:1,max:3},n.test.range],[void 0===s,["length of lith without attributes",t.length,{max:2},n.test.range]],[["lith attribute keys","start with an ASCII letter, underscore or colon, and be followed by letters, digits, underscores, colons, periods, dashes, extended ASCII characters, or any non-ASCII characters."],e.keys(s),/^[a-zA-Z_:][a-zA-Z_:0-9.\-\u0080-\uffff]*$/,"each",n.test.match],["lith attribute values",s,["string","integer","float","undefined","null","boolean"],"eachOf"],["lith contents",u,r.k.lithbagElements,"oneOf"]],function(e){o("lith.v - Invalid lith",{error:e,"original input":t})})&&"Lith"}return!!n.v([["lithbag",a,r.k.lithbagElements,"oneOf",n.test.equal],["array"===a,["lithbag elements",t,r.k.lithbagElements,"eachOf"]]],function(e){o("lith.v - Invalid lithbag",{error:e,"original input":t})})&&"Lithbag"},r.g=function(t,e){if(e||r.prod)return!0!==(e||r.prod)?o("lith.g","prod or lith.prod must be true or undefined."):"array"===i(t)&&-1!==r.k.tags.indexOf(t[0])?r.generateLith(t,!0):r.generateLithbag(t,!1,!0);var n=r.v(t);return!!n&&r["generate"+n](t)},r.generateLithbag=function(t,n,o){var a="";return!1!==e.stop(t,!1,function(t){if(void 0!==t){i(t);if("array"!==i(t))return a+=n?t:r.entityify(t+"");if(o)a+=r.g(t,o);else{var e=r.g(t,o);if(!1===e)return!1;a+=e}}})&&a},r.generateLith=function(t,n){var o="object"===i(t[1])?t[1]:void 0,a=t[o?2:1];if("LITERAL"===t[0])return a;var s="<"+t[0];if(e.do(o,function(t,e){(t||0===t)&&(s+=" "+r.entityify(e+"")+'="'+r.entityify(t+"")+'"')}),s+=">","array"===i(a))if(n)s+=r.g(a,n);else{var u=r.g(a);if(!1===u)return!1;s+=u}else s+=r.generateLithbag(a,"style"===t[0]||"script"===t[0],n);return-1===r.k.voidTags.indexOf(t[0])&&(s+="</"+t[0]+">"),s},r.css={},r.css.v=function(t){if(n.stop(["litc or litcbag",t,"array"],function(e){o("lith.css.v - Invalid litc or litcbag",{error:e,"original input":t})}))return!1;if(0===t.length||"array"===i(t[0]))return!0;var e="object"===i(t[1])?t[1]:void 0,a=t[e?2:1];return n.v([["litc length",t.length,{min:1,max:3},n.test.range],[void 0===e,["length of litc without attributes",t.length,{max:2},n.test.range]],["litc selector",t[0],"string"],r.css.vAttributes(e),["LITERAL"!==t[0],["litc contents",a,["undefined","array"],"oneOf"]]],function(e){o("lith.css.v - Invalid litc",{error:e,"original input":t})})},r.css.vAttributes=function(t){return n.v([["litc attribute values",t,["string","integer","float","object","undefined","null","boolean"],"eachOf"]])},r.css.g=function(t,n){if(!1===r.css.v(t))return!1;if(0===t.length)return"";var o="";if("LITERAL"===t[0])return t[1];if("array"===i(t[0]))return!1!==e.stop(t,!1,function(t,e){var i=r.css.g(t,n);if(!1===i)return!1;o+=i})&&o;void 0===n&&(n="");var a="object"===i(t[1])?t[1]:void 0,s=t[a?2:1];n=e.do(n.split(/,\s*/),function(n){return e.do(t[0].split(/,\s*/),function(t){return t.match(/&/)?t.replace("&",n):n+(0===n.length?"":" ")+t}).join(", ")}).join(", "),o+=n+"{";var u=function(t){return!1!==r.css.vAttributes(t)&&e.stop(t,!1,function(t,n){if(t||0===t){var r=i(t);if("object"===r)return u(t);"integer"===r&&(t<0||t>1)&&(t+="px"),"float"!==r&&1!==t||(t=100*t+"%"),e.do(n.split(/,\s*/),function(e){o+=e+":"+t+";"})}})};if(!1===u(a))return!1;if(o+="}",s){var c=r.css.g(s,n);if(!1===c)return!1;o+=c}return o},r.css.media=function(t,e){return!n.stop(["selector",t,"string"])&&[["LITERAL","@media "+t+" {"],e,["LITERAL","}"]]}}(),function(){var t="object"==typeof exports,e=t?require("dale"):window.dale,n=t?require("teishi"):window.teishi,r=n.t,i=n.l,o=function(t){if(!n.stop([["store",t,["array","object","undefined"],"oneOf"]])){var o={};return o.routes={},o.store=t||{},o.isPath=function(t,e){return n.v(e,[["path",t,["array","integer","string"],"oneOf"],["path",t,["integer","string"],"eachOf"]])},o.do=function(t,e){return n.simple(e)&&(e=[e]),!n.stop("r.do",[["verb",t,"string"],o.isPath(e,"r.do")])&&(o.mill.apply(null,arguments),!0)},o.listen=function(){var t,r=arguments[arguments.length-1];if(arguments.length<2)return i("r.listen","Too few arguments passed to r.listen");if(2===arguments.length?t=arguments[0]:((t=3===arguments.length?{}:arguments[2]).verb=arguments[0],t.path=arguments[1]),n.simple(t.path)&&(t.path=[t.path]),n.stop("r.listen",[["options",t,"object"],["keys of options",e.keys(t),["verb","path","id","parent","priority","burn"],"eachOf",n.test.equal],function(){return[["options.verb",t.verb,"string"],o.isPath(t.path,"r.listen"),["options.id",t.id,["string","integer","undefined"],"oneOf"],["options.parent",t.parent,["string","integer","undefined"],"oneOf"],["options.priority",t.priority,["undefined","integer"],"oneOf"],["options.burn",t.burn,["undefined","boolean"],"oneOf"]]},["route function",r,"function"]]))return!1;if(t.id){if(o.routes[t.id])return i("r.listen","A route with id",t.id,"already exists.")}else t.id=o.random();return t.rfun=r,o.routes[t.id]=t,t.id},o.forget=function(t,n){if(!o.routes[t])return i("Route",t,"does not exist.");n&&"function"===r(n)&&n(o.routes[t]),delete o.routes[t],e.do(o.routes,function(e,r){e.parent===t&&o.forget(r,n)})},o.mill=function(t,e){var n=[{verb:arguments[0],path:arguments[1]}].concat([].slice.call(arguments,2)),i=function(t){if(0!==t.length){n[0].cb=function(){i(t)};var e=t.shift();if(!o.routes[e.id])return i(t);e.burn&&o.forget(e.id),"function"!==r(e.rfun.apply(null,n))&&i(t)}};i(o.sort(o.match(t,e,o.routes)))},o.match=function(t,n,r){var i=[];return e.do(r,function(r){if(!("*"!==t&&"*"!==r.verb&&r.verb!==t||r.path.length>n.length))return 0===r.path.length?i.push(r):void e.stop(r.path,!1,function(t,e){return(void 0===n[e]||"*"===n[e]||"*"===t||n[e]===t)&&(e===r.path.length-1?(i.push(r),!1):void 0)})}),i},o.sort=function(t){return t.sort(function(t,e){var n=t.priority||0;return(e.priority||0)-n})},o.random=function(){return Math.random().toString(16).slice(2)},o}};t?module.exports=o:window.R=o}(),function(){if("object"==typeof exports)return console.log("cocholate only works in a browser!");var t=window.dale,e=window.teishi,n=e.t,r=window.c=function(i,o){if(e.stop("c",["fun",o,["function","undefined"],"oneOf"]))return!1;var a=r.find(i);if(!1===a)return!1;if(o){var s=e.c(arguments).slice(2);a=t.do(a,function(t){return o.apply(void 0,[t].concat(s))})}return"string"===n(i)&&i.match(/^[a-z]*#[^\s\[>,:]+$/)?a[0]:a};r.nodeListToArray=function(t){return[].slice.call(t)},r.setop=function(e,n,i){if("and"===e)return t.fil(n,void 0,function(t){return-1!==i.indexOf(t)?t:void 0});var o=n.slice();return"or"===e?t.do(i,function(t){-1===o.indexOf(i)&&o.push(t)}):(0===o.length&&(o=r.nodeListToArray(document.getElementsByTagName("*"))),t.do(i,function(t){var e=o.indexOf(t);-1!==e&&o.splice(e,1)})),o},r.find=function(i){var o=n(i);if(e.stop("cocholate",[["selector",i,["array","string","object"],"oneOf"],function(){return[["array"===o,["first element of array selector",i[0],[":and",":or",":not"],"oneOf",e.test.equal]],["object"===o,[["selector keys",t.keys(i),["selector","from"],"eachOf",e.test.equal],["valid HTML node",i.from,"undefined",e.test.notEqual],function(){return[["from.querySelectorAll","valid HTML node"],i.from.querySelectorAll,"function"]}]]]}]))return!1;if("string"===o)return r.nodeListToArray(document.querySelectorAll(i));if("object"===o)return r.nodeListToArray(i.from.querySelectorAll(i.selector));var a=i.shift(),s=[];return t.stop(i,!1,function(t,e){var n=r.find(t);if(!1===n)return s=!1;s=0===e&&":not"!==a?n:r.setop(a.replace(":",""),s,n)}),s},r.empty=function(e){r(e,function(e){t.do(r.nodeListToArray(e.getElementsByTagName("*")),function(t){t.remove()})})},r.fill=function(t,n){if(e.stop("c.fill",["html",n,"string"]))return!1;r.empty(t),r(t,function(t){t.innerHTML=n})},r.place=function(t,n,i){if(e.stop("c.place",[["where",n,["beforeBegin","afterBegin","beforeEnd","afterEnd"],"oneOf",e.test.equal],["html",i,"string"]]))return!1;r(t,function(t){t.insertAdjacentHTML(n,i)})},r.get=function(n,i,o){return!e.stop("c.get",["attributes",i,["string","array"],"oneOf"])&&r(n,function(e){return t.obj(i,function(t){return o?[t,e.style[t]||null]:[t,e.getAttribute(t)]})})},r.set=function(n,i,o,a){if(e.stop("c.set",[["attributes",i,"object"],[["attribute keys","start with an ASCII letter, underscore or colon, and be followed by letters, digits, underscores, colons, periods, dashes, extended ASCII characters, or any non-ASCII characters."],t.keys(i),/^[a-zA-Z_:][a-zA-Z_:0-9.\-\u0080-\uffff]*$/,"each",e.test.match],["attribute values",i,["integer","string","null"],"eachOf"]]))return!1;r(n,function(e){t.do(i,function(t,n){o?e.style[n]=null===t?"":t:null===t?e.removeAttribute(n):e.setAttribute(n,t)}),e.onchange&&!a&&e.onchange()})},r.ready=function(t){if(document.addEventListener)return document.addEventListener("DOMContentLoaded",t);document.attachEvent?document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&t()}):t()},r.cookie=function(e){return!1===e?t.do(document.cookie.split(";s+"),function(t){return document.cookie=t.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()),t}):t.obj((e||document.cookie).split(/;\s*/),function(t){if(""!==t)return[(t=t.split("="))[0],t.slice(1).join("=")]})},r.ajax=function(n,r,i,o,a){if(n=n||"GET",o=o||"",i=i||{},a=a||function(){},e.stop("c.ajax",[["method",n,"string"],["path",r,"string"],["headers",i,"object"],["callback",a,"function"]]))return!1;var s=new XMLHttpRequest;return s.open(n.toUpperCase(),r,!0),e.complex(o)&&"formdata"!==e.t(o,!0)&&(i["content-type"]=i["content-type"]||"application/json",o=e.s(o)),t.do(i,function(t,e){s.setRequestHeader(e,t)}),s.onreadystatechange=function(){if(4===s.readyState){if(200!==s.status)return a(s);var n,r={xhr:s,headers:t.obj(s.getAllResponseHeaders().split("\r\n"),function(t){return(t=t.split(/:\s+/))[0].match(/^content-type/i)&&t[1].match("application/json")&&(n=!0),t})};r.body=n?e.p(s.responseText):s.responseText,a(null,r)}},s.send(o),{headers:i,body:o,xhr:s}},r.polyfill=function(){var e=function(){return document.createElement("_")};e().insertAdjacentHTML||(HTMLElement.prototype.insertAdjacentHTML=function(t,n){var r,i,o,a=this,s=e(),u=a.parentNode;if(s.innerHTML=n,"beforeBegin"===t)for(;r=s.firstChild;)u.insertBefore(r,a);else if("afterBegin"===t)for(i=a.firstChild;r=s.lastChild;)a.insertBefore(r,i);else if("beforeEnd"===t)for(;r=s.firstChild;)a.appendChild(r);else for(o=a.nextSibling;r=s.lastChild;)u.insertBefore(r,o)}),Element.prototype.remove||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,n){var r=t.stopNot(n?this.slice(n):this,void 0,function(t,n){if(e===t)return n});return void 0===r?-1:r})},r.polyfill()}(),function(){if("object"==typeof exports)return console.log("gotoB only works in a browser!");var t=window.dale,e=window.teishi,n=window.lith,r=(window.R,window.c),i=window.B,o=e.t,a=e.l,s=window.R();(i=window.B={v:"1.1.0",B:"в",r:s,routes:s.routes,store:s.store,do:s.do,listen:s.listen,forget:s.forget}).debug=[],i.listen({id:"debug",verb:"*",path:[]},function(t){var e={verb:t.verb,path:t.path};arguments.length>1&&(e.args=[].slice.call(arguments,1)),i.debug.unshift(e),i.verbose&&a("B.debug event #"+i.debug.length,e)}),i.add=function(e){if(!i.prod&&!s.isPath(e,"B.add"))return!1;void 0===i.get(e)&&i.set(e,[]);var n=i.get(e);return"array"!==o(n)?a("B.add","Cannot add to something that is not an array."):(t.do(arguments,function(t,e){0!==e&&n.push(t)}),!0)},i.rem=function(n){if(!i.prod&&!s.isPath(n,"B.rem"))return!1;var r=i.get(n),a=o(r),u="array"===o(arguments[1])?arguments[1]:t.do(arguments,function(t){return t}).slice(1);return!(!i.prod&&e.stop([["target",r,["array","object"],"oneOf"],"array"===a?["keys of array target",u,"integer","each"]:["keys of object target",u,"string","each"]]))&&("array"===a?(u.sort(function(t,e){return e-t}),t.do(u,function(t){r.splice(t,1)})):t.do(u,function(t){delete r[t]}),!0)},i.get=function(n){if(n="array"===o(n)?n:t.do(arguments,function(t){return t}),i.prod||s.isPath(n,"B.get")){var r=i.store;return!1===t.stop(n,!1,function(t,i){if(i+1<n.length&&e.simple(r[t]))return!1;r=r[t]})?void 0:r}},i.set=function(e,n,r){if(!i.prod&&!s.isPath(e,"B.set"))return!1;var u=i.store;return"array"!==o(e)&&(e=[e]),!t.stop(e,!0,function(t,i){if(i+1!==e.length){var s="string"===o(e[i+1])?"object":"array";if(o(u[t])!==s){if(void 0!==u[t]&&!r)return a("B.set didn't overwrite a parent because of type mismatch. Pass a truthy third argument to force this behavior. Path",e),!0;u[t]="object"===s?{}:[]}u=u[t]}else u[t]=n})},i.eq=function(n,r){return e.simple(n)&&e.simple(r)?n===r:e.t(n,!0)===e.t(r,!0)&&(e.s(t.keys(n).sort())===e.s(t.keys(r).sort())&&!1!==t.stop(n,!1,function(t,e){return i.eq(t,r[e])}))},t.do(["add","rem","set"],function(e){i.listen({id:e,verb:e,path:[]},function(e,n){if("set"===e.verb)var r=i.get(e.path);if(!0===i[e.verb].apply(null,[e.path].concat([].slice.call(arguments,1)))){if("add"===e.verb||"rem"===e.verb){i.do("change",e.path);var a=[].slice.call(arguments,1);"add"===e.verb&&t.do(t.times(a.length,i.get(e.path).length-a.length),function(t){i.do("change",e.path.concat(t))}),"rem"===e.verb&&("array"===o(a[0])&&(a=a[0]),t.do(a,function(t){i.do("change",e.path.concat(t))}))}"set"!==e.verb||i.eq(r,n)||i.do("change",e.path)}})}),i.str=function(n){var r=o(n);if(e.simple(n))return"string"===r?JSON.stringify(n):n+"";var a="array"===r?"[":"{";return a+="array"===r?t.do(n,i.str).join(", "):t.do(n,function(t,e){return JSON.stringify(e)+": "+i.str(t)}).join(", "),a+="array"===r?"]":"}"},i.ev=function(n,r){if("array"===o(r)&&"string"===o(r[0])&&(r=[r]),!i.prod&&e.stop("B.ev",[["attrs",n,"object"],["evs",r,"array"],["evs",r,"array","each"],function(){return t.do(r,function(t){return[["ev.ev",t[0],"string"],["ev.verb",t[1],"string"],s.isPath(t[2],"B.ev")]})}]))return!1;var a={};return t.do(r,function(e){t.do(e[0].split(/,\s/),function(t){a[t]?a[t].push(e):a[t]=[e]})}),t.obj(a,n,function(e,n){var r="";return t.do(e,function(e){var n=[JSON.stringify(e[1]),JSON.stringify(e[2])];e.length<4&&(e[3]={rawArgs:"this.value"}),t.do(e.slice(3),function(e){if("object"===o(e)){var r=t.keys(e);-1===r.indexOf("args")&&-1===r.indexOf("rawArgs")?n=n.concat(i.str(e)):(-1!==r.indexOf("args")&&("object"!==o(e.args)&&void 0!==e.args||(e.args=[e.args]),n=n.concat(t.do(e.args,i.str))),-1!==r.indexOf("rawArgs")&&(n=n.concat(e.rawArgs)))}else n=n.concat(i.str(e))}),r+="B.do ("+n.join(", ")+");"}),[n,r]})},i.view=function(r){var u=2===arguments.length?{}:arguments[1],c=arguments[2===arguments.length?1:2];if(!i.prod&&e.stop("B.view",[s.isPath(r,"B.view"),["params",u,["object","undefined"],"oneOf"],["rfun",c,"function"],function(){return[["params.tag",u.tag,[void 0].concat(n.k.tags),"oneOf",e.test.equal],["params.attrs",u.attrs,["object","undefined"],"oneOf"],["params.listen",u.listen,["array","undefined"],"oneOf"],["params.ondraw",u.ondraw,["function","undefined"],"oneOf"],["params.onforget",u.onforget,["function","undefined"],"oneOf"],function(){return[void 0!==u.attrs,["params.attrs.id",(u.attrs||{}).id,"undefined"]]}]}]))return!1;u.attrs=u.attrs||{};var l=u.attrs.id="в"+i.count++;u.attrs["path-в"]=r.join?r.join(":"):r,u.listen&&0!==u.listen.length&&"array"!==o(u.listen[0])&&(u.listen=[u.listen]);var f=[];if(!1===t.stop(u.listen,!1,function(e,n){if(t.stopNot(e,void 0,function(t){if("object"===o(t)&&t.id)return t.id}))return a("B.view","Cannot pass `id` property in args to listener.");var s=i.listen.apply(null,e);if(!i.prod&&!1===s)return a("B.view","There was an error creating event listener #"+(n+1)+" on view with path: ",r),t.do(f,function(t){i.forget(t)}),!1;f.push(s),i.routes[s].parent||(i.routes[s].parent=l)}))return!1;var d=function(t,r){var o=c(t,r),a=n.g(o,i.prod);return i.prod||!1!==a||(o=["pre",["Invalid lith: ",e.simple(o)?o.toString():JSON.stringify(o,null,"   ")]],a=n.g(o,i.prod)),[o,a]};i.listen("change",r,{id:l,priority:-1},function(t){var e=d(t,i.get(r));i.resolve(l,e)});var p=d({verb:"change",path:r},i.get(r));return u.ondraw&&(i.routes[l].ondraw=u.ondraw),u.onforget&&(i.routes[l].onforget=u.onforget),i.routes[l].view=p[0],t.do(i.getChildren(p[1]),function(t){i.routes[t].priority--,i.routes[t].parent||(i.routes[t].parent=l)}),[u.tag||"div",u.attrs,["LITERAL",p[1]]]},i.mount=function(e,s){return!i.prod&&"string"!==o(e)||!e.match(/^(body|#[^\s]+)$/)?a("B.mount","target must be either 'body' or an id selector, but instead is "+e):i.prod||void 0!==r(e)?(s=n.g(s,i.prod),i.prod||!1!==s?(r.place(e,"afterBegin",s),void t.do(i.getChildren(s),function(t){i.routes[t]&&i.routes[t].ondraw&&i.routes[t].ondraw(t)})):a("B.mount","received invalid view.")):a("B.mount","target not found.")},i.unmount=function(e){if(!i.prod&&"string"!==o(e)||!e.match(/^(body|#[^\s]+)$/))return a("B.unmount","target must be either 'body' or an id selector, but instead is "+e);if(e="body"===e?r(e)[0]:r(e),!i.prod&&!e)return a("B.unmount","target not found.");var n=function(t){t.onforget&&t.onforget(t.id)},s=i.getChildren(e.innerHTML);t.do(s,function(t){i.routes[t]&&i.forget(t,n)}),t.do(s,function(t){var e=document.getElementById(t);e&&e.remove()})},i.getChildren=function(e){var n=(e||"").match(/id="в[0-9a-f]+/g)||[];return t.do(n,function(t){return t.slice(4)})},i.count=1,i.trample=200,i.resolvequeue=[],i.resolving=!1,i.resolve=function(n,s,u){if(i.resolving&&!u)return i.resolvequeue.push([n,s]);i.resolving=!0;var c=function(){var e,n=t.stopNot(i.resolvequeue,void 0,function(t,e){if(i.routes[t[0]])return e});if(void 0!==n)return e=i.resolvequeue[n],i.resolvequeue.splice(0,n+1),i.resolve.apply(null,e.concat(!0));i.resolving=!1},l=i.routes[n],f=document.getElementById(n);if(!f)return a("B.resolve","Attempted to redraw dangling view, omitting redraw & deleting route.",{route:{id:n,path:i.routes[n].path},view:s[0]}),i.forget(n,i.routes[n].onforget),c();var d=i.diff(i.prediff(l.view),i.prediff(s[0])),p=function(t){t.onforget&&t.onforget(t.id)};if(t.do(i.routes,function(t){t.parent===n&&t.id.match(/^в[0-9a-f]+$/)&&i.forget(t.id,p)}),!1===d)i.prod||a("diff took too long, trampling instead!",l.id),r("#"+n).innerHTML=s[1];else{var h=function(t,e,n){var r=g(e,"insert1",n);r?r.parentNode.insertBefore(t,r):g(e.slice(0,e.length-1),"insert2",n).appendChild(t)},g=function(r,i,o){var u=f;return t.do(r,function(c,p){if(!u)throw a("BOOM! YOU FOUND A BUG IN gotoB! Please open a pull request at http://github.com/fpereiro/gotoB/issues and paste the text below:\n",JSON.stringify({debug:i,debugpos:o,diffitem:d[o].slice(0,2).join(" "),id:n,where:r,k:p,innerHTML:f.innerHTML,expectedHTML:s[1],oldView:l.view,newView:s[0],diff:t.obj(e.c(d),function(t,e){return[e,t]})})),new Error("gotoB redraw error!");u=u.childNodes[c]}),u},v=[0],m=[0],b={add:{tag:null,index:null},rem:{tag:null,index:null}};t.do(d,function(t,n){if(!t[1].match(/^<</))if(t[1].match(/^>/)||(d[n][2]={el:g(v,"sequence",n),old:e.c(v),New:e.c(m)}),t[1].match(/^</)){d[n][2].active=d[n][2].el===document.activeElement;var r=t[1].match(/[^\s]+/g)[0],i=t[1].match(/<.+ {.*"opaque":true.*}/);"add"!==t[0]||i||(b.rem.tag===r?(d[n][2].match=b.rem.index,d[b.rem.index][2].match=n,b.rem.tag=b.rem.index=null):(b.add.tag=r,b.add.index=n)),"rem"!==t[0]||i||(b.add.tag===r?(d[n][2].match=b.add.index,d[b.add.index][2].match=n,b.add.tag=b.add.index=null):(b.rem.tag=r,b.rem.index=n)),"add"!==t[0]&&v.push(0),"rem"!==t[0]&&m.push(0)}else t[1].match(/^>/)?("add"!==t[0]&&(v.pop(),v[v.length-1]++),"rem"!==t[0]&&(m.pop(),m[m.length-1]++)):("add"!==t[0]&&v[v.length-1]++,"rem"!==t[0]&&m[m.length-1]++)});var y,w={};t.do(d,function(e,n){if(!e[1].match(/^>/))if(e[1].match(/^<</))"rem"!==e[0]&&(d[n-1][2].el.innerHTML=e[1].slice(1));else{if("keep"===e[0])return e[1].match(/<.+ {.*"opaque":true.*}/)&&(e[2].el.innerHTML=""),h(e[2].el.parentNode.removeChild(e[2].el),e[2].New,n),void(e[2].active&&"a"!==e[1].match(/[^<\s]+/g)[0]&&(y=e[2].el));if(e[1].match(/^</)){if("rem"===e[0]&&(void 0===e[2].match||e[2].match>n)&&(w[e[2].old]=e[2].el.parentNode.removeChild(e[2].el)),"add"===e[0]){var r;if(void 0!==e[2].match){var i=d[e[2].match];w[i[2].old]||(w[i[2].old]=i[2].el);var a=(r=i[2].el).attributes;"moznamedattrmap"===o(a,!0)&&(a=t.obj(a,function(t){if(t)return[t.name,t.value]}));var s=JSON.parse(e[1].match(/{.+/)||"{}");t.do(t.fil(a,void 0,function(t,e){if("string"===o(t)&&(t={name:e}),void 0===s[t.name])return t.name}),function(t){"value"===t&&(r.value=void 0),"checked"===t&&(r.checked=!1),"selected"===t&&(r.selected=!1),r.removeAttribute(t)}),t.do(s,function(t,e){"value"===e&&(r.value=t),"checked"===e&&(r.checked=t),"selected"===e&&(r.selected=t),r.setAttribute(e,t)})}else r=document.createElement(e[1].match(/[^<\s]+/g)[0]),t.do(JSON.parse(e[1].match(/{.+/)||"{}"),function(t,e){(t||""===t||0===t)&&r.setAttribute(e,t)});h(r,e[2].New,n),e[2].el=r,i&&i[2].active&&"a"!==e[1].match(/[^<\s]+/g)[0]&&(y=r)}}else"add"===e[0]?(e[1]=e[1].replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#96;/g,"`"),h(document.createTextNode(e[1]),e[2].New,n)):e[2].el.parentNode.removeChild(e[2].el)}})}y&&(y.focus?y.focus():y.setActive(),y.blur(),y.focus?y.focus():y.setActive()),l.view=s[0],t.do(i.getChildren(r("#"+n).innerHTML),function(t){var e=i.routes[t];e.priority+=l.priority,e.parent||(e.parent=l.id),e.ondraw&&e.ondraw(e.id)}),l.ondraw&&l.ondraw(n),c()},i.prediff=function(r,a){if(e.simple(r))return void 0===r||""===r?a?void 0:[]:a?(0===a.length&&a.push(""),a[a.length-1].match(/^(<|>)/)&&a.push(""),a[a.length-1]+=n.g(r,i.prod)):[n.g(r,i.prod)];if(a=a||[],-1!==n.k.tags.indexOf(r[0])){a.push("<"+r[0]);var s="object"===o(r[1])?r[1]:void 0,u=r[s?2:1];s&&(a[a.length-1]+=" "+JSON.stringify(s),s.opaque?a.push("<"+n.g(u,i.prod)):s.id&&s.id.match(/^в[0-9a-f]+$/g)&&(u=i.routes[s.id].view));var c=a.length;if(s&&s.opaque||i.prediff(u,a),"table"===r[0]&&a[c]){if(a[c].match(/<thead/)){var l=0;t.stopNot(t.times(a.length-c,c),void 0,function(t){if(a[t].match(/</)&&l++,a[t].match(/>/)&&l--,0===l)return c=t+1})}a[c]&&null===a[c].match(/<tbody/)&&(a.splice(c,0,"<tbody"),a.push(">"))}a.push(">")}else t.do(r,function(t){i.prediff(t,a)});return a},i.diff=function(e,n){for(var r,o,a,s,u,c,l,f,d,p=[],h=0,g=Date.now();h<e.length+n.length+1;){if(i.trample&&Date.now()-g>i.trample)return!1;for(r=p[p.length-1]||{1:[0,0]},o={},p.push(o),a=-h;a<2*h-h+1;){for(u=(s=a===-h||a!==h&&r[a-1][1]<r[a+1][1]?[0,r[a+1][1]]:[0,r[a-1][1]+1,!0])[1]-a;s[1]<e.length&&u<n.length&&e[s[1]]===n[u];)s[1]++,u++,s[0]++;if(o[a]=s,!(s[1]<e.length||u<n.length)){for(c={x:s[1],y:u},l=[],f=h;f>-1;)u=(d=p[f][c.x-c.y])[1]-(c.x-c.y),d[0]&&t.do(t.times(d[0]),function(t){l.unshift(["keep",e[d[1]-t]])}),d[2]?l.unshift(["rem",e[d[1]-d[0]-1]]):l.unshift(["add",n[u-d[0]-1]]),c.x=d[1]-d[0]-(d[2]?1:0),c.y=u-d[0]-(d[2]?0:1),f--;return l.shift(),l}a+=2}h++}}}();