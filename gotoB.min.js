!function(){var l,e="object"==typeof exports;l=e?exports:window.dale={};var d=function(){return Object.prototype.toString.call(arguments).match("arguments")}(),p=function(e,t){var n=typeof e;return"function"===n?Object.prototype.toString.call(e).match(/regexp/i)?"regex":"function":"object"!==n&&"number"!==n?n:e instanceof Array?"array":"number"===n?isNaN(e)?"nan":isFinite(e)?e%1==0?"integer":"float":"infinity":null===e?"null":"array"===(n=Object.prototype.toString.call(e).replace("[object ","").replace("]","").toLowerCase())||"date"===n?n:"regexp"===n?"regex":t?!d&&"function"===n(e.callee)?"arguments":n:"object"};try{l.clog=console.log.bind(console)}catch(t){l.clog=function(){var e=l.go(arguments,function(e){return e===undefined?"undefined":e}).join(" ");window.console?window.console.log(e):alert(e)}}e=function(f){return function(e,t,n,r){var i,o,a,u,s;if("go"===f?(o=t,a=!0===n,u=[],i=0):"fil"===f?(o=n,a=!0===r,u=[],i=0):"obj"!==f?(o=n,a=!0===r):u="object"===p(t)?(o=n,a=!0===r,t):(o=t,a=!0===n,{}),"function"!==p(o))return l.clog(("go"===f||"obj"===f&&"object"!==p(t)?"Second":"Third")+" argument passed to dale."+f+" must be a function but instead is",o,"with type",p(o)),!1;if(e===undefined)return u;s="go"===f?function(e){u[i++]=e}:"fil"===f?function(e){e!==t&&(u[i++]=e)}:"obj"===f?function(e){if(e!==undefined)return"array"!==p(e)||2!==e.length?(l.clog("array"===p(e)?"fun passed to dale.obj must return undefined or an array of length 2 but instead returned an array of length "+e.length:"fun passed to dale.obj must return undefined or an array of length 2 but instead returned a value of type "+p(e)),!(u=!1)):void(u[e[0]]=e[1])}:function(e){return u=e,"stop"===f?e===t:e!==t};n=p(e);if("object"===n&&("[object Arguments]"!==Object.prototype.toString.call(e)&&(d||"function"!==p(e.callee))||(n="array",e=[].slice.call(e))),"array"===n)for(var c=0;c<e.length&&!s(o(e[c],parseInt(c)));c++);else if("object"===n){for(var c in e)if((a||!e.hasOwnProperty||e.hasOwnProperty(c))&&s(o(e[c],c)))break}else s(o(e,0));return u}};l.go=e("go"),l.fil=e("fil"),l.obj=e("obj"),l.stop=e("stop"),l.stopNot=e("stopNot"),l.keys=function(e,t){return l.go(e,function(e,t){return t},t)},l.times=function(e,t,n){if(0===e)return[];if("integer"!==p(e)||e<0)return l.clog("steps must be a positive integer or zero."),!1;if(t===undefined)t=1;else if("integer"!==p(t)&&"float"!==p(t))return l.clog("start must be an integer or float."),!1;if(n===undefined)n=1;else if("integer"!==p(n)&&"float"!==p(n))return l.clog("step must be an integer or float."),!1;for(var r=[t];r.length<e;)t+=n,r.push(t);return r},l.acc=function(e,t,n,r){var i=arguments.length===("boolean"===p(arguments[arguments.length-1])?4:3),o=i?t:undefined,a=i?n:t,u=i?r:n;if("function"!==p(a))return l.clog("fun must be a function but instead is of type",p(a)),!1;var s=!0;return l.go(e,function(e,t){return!i&&s?(s=!1,o=e):void(o=a(o,e))},u),o}}(),function(){var l,n="object"==typeof exports,d=n?require("dale"):window.dale;l=n?exports:window.teishi={},Array.prototype.indexOf||(Array.prototype.indexOf=function(n,r){var e=d.stopNot(this,undefined,function(e,t){if(!(r&&t<r))return n===e?t:void 0});return e===undefined?-1:e});var r=function(){return Object.prototype.toString.call(arguments).match("arguments")}();l.type=function(e,t){var n=typeof e;return"function"===n?Object.prototype.toString.call(e).match(/regexp/i)?"regex":"function":"object"!==n&&"number"!==n?n:e instanceof Array?"array":"number"===n?isNaN(e)?"nan":isFinite(e)?e%1==0?"integer":"float":"infinity":null===e?"null":"array"===(n=Object.prototype.toString.call(e).replace("[object ","").replace("]","").toLowerCase())||"date"===n?n:"regexp"===n?"regex":t?!r&&"function"===l.type(e.callee)?"arguments":n:"object"},l.str=function(){try{return JSON.stringify.apply(JSON.stringify,arguments)}catch(e){return!1}},l.parse=function(){try{return JSON.parse.apply(JSON.parse,arguments)}catch(e){return!1}},l.simple=function(e){e=l.type(e);return"array"!==e&&"object"!==e},l.complex=function(e){return!l.simple(e)},l.copy=function(r,i){if(l.simple(r))return r;var e=l.type(r,!0),o="array"===e||"arguments"===e?[]:{};return d.go(r,function(e,t){if(l.simple(e))return o[t]=e;var n=i?i.concat():[r];return-1<n.indexOf(e)?o[t]="[Circular]":(n.push(e),o[t]=l.copy(e,n))}),o},l.eq=function(e,n){return l.simple(e)&&l.simple(n)?e===n:l.type(e,!0)===l.type(n,!0)&&(l.str(d.keys(e).sort())===l.str(d.keys(n).sort())&&!1!==d.stop(e,!1,function(e,t){return l.eq(e,n[t])}))},l.last=function(e,t){return-1===["array","arguments"].indexOf(l.type(e,!0))?l.clog("First argument passed to teishi.last must be array or arguments but instead has type "+l.type(e,!0)):t!==undefined&&("integer"!==l.type(t)||t<1)?l.clog("Second argument passed to teishi.last must be either undefined or an integer larger than 0."):e[e.length-(t||1)]},l.time=function(e){return(arguments.length?new Date(e):new Date).getTime()};var i,f=function(){return n?"[0m":""},p=function(){return n?"[1m":""},g=function(){return n?"[37m":""},h=function(e){if(!n)return"";for(var t=i;i===t;)t=Math.round(5*Math.random()+1);return"["+(e?"4":"3")+(i=t)+"m"};l.clog=function(){var s=p();!function c(e,i){var o=l.type(e),i=i||0,a=!0;"object"===o&&"[object Arguments]"===Object.prototype.toString.call(e)&&(o="array");var u=i<2?"":"\n"+d.go(d.times(i-1),function(e){return"   "}).join("");0<i&&(s+="array"===o?g()+"[":g()+"{"),d.go(e,function(e,t){var n,r=l.type(e);if(0===i&&0===t&&("string"===r||"integer"===r))return s+=h(!(a=!1))+e+":"+f()+p();a||(s+=g()+(0===i?" ":", ")),a=!1,"string"===r&&0<i&&(e="'"+e+"'"),"function"===r&&(null!==(n=(e+="").match(/\s+(?=}$)/))&&(e=e.replace(new RegExp(n[0],"g"),"\n")),150<e.length&&(e=e.slice(0,150)+"...\n"),1<i&&(e=e.replace(/\n/g,"array"===o?u:"\n"+(t+": ").replace(/./g," ")+u.slice(1)))),s+=h(),"object"===o&&(s+=u+(t.match(/^[0-9a-zA-Z_]+$/)?t:"'"+t+"'")+": "),"array"===r||"object"===r?c(e,i+1):s+="object"===o?e:u+e}),0<i&&("array"===o&&(s+=(1<i?"\n":"")+u.slice(4)+g()+"]"),"object"===o&&(s+=(1<i?"\n":"")+u.slice(4)+g()+"}"))}(l.copy(arguments));var e=new Date;return d.clog("("+e[e.toISOString?"toISOString":"toString"]()+")",s+f()),!1},l.lno=function(){n=!1},l.makeTest=function(c,f){if("function"!==l.type(c))return l.clog("teishi.makeTest","fun passed to teishi.makeTest should be a function but instead is",c,"with type",l.type(c));if("string"===l.type(f)&&(f=[f]),"array"!==l.type(f))return l.clog("teishi.makeTest","clauses argument passed to teishi.makeTest should be an array but instead is",f,"with type",l.type(f));if("string"!==l.type(f[0]))return l.clog("teishi.makeTest","shouldClause passed to teishi.makeTest should be a string but instead is",f[0],"with type",l.type(f[0]));if(f[1]!==undefined&&("array"!==l.type(f[1])&&(f[1]=[f[1]]),!0!==d.stopNot(f[1],!0,function(e){var t=l.type(e);return"string"===t||"function"===t||l.clog("teishi.makeTest","Each finalClause passed to teishi.makeTest should be a string or a function but instead is",e,"with type",t)})))return;return function(e,t,n,r,i,o){var a=c(n,r);if(!0===a)return!0;if("array"===l.type(a))return a;var u=[],s=0;return i!==undefined&&(u[s++]="each of the"),t[0]&&(u[s++]=t[0]),e&&(u[s++]="passed to",u[s++]=e),u[s++]=f[0],o!==undefined&&(u[s++]="one of"),u[s++]=o!==undefined?o:r,t[1]&&(u[s++]="("+t[1]+")"),u[s++]=i!==undefined?"but one of":"but instead",i!==undefined&&(u[s++]=i),u[s++]="is",u[s++]=n,d.go(f[1],function(e){u[s++]="function"!=typeof e?e:e(n,r)}),u}},l.test={type:l.makeTest(function(e,t){return l.type(e)===t},["should have as type",["with type",l.type]]),equal:l.makeTest(l.eq,"should be equal to"),notEqual:l.makeTest(function(e,t){return!l.eq(e,t)},"should not be equal to"),range:l.makeTest(function(n,e){return"object"!==l.type(e,!0)?["Range options object must be an object but instead is",e,"with type",l.type(e,!0)]:"{}"===l.str(e)||d.stopNot(e,!0,function(e,t){return"min"!==t&&"max"!==t&&"less"!==t&&"more"!==t?['Range options must be one of "min", "max", "less" and "more", but instead is',t]:"min"===t?e<=n:"max"===t?n<=e:"less"===t?n<e:e<n})},"should be in range"),match:l.makeTest(function(e,t){return"string"!==l.type(e)?["Invalid comparison string passed to teishi.test.match. Comparison string must be of type string but instead is",e,"with type",l.type(e)]:"regex"!==l.type(t)?["Invalid regex passed to teishi.test.match. Regex must be of type regex but instead is",t,"with type",l.type(t)]:null!==e.match(t)},"should match")},l.validateRule=function(r){var e=l.type(r);if("function"===e||"boolean"===e)return!0;if("array"!==e)return["each teishi rule must be an array or boolean or function but instead is",r,"with type",e];var i,o,e=l.type(r[0]);return"string"!==e&&("array"!==e||2!==r[0].length||"string"!==l.type(r[0][0])||"string"!==l.type(r[0][1]))||(3===r.length||(r.length<3||5<r.length?["Each teishi simple rule must be an array of length between 3 and 5, but instead is",r,"and has length",r.length]:d.stopNot(r,!0,function(e,t){if(t<3)return!0;var n=l.type(e);if("string"===n){if("oneOf"!==e&&"each"!==e&&"eachOf"!==e)return["Invalid multi parameter",e,". Valid multi parameters are",["oneOf","each","eachOf"]];if(o)return["You can pass only one multi parameter to a teishi simple rule but instead you passed two:",r[3],"and",r[4]];o=e}else{if("function"!==n)return["Elements #4 and #5 of a teishi simple rule must be either a string or a function, but element","#"+(t+1),"is",e,"and has type",n];if(i)return["You can pass only one test function to a teishi simple rule but instead you passed two:",r[3],"and",r[4]];i=e}return!0})))};var m=function(e,t){return t===undefined?l.clog.apply(l.clog,["teishi.v"].concat(e)):(e=d.go(e,function(e){return l.complex(e)?l.str(e):e+""}).join(" "),!0===t?e:(t(e),!1))};l.v=function(e,t,n,r){var i,o,a,u;if(!(u="string"===l.type(e)?(i=e,o=t,a=n,r):(i="",o=e,a=t,n))){if(a!==undefined&&!0!==a&&"function"!==l.type(a))return l.clog("teishi.v","Invalid apres argument. Must be either undefined, true, or a function.");var s=l.validateRule(o);if(!0!==s)return m(s,a)}t=l.type(o);if("boolean"===t)return o;if("function"===t)return l.v(i,o(),a,u);if(0===o.length)return!0;n=l.type(o[0]);if("boolean"===n&&2===o.length&&"array"===l.type(o[1]))return!1===o[0]||l.v(i,o[1],a,u);if("string"!==n&&("array"!==n||2!==o[0].length||"string"!==l.type(o[0][0])||"string"!==l.type(o[0][1])))return d.stopNot(o,!0,function(e){return l.v(i,e,a,u)});var s=l.type(o[3]),t=l.type(o[4]),c="function"===s?o[3]:"function"===t?o[4]:l.test.type,s="string"===s?o[3]:"string"===t?o[4]:undefined,f="array"===n?o[0]:[o[0]],t=l.type(o[1],!0),n=l.type(o[2],!0);return("each"===s||"eachOf"===s)&&("array"===t&&0===o[1].length||"object"===t&&0===d.keys(o[1]).length||o[1]===undefined)||(!0===(s="oneOf"!==s&&"eachOf"!==s||!("array"===n&&0===o[2].length||"object"===n&&0===d.keys(o[2]).length||o[2]===undefined)?s===undefined?c(i,f,o[1],o[2]):"each"===s?d.stopNot(o[1],!0,function(e){return c(i,f,e,o[2],o[1])}):"oneOf"===s?d.stop(o[2],!0,function(e){return c(i,f,o[1],e,undefined,o[2])}):d.stopNot(o[1],!0,function(t){return d.stop(o[2],!0,function(e){return c(i,f,t,e,o[1],o[2])})}):["To field of teishi rule is",o.to,"but multi attribute",s,"requires it to be non-empty, at teishi step",o])||m(s,a))},l.stop=function(){return!0!==l.v.apply(l.v,arguments)}}(),function(){var u,e="object"==typeof exports,s=e?require("dale"):window.dale,o=e?require("teishi"):window.teishi;u=e?exports:window.lith={};var c=o.type,f=o.clog;u.k={lithbagElements:["string","integer","float","array","undefined"],tags:["!DOCTYPE HTML","LITERAL","a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","command","datalist","dd","del","details","dfn","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"],voidTags:["!DOCTYPE HTML","area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]},u.entityify=function(e,t){return!(!t&&o.stop("lith.entityify",["Entityified string",e,"string"]))&&e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/`/g,"&#96;")},u.v=function(t,e){var n=c(t);if("array"===n&&-1<u.k.tags.indexOf(t[0])){var r="object"===c(t[1])?t[1]:undefined,i=t[r?2:1];return!0===(i=o.v([["lith length",t.length,{min:1,max:3},o.test.range],[r===undefined,["length of lith without attributes",t.length,{max:2},o.test.range]],[["lith attribute keys","start with an ASCII letter, underscore or colon, and be followed by letters, digits, underscores, colons, periods, dashes, extended ASCII characters, or any non-ASCII characters."],s.keys(r),/^[a-zA-Z_:][a-zA-Z_:0-9.\-\u0080-\uffff]*$/,"each",o.test.match],["lith attribute values",r,["string","integer","float","undefined","null","boolean"],"eachOf"],"LITERAL"===t[0]?["lith LITERAL contents",i,"string"]:["lith contents",i,u.k.lithbagElements,"oneOf"]],!!e||function(e){f("lith.v - Invalid lith",{error:e,"original input":t})}))?"Lith":!!e&&{error:i,"original input":t}}return!0===(i=o.v([["lithbag",n,u.k.lithbagElements,"oneOf",o.test.equal],["array"===n,["lithbag elements",t,u.k.lithbagElements,"eachOf"]]],!!e||function(e){f("lith.v - Invalid lithbag",{error:e,"original input":t})}))?"Lithbag":!!e&&{error:i,"original input":t}},u.g=function(e,t){if(t||u.prod)return!0!==(t||u.prod)?f("lith.g","prod or lith.prod must be true or undefined."):"array"===c(e)&&-1<u.k.tags.indexOf(e[0])?u.generateLith(e,!0):u.generateLithbag(e,!1,!0);t=u.v(e);return!!t&&u["generate"+t](e)},u.generateLithbag=function(e,t,n){var r="";return!1!==s.stop(e,!1,function(e){if(e!==undefined){c(e);if("array"!==c(e))return r+=t?e:u.entityify(e+"",n);e=u.g(e,n);if(!1===e)return!1;r+=e}})&&r},u.generateLith=function(e,n){var t="object"===c(e[1])?e[1]:undefined,r=e[t?2:1];if("LITERAL"===e[0])return r;var i="<"+e[0];if(s.go(t,function(e,t){!e&&0!==e||(i+=" "+u.entityify(t+"",n)+'="'+u.entityify(e+"",n)+'"')}),i+=">","array"===c(r)){t=("style"===e[0]?u.css:u).g(r,n);if(!1===t)return!1;i+=t}else i+=u.generateLithbag(r,"style"===e[0]||"script"===e[0],n);return-1===u.k.voidTags.indexOf(e[0])&&(i+="</"+e[0]+">"),i},u.css={},u.css.v=function(t,e){var n=o.v(["litc or litcbag",t,"array"],!!e||function(e){f("lith.css.v - Invalid litc or litcbag",{error:e,"original input":t})});if(!0!==n)return!!e&&{error:n,"original input":t};if(0===t.length||"array"===c(t[0]))return!0;var r="object"===c(t[1])?t[1]:undefined,i=t[r?2:1];return!0===(n=o.v([["litc length",t.length,{min:1,max:3},o.test.range],[r===undefined,["length of litc without attributes",t.length,{max:2},o.test.range]],["litc selector",t[0],"string"],u.css.vAttributes(r),"LITERAL"===t[0]?["litc LITERAL contents",i,"string"]:["litc contents",i,["undefined","array"],"oneOf"]],!!e||function(e){f("lith.css.v - Invalid litc",{error:e,"original input":t})}))?n:!!e&&{error:n,"original input":t}},u.css.vAttributes=function(e){return o.v([["litc attribute values",e,["string","integer","float","object","undefined","null","boolean"],"eachOf"]])},u.css.g=function(e,n,r){if(n||u.prod){if(!0!==(n||u.prod))return f("lith.css.g","prod or lith.prod must be true or undefined.");n=!0}if(!n&&!1===u.css.v(e))return!1;if(0===e.length)return"";if("LITERAL"===e[0])return e[1];var i="";if("array"===c(e[0]))return!1!==s.stop(e,!1,function(e,t){e=u.css.g(e,n,r);if(!1===e)return!1;i+=e})&&i;r===undefined&&(r="");var t="object"===c(e[1])?e[1]:undefined,o=e[t?2:1];r=s.go(r.split(/,\s*/),function(t){return s.go(e[0].split(/,\s*/),function(e){return e.match(/&/)?e.replace("&",t):t+(0===t.length?"":" ")+e}).join(", ")}).join(", "),i+=r+"{";var a=function(e){return!1!==u.css.vAttributes(e)&&s.stop(e,!1,function(t,e){if(t||0===t){var n=c(t);if("object"===n)return a(t);"integer"===n&&(t<0||1<t)&&(t+="px"),"float"!==n&&1!==t||(t=100*t+"%"),s.go(e.split(/,\s*/),function(e){i+=e+":"+t+";"})}})};if(!1===a(t))return!1;if(i===r+"{"?i="":i+="}",o){o=u.css.g(o,n,r);if(!1===o)return!1;i+=o}return i},u.css.media=function(e,t){return!o.stop(["selector",e,"string"])&&[["LITERAL","@media "+e+" {"],t,["LITERAL","}"]]},u.css.style=function(e,t){t=u.css.g(["",e],t);return!1===t?t:t.slice(1,-1)}}(),function(){var e="object"==typeof exports,u=e?require("dale"):window.dale,s=e?require("teishi"):window.teishi,c=s.type,t=s.clog,n=function(e){if(!s.stop([["store",e,["array","object","undefined"],"oneOf"]])){var a={responders:{},store:e||{},log:[],error:t,count:{e:1,l:1},call:function(){var e=arguments[(o="object"===c(arguments[0])?arguments[0]:undefined)?1:0],t=arguments[o?2:1];if(s.simple(t)&&(t=[t]),!a.prod&&s.stop("r.call",[["context",o,["object","undefined"],"oneOf"],[o!==undefined,[function(){return["x.from",o.from,["string","undefined"],"oneOf"]}]],["verb",e,"string"]],function(e){o?a.error(o,"r.call",e):a.error("r.call",e)}))return!1;if(!a.prod&&!a.isPath(t))return o?a.error(o,"r.call","Invalid path. Arguments:",{verb:e,path:t}):a.error("r.call","Invalid path. Arguments:",{verb:e,path:t});var n=arguments,r=arguments.length===(o?3:2)?undefined:u.go(u.times(arguments.length-(o?3:2),o?3:2),function(e){return n[e]}),i=o?o.responder?o.responder.id+"/"+o.from:o.from:undefined,o={from:"E"+a.count.e++,verb:e,path:t,args:r};return a.logpush(i,o.from,e,t,r),a.mill(r===undefined?[o]:[o].concat(r)),o.from},respond:function(){var e,t=arguments[arguments.length-1];if(arguments.length<2)return a.error("r.respond","Too few arguments passed to r.respond");if(2===arguments.length?e=arguments[0]:((e=3===arguments.length?{}:arguments[2]).verb=arguments[0],e.path=arguments[1]),s.simple(e.path)&&(e.path=[e.path]),!a.prod&&s.stop("r.respond",[["options",e,"object"],["keys of options",u.keys(e),["verb","path","id","parent","priority","burn","match"],"eachOf",s.test.equal],function(){return[["options.verb",e.verb,["string","regex"],"oneOf"],["options.id",e.id,["string","integer","undefined"],"oneOf"],["options.parent",e.parent,["string","integer","undefined"],"oneOf"],["options.priority",e.priority,["undefined","integer"],"oneOf"],["options.burn",e.burn,["undefined","boolean"],"oneOf"],["options.match",e.match,["undefined","function"],"oneOf"]]},["responder function",t,"function"]],function(e){a.error("r.respond",e)}))return!1;if(!a.prod&&!a.isPath(e.path,!0))return a.error("r.respond","Invalid path. Options:",e);if(e.id!==undefined){if(e.id+="",!a.prod&&e.id.match(/^[R|E]\d+$/))return a.error("r.respond","If you pass an id for a responder, it cannot be an `L` or an `E` followed by digits, since that is the form that recalc gives to auto-generated ids.");if(!a.prod&&a.responders[e.id])return a.error("r.respond","A responder with id",e.id,"already exists.")}else e.id="R"+a.count.l;return e.rfun=t,e.index=a.count.l++,(a.responders[e.id]=e).id},forget:function(n,r){if(!a.prod&&r!==undefined&&"function"!==c(r))return a.error("r.forget","Second argument to r.forget must be a function or undefined. Id is:",n);if(!a.prod&&!a.responders[n])return a.error("r.forget","responder",n,"does not exist.");var e=a.responders[n];delete a.responders[n],r&&r(e),u.go(a.responders,function(e,t){e.parent===n&&a.forget(t,r)})},isPath:function(e,t){return s.v([["path",e,["array","integer","string"].concat(t?"regex":[]),"oneOf"],["path",e,["integer","string"].concat(t?"regex":[]),"eachOf"]],function(){})},compare:function(e,t){return"*"===e||"*"===t||("regex"===c(t)?null!==(e+"").match(t):e===t)},logpush:function(e,t,n,r,i){a.log&&a.log.push({t:s.time(),from:e,id:t,verb:n,path:r,args:i})},mill:function(n){var r=function(e){if(0!==e.length){n[0].cb=function(){r(e)};var t=e.shift();if(n[0].responder=t,!a.responders[t.id])return r(e);a.logpush(n[0].from,t.id,t.verb,t.path,n.slice(1).length?n.slice(1):undefined),t.burn&&a.forget(t.id),"function"!==c(t.rfun.apply(null,n))&&r(e)}};r(a.sort(a.match(n[0].verb,n[0].path,n.slice(1),a.responders)))},match:function(e,r,t,n){var i=[];return u.go(n,function(n){if(!n.disabled)return n.match?!0===n.match({verb:e,path:r,args:t},n)?i.push(n):undefined:a.compare(e,n.verb)&&r.length===n.path.length?0===r.length&&0===n.path.length?i.push(n):void(u.stop(r,!1,function(e,t){return a.compare(r[t],n.path[t])})&&i.push(n)):void 0}),i},sort:function(e){return e.sort(function(e,t){var n=(t.priority||0)-(e.priority||0);return 0!=n?n:e.index-t.index})}};return a}};e?module.exports=n:window.R=n}(),function(){if("object"==typeof exports)return console.log("cocholate only works in a browser!");var u=window.dale,s=window.teishi,c=s.type,f=s.clog;document.createElement("_").insertAdjacentHTML||(HTMLElement.prototype.insertAdjacentHTML=function(e,t){var n=document.createElement("div");for(n.innerHTML=t;n.firstChild;)"beforeBegin"===e?this.parentNode.insertBefore(n.firstChild,this):"afterBegin"===e?this.insertBefore(n.firstChild,this.firstChild):"beforeEnd"===e?this.appendChild(n.firstChild):this.parentNode.insertBefore(n.firstChild,this.nextElementSibling)});var l=window.c=function(e,t){if(s.stop("c",["fun",t,["function","undefined"],"oneOf"]))return!1;var n,r=e&&e.nodeName,i=r?[e]:l.find(e);return!1!==i&&(t&&(n=u.go(arguments,function(e){return e}).slice(2),i=u.go(i,function(e){return t.apply(undefined,[e].concat(n))})),r||"body"===e||"string"===c(e)&&e.match(/^[a-z0-9]*#[^\s\[>,:]+$/)?i[0]:i)};l.nodeListToArray=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t},l.setop=function(e,t,n){if("and"===e)return u.fil(t,undefined,function(e){return-1<n.indexOf(e)?e:undefined});var r=t.slice();return"or"===e?u.go(n,function(e){-1===r.indexOf(n)&&r.push(e)}):(0===r.length&&(r=l.nodeListToArray(document.getElementsByTagName("*"))),u.go(n,function(e){e=r.indexOf(e);-1<e&&r.splice(e,1)})),r},l.find=function(t){var e=c(t);if(s.stop("cocholate",[["selector",t,["array","string","object"],"oneOf"],function(){return[["array"===e,["first element of array selector",t[0],[":and",":or",":not"],"oneOf",s.test.equal]],["object"===e,[["selector keys",u.keys(t),["selector","from"],"eachOf",s.test.equal],["selector.selector",t.selector,["array","string"],"oneOf"],function(){return!("object"!==c(t.from)||document.querySelectorAll&&!t.from.querySelectorAll)||f("teishi.v","selector.from passed to cocholate must be a DOM element.")}]]]}]))return!1;if("array"!==e){if(document.querySelectorAll&&"string"===e)return l.nodeListToArray(document.querySelectorAll(t));if(document.querySelectorAll&&"object"===e)return l.nodeListToArray(t.from.querySelectorAll(t.selector));var n=t.from?t.from:document;if("*"!==(t="string"===e?t:t.selector)&&!t.match(/^[a-z0-9]*(#|\.)?[^,>\[\]]+$/i))return f("The selector "+t+" is not supported in IE <= 7 or Firefox <= 3.");var r=t.match("#")?"id":t.match(/\./)?"class":undefined,i=2!==(t=t.split(/#|\./)).length&&r?undefined:t[0].toUpperCase();return u.fil(l.nodeListToArray(n.getElementsByTagName(i||"*")),undefined,function(e){if(!("class"===r&&-1===(e.className||"").split(/\s/).indexOf(s.last(t))||"id"===r&&e.id!==s.last(t)))return e})}var o=t.shift(),a=[];return u.stop(t,!1,function(e,t){e=l.find(e);if(!1===e)return a=!1;a=0===t&&":not"!==o?e:l.setop(o.replace(":",""),a,e)}),a},l.empty=function(e){l(e,function(e){e.innerHTML=""})},l.fill=function(e,t){if(s.stop("c.fill",["html",t,"string"]))return!1;l(e,function(e){e.innerHTML=t})},l.place=function(e,t,n){if(s.stop("c.place",[["where",t,["beforeBegin","afterBegin","beforeEnd","afterEnd"],"oneOf",s.test.equal],["html",n,"string"]]))return!1;l(e,function(e){e.insertAdjacentHTML(t,n)})},l.get=function(e,n,r){if(s.stop("c.get",["attributes",n,["string","array","undefined"],"oneOf"]))return!1;var i=[null,"",!1,0,"false"];return l(e,function(t){return n!==undefined?u.obj(n,function(e){return r?[e,t.style[e]||null]:[e,t.getAttribute(e)]}):r?u.obj(t.style.length?u.times(t.style.length,0):u.keys(t.style),function(e){return t.style.length?[t.style[e],t.style[t.style[e]]]:-1===i.indexOf(t.style[e])?[e,t.style[e]]:void 0}):u.obj(t.attributes,{"class":t["class"]||t.className},function(e,t){if(e&&e.nodeName&&-1===i.indexOf(e.nodeValue))return[e.nodeName,e.nodeValue]})})},l.set=function(e,t,r,i){if(s.stop("c.set",[["attributes",t,"object"],[["attribute keys","start with an ASCII letter, underscore or colon, and be followed by letters, digits, underscores, colons, periods, dashes, extended ASCII characters, or any non-ASCII characters."],u.keys(t),/^[a-zA-Z_:][a-zA-Z_:0-9.\-\u0080-\uffff]*$/,"each",s.test.match],["attribute values",t,["integer","float","string","null"],"eachOf"]]))return!1;l(e,function(n){u.go(t,function(e,t){r?n.style[t]=null===e?"":e:null===e?n.removeAttribute(t):n.setAttribute(t,e)}),i||l.fire(n,"change")})},l.fire=function(e,r){if(s.stop("c.fire",["event type",r,"string"]))return!1;l(e,function(e){var t;try{t=new Event(r)}catch(n){t=document.createEvent?document.createEvent("Event"):document.createEventObject(),document.createEvent&&t.initEvent(r,!1,!1)}if(e.dispatchEvent)return e.dispatchEvent(t);if(!e.fireEvent)return f("c.fire error","Unfortunately, this browser supports neither EventTarget.dispatchEvent nor element.fireEvent.");try{e.fireEvent("on"+r,t)}catch(n){e["on"+r]&&e["on"+r]()}})},l.ready=function(e){if(window.addEventListener)return window.addEventListener("load",e,!1);if(window.attachEvent)return window.attachEvent("onload",e);var t=setInterval(function(){"complete"===document.readyState&&(e()||clearInterval(t))},10)},l.cookie=function(e){return!1===e?u.go(document.cookie.split(/;\s*/),function(e){return document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()),e}):u.obj((e||document.cookie).split(/;\s*/),function(e){if(""!==e)return[(e=e.split("="))[0],e.slice(1).join("=")]})},l.ajax=function(e,t,n,r,i){if(e=e||"GET",n=n||{},r=r||"",i=i||function(){},s.stop("c.ajax",[["method",e,"string"],["path",t,"string"],["headers",n,"object"],["callback",i,"function"]]))return!1;var o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return o.open(e.toUpperCase(),t,!0),s.complex(r)&&"formdata"!==c(r,!0)&&(n["content-type"]=n["content-type"]||"application/json",r=s.str(r)),u.go(n,function(e,t){o.setRequestHeader(t,e)}),o.onreadystatechange=function(){if(4===o.readyState){if(200!==o.status&&304!==o.status)return i(o);var n,e={xhr:o,headers:u.obj(o.getAllResponseHeaders().split(/\r?\n/),function(e){if(""!==e){var t=e.match(/^[^:]+/)[0],e=e.replace(t,"").replace(/:\s+/,"");return t.match(/^content-type/i)&&e.match(/application\/json/i)&&(n=!0),[t,e]}})};e.body=n?s.parse(o.responseText):o.responseText,i(null,e)}},o.send(r),{headers:n,body:r,xhr:o}},l.loadScript=function(e,r){return r=r||function(){},l.ajax("get",e,{},"",function(e,t){if(e)return r(e);var n=document.createElement("script");try{n.appendChild(document.createTextNode(t.body))}catch(e){n.text=t.body}document.body.appendChild(n),r(null,t)})},l.test=function(r){if(s.stop("c.test",[["tests",r,"array"],["tests",r,"array","each"],u.go(r,function(e,t){return[["test length",e.length,{min:2,max:3},s.test.range],["test #"+(t+1)+" tag",e[0],"string"],2===e.length?["test #"+(t+1)+" check",e[1],"function"]:[["test #"+(t+1)+" action",e[1],"function"],["test #"+(t+1)+" check",e[2],"function"]]]})]))return!1;var i=s.time(),o=function(e){var t=r[e];if(!t)return f("c.test","All tests finished successfully ("+(s.time()-i)+" ms)");var n=function(){if(!1===t[2===t.length?1:2]())throw new Error("c.test: Test failed: "+t[0]);o(e+1)};if(f("c.test","Running test:",t[0]),2===t.length)return n();t[1](function(e){if(e===undefined)return n();if("integer"!==c(e)||e<0)throw new Error("c.test: wait parameter must zero or a positive integer but instead is "+e);setTimeout(n,e)})!==undefined&&n()};o(0)}}(),function(){if("object"==typeof exports)return console.log("gotoв only works in a browser!");var y=window.dale,s=window.teishi,l=window.lith,c=window.R(),i=window.c,f=s.type,g=Date.now?function(){return Date.now()}:function(){return(new Date).getTime()},b=window.B={v:"2.0.0",B:"в",t:g(),r:c,responders:c.responders,store:c.store,log:c.log,call:c.call,respond:c.respond,forget:c.forget};c.error=b.error=function(){var e="object"===f(arguments[0])?arguments[0]:undefined,t=y.go(arguments,function(e){return e}).slice(e?1:0);return b.call.apply(null,[e||{},"error"].concat(t)),!1},b.respond({id:"error",verb:"error",path:[],match:function(e){return"error"===e.verb}},function(){document.body.innerHTML+=l.g(["div",{id:"eventlog-snackbar",style:l.css.style({position:"fixed","font-weight":"bold",opacity:"0.8",top:0,left:.1,width:.8,padding:10,color:"white","background-color":"black","z-index":"10001","text-align":"center"})},"There was an error."],!0),setTimeout(function(){i("#eventlog-snackbar")&&document.body.removeChild(i("#eventlog-snackbar"))},3e3),b.eventlog()}),b.eventlog=function(){i("#eventlog")&&document.body.removeChild(i("#eventlog"));var n={},r=["#fe6f6c","#465775","#e086c3","#8332ac","#462749","#044389","#59c9a6","#ffad05","#7cafc4","#5b6c5d"];document.body.innerHTML+=l.g(["table",{id:"eventlog"},[["style",["#eventlog",{"border-collapse":"collapse","font-family":"monospace","font-size":18,position:"absolute","right, top":4,width:Math.min(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,800),"z-index":"10000",border:"solid 4px #4488DD"},["th, td",{"padding-left, padding-right":10,"border-bottom, border-right":"solid 1px black"}]]],["tr",y.go(["#","ms","id","from","verb","path","args"],function(e){return["th",{style:l.css.style({"background-color":"#efefef"})},e]})],y.go(b.log,function(e,t){return n[e.from&&e.from.match(/^E\d+$/)?e.id+"/"+e.from:e.id]=t,["tr",{style:l.css.style({"background-color":{0:"#fcfcfc",1:"#efefef"}[t%2]})},y.go(["#"+(t+1),e.t-b.t,e.id,e.from,e.verb,e.path.join(":"),y.go(e.args,b.str).join(", ")],function(e,t){return 1===t?["td",e/1e3+(e%1e3?"":".0")+(e%100?"":"0")+(e%10?"":"0")+"s"]:2!==t&&3!==t?["td",e]:["td",{onclick:e===undefined?"":'c ("tr") ['+(n[e]+1)+"].scrollIntoView ()",style:l.css.style({cursor:"pointer","font-weight":"bold",color:r[parseInt(n[e])%r.length]})},e===undefined?"":e]})]})]],!0),i("tr")[b.log.length].scrollIntoView()},b.get=function(){var n="array"===f(arguments[0])?arguments[0]:y.go(arguments,function(e){return e});if(!b.prod&&!c.isPath(n))return b.error("B.get","Invalid path:",n)||undefined;var r=b.store;return!1===y.stop(n,!1,function(e,t){return!(t<n.length-1&&s.simple(r[e]))&&void(r=r[e])})?undefined:r},b.set=function(){var e="object"===f(arguments[0])?arguments[0]:undefined,n=arguments[e?1:0],r=arguments[e?2:1];if(!b.prod&&!c.isPath(n))return b.error(e||{},"B.set","Invalid path:",n);if("array"!==f(n)&&(n=[n]),0===n.length)return!b.prod&&s.simple(r)?b.error(e||{},"B.set","Cannot set B.store to something that is not an array or object."):(b.store=r,!0);e="string"===f(n[0])?"object":"array";f(b.store)!==e&&(b.store="object"==e?{}:[]);var i=b.store;return y.go(n,function(e,t){if(t===n.length-1)return i[e]=r;t="string"===f(n[t+1])?"object":"array";f(i[e])!==t&&(i[e]="object"==t?{}:[]),i=i[e]}),!0},b.add=function(){var n="object"===f(arguments[0])?arguments[0]:undefined,e=arguments[n?1:0];if(!b.prod&&!c.isPath(e))return b.error(n||{},"B.add","Invalid path:",e);b.get(e)===undefined&&b.set(e,[]);var r=b.get(e);return b.prod||"array"===f(r)?(y.go(arguments,function(e,t){(n?1:0)<t&&r.push(e)}),!0):b.error(n||{},"B.add","Cannot add to something that is not an array. Path:",e)},b.rem=function(){var t="object"===f(arguments[0])?arguments[0]:undefined,n=arguments[t?1:0];if(!b.prod&&!c.isPath(n))return b.error(t||{},"B.rem","Invalid path:",n);var r=b.get(n),e=f(r),i="array"===f(arguments[t?2:1])?arguments[t?2:1]:y.go(arguments,function(e){return e}).slice(t?2:1);return!(!b.prod&&s.stop("B.rem",[["type of target",e,["array","object","undefined"],"oneOf",s.test.equal],"array"===e?["keys of array target",i,"integer","each"]:[],"object"===e?["keys of object target",i,"string","each"]:[]],function(e){b.error(t||{},"B.rem",e,"Path:",n)}))&&("object"===e&&y.go(i,function(e){delete r[e]}),"array"===e&&(i=i.slice().sort(function(e,t){return t-e}),y.go(i,function(e){r.splice(e,1)})),!0)},b.mrespond=function(e){y.go(e,function(e){b.respond.apply(null,e)})},y.go(["add","rem","set"],function(n){b.respond({id:n,verb:n,path:[],match:function(e,t){return c.compare(e.verb,t.verb)}},function(e){var t="set"===n?b.get(e.path):s.copy(b.get(e.path));!1!==b[e.verb].apply(null,[e,e.path].concat(y.go(arguments,function(e){return e}).slice(1)))&&(s.eq(t,b.get(e.path))||b.call(e,"change",e.path,b.get(e.path),t))})}),b.changeResponder=function(t,n){return!!c.compare(t.verb,n.verb)&&(0===t.path.length||0===n.path.length||y.stop(y.times(Math.min(t.path.length,n.path.length),0),!1,function(e){return c.compare(t.path[e],n.path[e])}))},b.str=function(e){var t=f(e);return"array"!==t&&"object"!==t?"string"===t?s.str(e):e+"":"array"===t?"["+y.go(e,b.str).join(", ")+"]":"{"+y.go(e,function(e,t){return s.str(t)+": "+b.str(e)}).join(", ")+"}"},b.evh=function(e){return y.obj(i.get(e),function(e,t){if(!t.match(/^on/))return[t,e]})},b.ev=function(){var t;if(t="array"===f(arguments[0])?arguments:0===arguments.length?[]:[y.go(arguments,function(e){return e})],!b.prod&&s.stop("B.ev",y.go(t,function(e){return[["ev",e,"array"],function(){return[["ev.verb",e[0],"string"],function(){return!!c.isPath(e[1])||b.error("B.ev","Invalid path:",e[1],"Events:",t)}]}]}),function(e){b.error("B.ev",e,"Events:",t)}))return!1;var n='var id = B.call ("ev", event ? event.type : "undefined event", B.evh (this));';return y.go(t,function(e){n+=' B.call ({"from": id}, '+y.go(2===e.length?e.concat({raw:"this.value"}):e,function(e,t){return 1<t&&"object"===f(e)&&"string"===f(e.raw)?e.raw:b.str(e)}).join(", ")+");"}),n},b.mount=function(e,t){if(!b.prod&&"string"!==f(e)||!e.match(/^(body|[a-z0-9]*#[^\s\[>,:]+)$/))return b.error("B.mount","Target must be either 'body' or an id selector, but instead is "+e);var n="body"===e?document.body:document.getElementById(e.replace(/.*#/g,""));if(!b.prod){if(!n)return b.error("B.mount","Target not found:",e);if("function"!==f(t))return b.error("B.mount","fun must be a function but instead is",t)}n=t();if(!b.prod){t=b.validateLith(n);if("Lith"!==t&&"Lithbag"!==t)return b.error("B.mount","function returned invalid lith or lithbag",t)}i.place(e,"afterBegin",l.g(n,!0))},b.unmount=function(e){if(!b.prod&&"string"!==f(e)||!e.match(/^(body|[a-z0-9]*#[^\s\[>,:]+)$/))return b.error("B.unmount","Target must be either 'body' or an id selector, but instead is "+e);var t="body"===e?document.body:document.getElementById(e.replace(/.*#/g,""));if(!b.prod&&!t)return b.error("B.unmount","Target not found:",e);i({selector:"*",from:t},function(e){e.id&&e.id.match(/^в[0-9a-f]+$/g)&&b.responders[e.id]&&b.forget(e.id)}),t.innerHTML=""},b.view=function(r,i){var o="array"!==f(r)?[[r]]:"array"!==f(r[0])?[r]:r;if(!b.prod&&s.stop("B.view",[y.stopNot(o,!1,function(e){return!!c.isPath(e)||b.error("B.view","Invalid path:",e,"Arguments",{path:e})}),function(){return["fun",i,"function"]}],function(e){b.error("B.view",e,{path:r})}))return!1;var a=b.B+b.internal.count++,u=function(){var e=b.internal.count,t=[],n=i.apply(null,y.go(o,b.get));if(!b.prod&&"Lith"!==b.validateLith(n))return b.error("B.view","View function must return a lith element but instead returned:",n,"Arguments:",{path:r});y.go(y.times(b.internal.count-e,e),function(e){e=b.responders[b.B+e];e.parent||(t.push(e.id),e.parent=a),e.priority=e.priority+b.responders[a].priority});e=y.obj("object"===f(n[1])?n[1]:{},{id:a,path:y.go(o,function(e){return e.join(":")||":"}).join(", ")},function(e,t){if(-1===["id","path"].indexOf(t.toLowerCase()))return[t,e]}),n=n.slice();return"object"!==f(n[1])?n.splice(1,0,e):n[1]=e,b.responders[a].elem=n,b.responders[a].children=t,n};return b.respond("change",[],{id:a,priority:-1,match:function(t){return y.stop(o,!0,function(e){return b.changeResponder(t,{verb:"change",path:e})})}},function(e){var t=b.responders[a].elem,n=b.responders[a].children,r=g();u()&&b.redraw(e,a,t,n,g()-r)}),u()},b.internal={count:1,timeout:200,queue:[],redrawing:!1},b.validateLith=function(e){var t=l.v(e,!0);if("Lith"!==t&&"Lithbag"!==t)return t;if("Lith"!==t)return y.stopNot(e,undefined,function(e){if("array"===f(e)){e=b.validateLith(e);return"Lith"!==e&&"Lithbag"!==e?e:void 0}})||"Lithbag";if("array"!==f(s.last(e)))return"Lith";e="style"===e[0]?b.validateLitc(s.last(e)):b.validateLith(s.last(e));return"Lith"===e||"Lithbag"===e||!0===e?"Lith":e},b.validateLitc=function(e){var t=l.css.v(e,!0);return!0!==t?t:"array"===f(e[0])?y.stopNot(e,!0,b.validateLitc):"array"!==f(s.last(e))||b.validateLitc(s.last(e))},b.redraw=function(e,t,n,r,i,o){if(b.internal.redrawing&&!o)return b.internal.queue.push([e,t,n,r]);b.internal.redrawing=!0;var a=b.responders[t],u=document.getElementById(t),s=g();if(!(b.prod||u&&document.body.contains(u)))return b.error(e,"B.redraw","Attempt to redraw dangling element.",{responder:a});var c=[b.prediff(n),b.prediff(a.elem)],f=g(),o=b.diff(c[0],c[1]),n=g();if(y.go(r,function(e){b.forget(e)}),!1===o){c=(u=document.getElementById(t)).parentNode,r=u.nextSibling,t=l.g(a.elem,!0);c.removeChild(u),r?r.insertAdjacentHTML("beforeBegin",t):c.insertAdjacentHTML("beforeEnd",t)}else{u=b.applyDiff(u,o);if(!b.prod&&u!==undefined)return b.error(e,"B.redraw","Redraw error: DOM element missing.",{diffIndex:u,diffElement:o[u],diff:o,responder:a.id})}b.call(e,"redraw",e.path,{responder:a.id,ms:{create:i,prediff:f-s,diff:n-f,DOM:g()-n,total:g()-s+i},diffLength:!1!==o&&o.length}),y.stopNot(b.internal.queue,undefined,function(){var e=b.internal.queue.shift();if(b.responders[e[1]])return e})?b.redraw.apply(null,next.concat(!0)):b.internal.redrawing=!1},b.prediff=function(e,t){if("array"!==f(e)||"LITERAL"===e[0])return e===undefined||""===e?void 0:"L"!==t[t.length-1].substr(0,1)?t.push("L "+l.g(e,!0)):t[t.length-1]+=l.g(e,!0);if(t=t||[],-1===l.k.tags.indexOf(e[0]))return y.go(e,function(e){b.prediff(e,t)});e[1]&&e[1].id&&(e[1].id+"").match(/^в[0-9a-f]+$/g)&&t.length&&(e=b.responders[e[1].id].elem);var n,r,i="object"!==f(e[1])?undefined:y.obj(e[1],function(e,t){if(-1===["",null,!1,undefined].indexOf(e))return[t,e]}),o=e[i?2:1];if(t.push("O "+e[0]),i&&(t[t.length-1]+=" "+JSON.stringify(i)),i&&i.opaque){i=t[t.length-1].length;return t[t.length-1]="P "+i+t[t.length-1].slice(1)+" "+l.g(o,!0),t}return"table"===e[0]&&(n=t.length),b.prediff(o,t),"table"===e[0]&&t[n]&&(t[n].match(/^O thead/)&&(r=0,y.stopNot(y.times(t.length-n,n),undefined,function(e){if("O"===t[e].substr(0,1)&&r++,"C"===t[e].substr(0,1)&&r--,0===r)return n=e+1})),t[n]&&!t[n].match(/^O tbody/)&&(t.splice(n,0,"O tbody"),t.push("C tbody"))),t.push("C "+e[0]),t},b.applyDiff=function(r,u){var i,s=[],c=[],o={},a=r.parentNode,f=r.nextSibling,l=[r,null],d=[],e=y.stopNot(u,undefined,function(e,t){if("C"===e[1].substr(0,1))return"rem"!==e[0]&&(d.pop(),d[d.length-1]++),void("add"!==e[0]&&l.pop());if("rem"!==e[0]&&(c[t]=d.slice(),"O"===e[1].substr(0,1)?(o[c[t].join(",")]=t,d.push(0)):d[d.length-1]++),"add"!==e[0]){var n=0===t?r:l[l.length-1]?l[l.length-1].nextSibling:l[l.length-2].firstChild;if(!b.prod&&!n)return t;(s[t]=n)===document.activeElement&&(i=n),l[l.length-1]=n,"O"===e[1].substr(0,1)&&l.push(null)}});if(e!==undefined)return e;var p=function(e,t){return"tag"===t?e.match(/(O|P) [^\s]+/)[0].replace(/(O|P) /,""):e.match("{")?JSON.parse(e.replace(/[^{]+/,"")):{}},g=function(e,t,n){var r=0===t.length?a:s[o[t.slice(0,-1).join(",")]];"keep"===e&&r.children[t[t.length-1]]===n||(t=r===a?f:r.children[t[t.length-1]]||null,r.insertBefore(n,t))},h=function(e){if("L"===e.substr(0,1)){var t=document.createElement("div");return t.innerHTML=e.slice(2),t.firstChild}var n;"P"===e.substr(0,1)&&(t=parseInt(e.match(/ \d+ /)[0].replace(/\s/g,"")),n=(e=e.replace(t+" ","")).slice(t+1),e=e.slice(0,t));var r=document.createElement(p(e,"tag"));return y.go(p(e,"attributes"),function(e,t){-1===["",null,!1].indexOf(e)&&r.setAttribute(t,e)}),"P"===e.substr(0,1)&&(r.innerHTML=n),r},m={};y.go(u,function(e,t){var n=e[1].substr(0,1);if("C"!==n){if("keep"===e[0]){if("P"!==n)return g("keep",c[t],s[t]);s[t].parentNode.removeChild(s[t])}if("rem"===e[0])return"O"===n&&(m[p(e[1],"tag")]=t),s[t].parentNode.removeChild(s[t]);if("O"!==n)return g("add",c[t],h(e[1]));var r,i,o,a=p(e[1],"tag"),n=m[a];n===undefined?r=h(e[1]):(i=s[n],n=u[n][1],e=e[1],n=p(n,"attributes"),o=p(e,"attributes"),y.go(o,function(e,t){-1===["",null,!1].indexOf(e)&&i.setAttribute(t,e)}),y.go(n,function(e,t){-1===["",null,!1].indexOf(e)&&-1!==["",null,!1,undefined].indexOf(o[t])&&i.removeAttribute(t)}),r=i,m[a]=undefined),s[t]=r,g("add",c[t],r)}}),i&&document.body.contains(i)&&(i.focus?i.focus():i.setActive())},b.diff=function(t,e){for(var n,r,i,o,a,u,s,c,f,l=[],d=0,p=g();d<t.length+e.length+1;){if(b.internal.timeout&&g()-p>b.internal.timeout)return!1;for(n=l[l.length-1]||{1:[0,0]},r={},l.push(r),i=-d;i<2*d-d+1;){for(a=(o=i===-d||i!==d&&n[i-1][1]<n[i+1][1]?[0,n[i+1][1]]:[0,n[i-1][1]+1,!0])[1]-i;o[1]<t.length&&a<e.length&&t[o[1]]===e[a];)o[1]++,a++,o[0]++;if(!((r[i]=o)[1]<t.length||a<e.length)){for(u={x:o[1],y:a},s=[],c=d;-1<c;)a=(f=l[c][u.x-u.y])[1]-(u.x-u.y),f[0]&&y.go(y.times(f[0]),function(e){s.unshift(["keep",t[f[1]-e]])}),f[2]?s.unshift(["rem",t[f[1]-f[0]-1]]):s.unshift(["add",e[a-f[0]-1]]),u.x=f[1]-f[0]-(f[2]?1:0),u.y=a-f[0]-(f[2]?0:1),c--;return s.shift(),s}i+=2}d++}}}();