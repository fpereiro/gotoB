!function(){if("object"==typeof exports)var c=exports;else c=window.dale={};var d=function(e,t){var r=typeof e;return"object"!==r&&"number"!==r?r:e instanceof Array?"array":"number"===r?isNaN(e)?"nan":isFinite(e)?e%1==0?"integer":"float":"infinity":"array"===(r=Object.prototype.toString.call(e).replace("[object ","").replace("]","").toLowerCase())||"date"===r||"null"===r?r:"regexp"===r?"regex":t?r:"object"},e=function(l){return function(e,t,r,n){if("do"===l)var o=t,i=!0===r,a=[],s=0;else if("fil"===l)o=r,i=!0===n,a=[],s=0;else if("obj"!==l)o=r,i=!0===n;else if("object"===d(t))o=r,i=!0===n,a=t;else o=t,i=!0===r,a={};if("function"!==d(o))return console.log(("do"===l||"obj"===l&&"object"!==d(t)?"Second":"Third")+" argument passed to dale."+l+" must be a function but instead is",o,"with type",d(o)),!1;if(void 0===e)return a;var u=d(e);for(var c in"array"===u||("object"===u?"[object Arguments]"===Object.prototype.toString.call(e)&&(u="array",e=[].slice.call(e)):(u="array",e=[e])),e){if("array"===u)c=parseInt(c);else if(!i&&!Object.prototype.hasOwnProperty.call(e,c))continue;var f=o(e[c],c);if("do"===l)a[s++]=f;else if("fil"===l)f!==t&&(a[s++]=f);else if("stop"===l){if(f===t)return f;a=f}else if("stopNot"===l){if(f!==t)return f;a=f}else{if(void 0===f)continue;if("array"!==d(f))return void console.log("Value returned by fun must be an array but instead is of type "+d(f));a[f[0]]=f[1]}}return a}};c.do=e("do"),c.fil=e("fil"),c.obj=e("obj"),c.stop=e("stop"),c.stopNot=e("stopNot"),c.keys=function(e,t){return c.do(e,function(e,t){return t},t)},c.times=function(e,t,r){if(0===e)return[];if(!("integer"!==d(e)||e<0)){if(void 0===t)t=1;else if("integer"!==d(t)&&"float"!==d(t))return void console.log("start must be an integer or float.");if(void 0===r)r=1;else if("integer"!==d(r)&&"float"!==d(r))return void console.log("step must be an integer or float.");for(var n=[t];n.length<e;)t+=r,n.push(t);return n}console.log("steps must be a positive integer or zero.")},c.acc=function(e,t,r,n){var o=arguments.length===("boolean"===d(arguments[arguments.length-1])?4:3),i=o?t:void 0,a=o?r:t,s=o?n:r;if("function"!==d(a))return console.log("fun must be a function but instead is of type",d(a)),!1;var u=!0;return c.do(e,function(e,t){if(!o&&u)return u=!1,i=e;i=a(i,e)},s),i}}(),function(){var r="object"==typeof exports,m=r?require("dale"):window.dale;if(r)var b=exports;else b=window.teishi={};b.t=function(e,t){var r=typeof e;return"object"!==r&&"number"!==r?r:e instanceof Array?"array":"number"===r?isNaN(e)?"nan":isFinite(e)?e%1==0?"integer":"float":"infinity":"array"===(r=Object.prototype.toString.call(e).replace("[object ","").replace("]","").toLowerCase())||"date"===r||"null"===r?r:"regexp"===r?"regex":t?r:"object"},b.s=function(){try{return JSON.stringify.apply(JSON.stringify,arguments)}catch(e){return!1}},b.p=function(){try{return JSON.parse.apply(JSON.parse,arguments)}catch(e){return!1}},b.simple=function(e){var t=b.t(e);return"array"!==t&&"object"!==t},b.complex=function(e){return!b.simple(e)},b.last=function(e){return"array"===b.t(e)&&e[e.length-1]},b.c=function(e,n,o){if(b.simple(e))return e;n=n||["$root"],o=o||[n,e];var t=b.t(e,!0),i="array"===t||"arguments"===t?[]:{};return m.do(e,function(r,e){if(b.simple(r))return i[e]=r;var t=m.stopNot(o,void 0,function(e,t){if(t%2!=0&&r===e)return o[t-1]});if(!t)return o.push(n.concat([e]))&&o.push(r),i[e]=b.c(r,n.concat([e]),o.concat());i[e]="CIRCULAR REFERENCE: "+t.join(".")}),i},b.eq=function(e,r){return b.simple(e)&&b.simple(r)?e===r:b.t(e,!0)===b.t(r,!0)&&(b.s(m.keys(e).sort())===b.s(m.keys(r).sort())&&!1!==m.stop(e,!1,function(e,t){return b.eq(e,r[t])}))},b.time=function(){return(new Date).getTime()};var n,f=function(){return r?"[0m":""},l=function(){return r?"[1m":""},d=function(){return r?"[37m":""},p=function(e){if(!r)return"";for(var t=n;n===t;)t=Math.round(5*Math.random()+1);return"["+(e?"4":"3")+(n=t)+"m"};b.l=function(){var c=l();return function o(e,i){var a=b.t(e),s=(i=i||0,!0);"object"===a&&"[object Arguments]"===Object.prototype.toString.call(e)&&(a="array");var u=i<2?"":"\n"+m.do(m.times(i-1),function(e){return"   "}).join("");0<i&&(c+="array"===a?d()+"[":d()+"{"),m.do(e,function(e,t){var r=b.t(e);if(0===i&&0===t&&("string"===r||"integer"===r))return c+=p(!(s=!1))+e+":"+f()+l();if(s||(c+=d()+(0===i?" ":", ")),s=!1,"string"===r&&0<i&&(e="'"+e+"'"),"function"===r){var n=(e+="").match(/\s+(?=}$)/);null!==n&&(e=e.replace(new RegExp(n[0],"g"),"\n")),150<e.length&&(e=e.slice(0,150)+"...\n"),1<i&&(e=e.replace(/\n/g,"array"===a?u:"\n"+(t+": ").replace(/./g," ")+u.slice(1)))}c+=p(),"object"===a&&(c+=u+(t.match(/^[0-9a-zA-Z_]+$/)?t:"'"+t+"'")+": "),"array"===r||"object"===r?o(e,i+1):c+="object"===a?e:u+e}),0<i&&("array"===a&&(c+=(1<i?"\n":"")+u.slice(4)+d()+"]"),"object"===a&&(c+=(1<i?"\n":"")+u.slice(4)+d()+"}"))}(b.c(arguments)),console.log("("+(new Date).toISOString()+")",c+f()),!1},b.lno=function(){r=!1},b.makeTest=function(c,f){if("function"!==b.t(c))return b.l("teishi.makeTest","fun passed to teishi.makeTest should be a function but instead is",c,"with type",b.t(c));if("string"===b.t(f)&&(f=[f]),"array"!==b.t(f))return b.l("teishi.makeTest","clauses argument passed to teishi.makeTest should be an array but instead is",f,"with type",b.t(f));if("string"!==b.t(f[0]))return b.l("teishi.makeTest","shouldClause passed to teishi.makeTest should be a string but instead is",f[0],"with type",b.t(f[0]));if(void 0!==f[1]&&("array"!==b.t(f[1])&&(f[1]=[f[1]]),!0!==m.stopNot(f[1],!0,function(e){var t=b.t(e);return"string"===t||"function"===t||b.l("teishi.makeTest","Each finalClause passed to teishi.makeTest should be a string or a function but instead is",e,"with type",t)})))return;return function(e,t,r,n,o,i){var a=c(r,n);if(!0===a)return!0;if("array"===b.t(a))return a;var s=[],u=0;return void 0!==o&&(s[u++]="each of the"),t[0]&&(s[u++]=t[0]),e&&(s[u++]="passed to",s[u++]=e),s[u++]=f[0],void 0!==i&&(s[u++]="one of"),s[u++]=void 0!==i?i:n,t[1]&&(s[u++]="("+t[1]+")"),s[u++]=void 0!==o?"but one of":"but instead",void 0!==o&&(s[u++]=o),s[u++]="is",s[u++]=r,m.do(f[1],function(e){s[u++]="function"!=typeof e?e:e(r,n)}),s}},b.test={type:b.makeTest(function(e,t){return b.t(e)===t},["should have as type",["with type",b.t]]),equal:b.makeTest(b.eq,"should be equal to"),notEqual:b.makeTest(function(e,t){return!b.eq(e,t)},"should not be equal to"),range:b.makeTest(function(r,e){return"object"!==b.t(e,!0)?["Range options object must be an object but instead is",e,"with type",b.t(e,!0)]:"{}"===b.s(e)||m.stopNot(e,!0,function(e,t){return"min"!==t&&"max"!==t&&"less"!==t&&"more"!==t?['Range options must be one of "min", "max", "less" and "more", but instead is',t]:"min"===t?e<=r:"max"===t?r<=e:"less"===t?r<e:e<r})},"should be in range"),match:b.makeTest(function(e,t){return"string"!==b.t(e)?["Invalid comparison string passed to teishi.test.match. Comparison string must be of type string but instead is",e,"with type",b.t(e)]:"regex"!==b.t(t)?["Invalid regex passed to teishi.test.match. Regex must be of type regex but instead is",t,"with type",b.t(t)]:null!==e.match(t)},"should match")},b.validateRule=function(n){var e=b.t(n);if("function"===e||"boolean"===e)return!0;if("array"!==e)return["each teishi rule must be an array or boolean or function but instead is",n,"with type",e];var o,i,t=b.t(n[0]);return"string"!==t&&("array"!==t||2!==n[0].length||"string"!==b.t(n[0][0])||"string"!==b.t(n[0][1]))||(3===n.length||(n.length<3||5<n.length?["Each teishi simple rule must be an array of length between 3 and 5, but instead is",n,"and has length",n.length]:m.stopNot(n,!0,function(e,t){if(t<3)return!0;var r=b.t(e);if("string"===r){if("oneOf"!==e&&"each"!==e&&"eachOf"!==e)return["Invalid multi parameter",e,". Valid multi parameters are",["oneOf","each","eachOf"]];if(i)return["You can pass only one multi parameter to a teishi simple rule but instead you passed two:",n[3],"and",n[4]];i=e}else{if("function"!==r)return["Elements #4 and #5 of a teishi simple rule must be either a string or a function, but element","#"+(t+1),"is",e,"and has type",r];if(o)return["You can pass only one test function to a teishi simple rule but instead you passed two:",n[3],"and",n[4]];o=e}return!0})))};var y=function(e,t){return void 0===t?b.l.apply(b.l,["teishi.v"].concat(e)):(e=m.do(e,function(e){return b.complex(e)?b.s(e):e+""}).join(" "),!0===t?e:(t(e),!1))};b.v=function(e,t,r){if("string"===b.t(e))var n=e,o=t,i=r;else n="",o=e,i=t;if(void 0!==i&&!0!==i&&"function"!==b.t(i))return b.l("teishi.v","Invalid apres argument. Must be either undefined, true, or a function.");var a=b.validateRule(o);if(!0!==a)return y(a,i);var s=b.t(o);if("boolean"===s)return o;if("function"===s)return b.v(n,o(),i);if(0===o.length)return!0;var u=b.t(o[0]);if("boolean"===u&&2===o.length&&"array"===b.t(o[1]))return!1===o[0]||b.v(n,o[1],i);if("string"!==u&&("array"!==u||2!==o[0].length||"string"!==b.t(o[0][0])||"string"!==b.t(o[0][1])))return m.stopNot(o,!0,function(e){return b.v(n,e,i)});var c,f=b.t(o[3]),l=b.t(o[4]),d="function"===f?o[3]:"function"===l?o[4]:b.test.type,p="string"===f?o[3]:"string"===l?o[4]:void 0,g="array"===u?o[0]:[o[0]],h=b.t(o[1],!0),v=b.t(o[2],!0);return("each"===p||"eachOf"===p)&&("array"===h&&0===o[1].length||"object"===h&&0===Object.keys(o[1]).length||void 0===o[1])||(!0===(c="oneOf"!==p&&"eachOf"!==p||!("array"===v&&0===o[2].length||"object"===v&&0===Object.keys(o[2]).length||void 0===o[2])?void 0===p?d(n,g,o[1],o[2]):"each"===p?m.stopNot(o[1],!0,function(e){return d(n,g,e,o[2],o[1])}):"oneOf"===p?m.stop(o[2],!0,function(e){return d(n,g,o[1],e,void 0,o[2])}):m.stopNot(o[1],!0,function(t){return m.stop(o[2],!0,function(e){return d(n,g,t,e,o[1],o[2])})}):["To field of teishi rule is",o.to,"but multi attribute",p,"requires it to be non-empty, at teishi step",o])||y(c,i))},b.stop=function(){return!0!==b.v.apply(b.v,arguments)}}(),function(){var e="object"==typeof exports,s=e?require("dale"):window.dale,o=e?require("teishi"):window.teishi;if(e)var u=exports;else u=window.lith={};var c=o.t,i=o.l;u.k={lithbagElements:["string","integer","float","array","undefined"],tags:["!DOCTYPE HTML","LITERAL","a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","command","datalist","dd","del","details","dfn","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"],voidTags:["!DOCTYPE HTML","area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]},u.entityify=function(e,t){return!(!t&&o.stop("lith.entityify",["Entityified string",e,"string"]))&&e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/`/g,"&#96;")},u.v=function(t){var e=c(t);if("array"!==e||"string"!==c(t[0])||-1===u.k.tags.indexOf(t[0]))return!!o.v([["lithbag",e,u.k.lithbagElements,"oneOf",o.test.equal],["array"===e,["lithbag elements",t,u.k.lithbagElements,"eachOf"]]],function(e){i("lith.v - Invalid lithbag",{error:e,"original input":t})})&&"Lithbag";var r="object"===c(t[1])?t[1]:void 0,n=t[r?2:1];return!!o.v([["lith length",t.length,{min:1,max:3},o.test.range],[void 0===r,["length of lith without attributes",t.length,{max:2},o.test.range]],[["lith attribute keys","start with an ASCII letter, underscore or colon, and be followed by letters, digits, underscores, colons, periods, dashes, extended ASCII characters, or any non-ASCII characters."],s.keys(r),/^[a-zA-Z_:][a-zA-Z_:0-9.\-\u0080-\uffff]*$/,"each",o.test.match],["lith attribute values",r,["string","integer","float","undefined","null","boolean"],"eachOf"],["lith contents",n,u.k.lithbagElements,"oneOf"]],function(e){i("lith.v - Invalid lith",{error:e,"original input":t})})&&"Lith"},u.g=function(e,t){if(t||u.prod)return!0!==(t||u.prod)?i("lith.g","prod or lith.prod must be true or undefined."):"array"===c(e)&&-1!==u.k.tags.indexOf(e[0])?u.generateLith(e,!0):u.generateLithbag(e,!1,!0);var r=u.v(e);return!!r&&u["generate"+r](e)},u.generateLithbag=function(e,r,n){var o="";return!1!==s.stop(e,!1,function(e){if(void 0!==e){c(e);if("array"!==c(e))return o+=r?e:u.entityify(e+"",n);if(n)o+=u.g(e,n);else{var t=u.g(e,n);if(!1===t)return!1;o+=t}}})&&o},u.generateLith=function(e,r){var t="object"===c(e[1])?e[1]:void 0,n=e[t?2:1];if("LITERAL"===e[0])return n;var o="<"+e[0];if(s.do(t,function(e,t){(e||0===e)&&(o+=" "+u.entityify(t+"",r)+'="'+u.entityify(e+"",r)+'"')}),o+=">","array"===c(n))if(r)o+="style"===e[0]?u.css.g(n):u.g(n,r);else{var i="style"===e[0]?u.css.g(n):u.g(n);if(!1===i)return!1;o+=i}else o+=u.generateLithbag(n,"style"===e[0]||"script"===e[0],r);return-1===u.k.voidTags.indexOf(e[0])&&(o+="</"+e[0]+">"),o},u.css={},u.css.v=function(t){if(o.stop(["litc or litcbag",t,"array"],function(e){i("lith.css.v - Invalid litc or litcbag",{error:e,"original input":t})}))return!1;if(0===t.length||"array"===c(t[0]))return!0;var e="object"===c(t[1])?t[1]:void 0,r=t[e?2:1];return o.v([["litc length",t.length,{min:1,max:3},o.test.range],[void 0===e,["length of litc without attributes",t.length,{max:2},o.test.range]],["litc selector",t[0],"string"],u.css.vAttributes(e),["LITERAL"!==t[0],["litc contents",r,["undefined","array"],"oneOf"]]],function(e){i("lith.css.v - Invalid litc",{error:e,"original input":t})})},u.css.vAttributes=function(e){return o.v([["litc attribute values",e,["string","integer","float","object","undefined","null","boolean"],"eachOf"]])},u.css.g=function(e,n){if(!1===u.css.v(e))return!1;if(0===e.length)return"";var o="";if("LITERAL"===e[0])return e[1];if("array"===c(e[0]))return!1!==s.stop(e,!1,function(e,t){var r=u.css.g(e,n);if(!1===r)return!1;o+=r})&&o;void 0===n&&(n="");var t="object"===c(e[1])?e[1]:void 0,r=e[t?2:1];n=s.do(n.split(/,\s*/),function(t){return s.do(e[0].split(/,\s*/),function(e){return e.match(/&/)?e.replace("&",t):t+(0===t.length?"":" ")+e}).join(", ")}).join(", "),o+=n+"{";var i=function(e){return!1!==u.css.vAttributes(e)&&s.stop(e,!1,function(t,e){if(t||0===t){var r=c(t);if("object"===r)return i(t);"integer"===r&&(t<0||1<t)&&(t+="px"),"float"!==r&&1!==t||(t=100*t+"%"),s.do(e.split(/,\s*/),function(e){o+=e+":"+t+";"})}})};if(!1===i(t))return!1;if(o+="}",r){var a=u.css.g(r,n);if(!1===a)return!1;o+=a}return o},u.css.media=function(e,t){return!o.stop(["selector",e,"string"])&&[["LITERAL","@media "+e+" {"],t,["LITERAL","}"]]}}(),function(){var e="object"==typeof exports,o=e?require("dale"):window.dale,i=e?require("teishi"):window.teishi,s=i.t,u=i.l,t=function(e){if(!i.stop([["store",e,["array","object","undefined"],"oneOf"]])){var a={routes:{}};return a.store=e||{},a.do=function(){var e="object"===s(arguments[0])?arguments[0]:void 0,t=arguments[e?1:0],r=arguments[e?2:1];i.simple(r)&&(r=[r]);var n=[e||{},t,r].concat([].slice.call(arguments,e?3:2));return!i.stop("r.do",[[void 0!==e,[function(){return[["x.from",e.from,["array","object","undefined"],"oneOf"],["array"===s(e.from),[function(){return["x.from",e.from,"object","each"]}]]]}]],["verb",t,"string"],a.isPath(r,"r.do")])&&(a.mill.apply(null,n),!0)},a.listen=function(){var e,t=arguments[arguments.length-1];if(arguments.length<2)return u("r.listen","Too few arguments passed to r.listen");if(2===arguments.length?e=arguments[0]:((e=3===arguments.length?{}:arguments[2]).verb=arguments[0],e.path=arguments[1]),i.simple(e.path)&&(e.path=[e.path]),i.stop("r.listen",[["options",e,"object"],["keys of options",o.keys(e),["verb","path","id","parent","priority","burn","match"],"eachOf",i.test.equal],function(){return[["options.verb",e.verb,["string","regex"],"oneOf"],a.isPath(e.path,"r.listen",!0),["options.id",e.id,["string","integer","undefined"],"oneOf"],["options.parent",e.parent,["string","integer","undefined"],"oneOf"],["options.priority",e.priority,["undefined","integer"],"oneOf"],["options.burn",e.burn,["undefined","boolean"],"oneOf"],["options.match",e.match,["undefined","function"],"oneOf"]]},["route function",t,"function"]]))return!1;if(e.id){if(a.routes[e.id])return u("r.listen","A route with id",e.id,"already exists.")}else e.id=a.random();return e.rfun=t,(a.routes[e.id]=e).id},a.forget=function(r,n){if(void 0!==n&&"function"!==s(n))return u("Second argument to r.forget must be a function or undefined.");if(!a.routes[r])return u("Route",r,"does not exist.");var e=a.routes[r];delete a.routes[r],n&&n(e),o.do(a.routes,function(e,t){e.parent===r&&a.forget(t,n)})},a.isPath=function(e,t,r){return i.v(t,[["path",e,["array","integer","string"].concat(r?"regex":[]),"oneOf"],["path",e,["integer","string"].concat(r?"regex":[]),"eachOf"]])},a.random=function(){return Math.random().toString(16).slice(2)},a.compare=function(e,t){return"*"===e||"*"===t||("regex"===s(e)?null!==(t+"").match(e):e===t)},a.mill=function(e,t,r){var n;(n=e.from?"object"===s(e.from)?[e.from]:e.from.slice(0):[]).unshift({date:(new Date).toISOString(),verb:t,path:r});var o=[{verb:t,path:r,from:n}].concat([].slice.call(arguments,3));3<arguments.length&&(o[0].args=[].slice.call(arguments,3),n[0].args=[].slice.call(arguments,3));var i=function(e){if(0!==e.length){o[0].cb=function(){i(e)};var t=e.shift();if(o[0].route=t,!a.routes[t.id])return i(e);t.burn&&a.forget(t.id),"function"!==s(t.rfun.apply(null,o))&&i(e)}};i(a.sort(a.match(t,r,a.routes)))},a.match=function(t,r,e){var n=[];return o.do(e,function(e){return e.match?!0===e.match(e,{verb:t,path:r})?n.push(e):void 0:!a.compare(e.verb,t)||e.path.length>r.length?void 0:0===e.path.length?n.push(e):void(o.stop(e.path,!1,function(e,t){return a.compare(e,r[t])})&&n.push(e))}),n},a.sort=function(e){return e.sort(function(e,t){return(t.priority||0)-(e.priority||0)})},a}};e?module.exports=t:window.R=t}(),function(){if("object"==typeof exports)return console.log("cocholate only works in a browser!");var a=window.dale,s=window.teishi,i=s.t,u=window.c=function(e,t){if(s.stop("c",["fun",t,["function","undefined"],"oneOf"]))return!1;var r=u.find(e);if(!1===r)return!1;if(t){var n=s.c(arguments).slice(2);r=a.do(r,function(e){return t.apply(void 0,[e].concat(n))})}return"string"===i(e)&&e.match(/^[a-z]*#[^\s\[>,:]+$/)?r[0]:r};u.nodeListToArray=function(e){return[].slice.call(e)},u.setop=function(e,t,r){if("and"===e)return a.fil(t,void 0,function(e){return-1!==r.indexOf(e)?e:void 0});var n=t.slice();return"or"===e?a.do(r,function(e){-1===n.indexOf(r)&&n.push(e)}):(0===n.length&&(n=u.nodeListToArray(document.getElementsByTagName("*"))),a.do(r,function(e){var t=n.indexOf(e);-1!==t&&n.splice(t,1)})),n},u.find=function(e){var t=i(e);if(s.stop("cocholate",[["selector",e,["array","string","object"],"oneOf"],function(){return[["array"===t,["first element of array selector",e[0],[":and",":or",":not"],"oneOf",s.test.equal]],["object"===t,[["selector keys",a.keys(e),["selector","from"],"eachOf",s.test.equal],["valid HTML node",e.from,"undefined",s.test.notEqual],function(){return[["from.querySelectorAll","valid HTML node"],e.from.querySelectorAll,"function"]}]]]}]))return!1;if("string"===t)return u.nodeListToArray(document.querySelectorAll(e));if("object"===t)return u.nodeListToArray(e.from.querySelectorAll(e.selector));var n=e.shift(),o=[];return a.stop(e,!1,function(e,t){var r=u.find(e);if(!1===r)return o=!1;o=0===t&&":not"!==n?r:u.setop(n.replace(":",""),o,r)}),o},u.empty=function(e){u(e,function(e){a.do(u.nodeListToArray(e.getElementsByTagName("*")),function(e){e.remove()})})},u.fill=function(e,t){if(s.stop("c.fill",["html",t,"string"]))return!1;u.empty(e),u(e,function(e){e.innerHTML=t})},u.place=function(e,t,r){if(s.stop("c.place",[["where",t,["beforeBegin","afterBegin","beforeEnd","afterEnd"],"oneOf",s.test.equal],["html",r,"string"]]))return!1;u(e,function(e){e.insertAdjacentHTML(t,r)})},u.get=function(e,r,n){return!s.stop("c.get",["attributes",r,["string","array"],"oneOf"])&&u(e,function(t){return a.obj(r,function(e){return n?[e,t.style[e]||null]:[e,t.getAttribute(e)]})})},u.set=function(e,t,n,o){if(s.stop("c.set",[["attributes",t,"object"],[["attribute keys","start with an ASCII letter, underscore or colon, and be followed by letters, digits, underscores, colons, periods, dashes, extended ASCII characters, or any non-ASCII characters."],a.keys(t),/^[a-zA-Z_:][a-zA-Z_:0-9.\-\u0080-\uffff]*$/,"each",s.test.match],["attribute values",t,["integer","string","null"],"eachOf"]]))return!1;u(e,function(r){a.do(t,function(e,t){n?r.style[t]=null===e?"":e:null===e?r.removeAttribute(t):r.setAttribute(t,e)}),r.onchange&&!o&&r.onchange()})},u.ready=function(e){if(document.addEventListener)return document.addEventListener("DOMContentLoaded",e);document.attachEvent?document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&e()}):e()},u.cookie=function(e){return!1===e?a.do(document.cookie.split(/;\s*/),function(e){return document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()),e}):a.obj((e||document.cookie).split(/;\s*/),function(e){if(""!==e)return[(e=e.split("="))[0],e.slice(1).join("=")]})},u.ajax=function(e,t,r,n,o){if(e=e||"GET",n=n||"",r=r||{},o=o||function(){},s.stop("c.ajax",[["method",e,"string"],["path",t,"string"],["headers",r,"object"],["callback",o,"function"]]))return!1;var i=new XMLHttpRequest;return i.open(e.toUpperCase(),t,!0),s.complex(n)&&"formdata"!==s.t(n,!0)&&(r["content-type"]=r["content-type"]||"application/json",n=s.s(n)),a.do(r,function(e,t){i.setRequestHeader(t,e)}),i.onreadystatechange=function(){if(4===i.readyState){if(200!==i.status)return o(i);var t,e={xhr:i,headers:a.obj(i.getAllResponseHeaders().split("\r\n"),function(e){return(e=e.split(/:\s+/))[0].match(/^content-type/i)&&e[1].match("application/json")&&(t=!0),e})};e.body=t?s.p(i.responseText):i.responseText,o(null,e)}},i.send(n),{headers:r,body:n,xhr:i}},u.polyfill=function(){var u=function(){return document.createElement("_")};u().insertAdjacentHTML||(HTMLElement.prototype.insertAdjacentHTML=function(e,t){var r,n,o,i=this,a=u(),s=i.parentNode;if(a.innerHTML=t,"beforeBegin"===e)for(;r=a.firstChild;)s.insertBefore(r,i);else if("afterBegin"===e)for(n=i.firstChild;r=a.lastChild;)i.insertBefore(r,n);else if("beforeEnd"===e)for(;r=a.firstChild;)i.appendChild(r);else for(o=i.nextSibling;r=a.lastChild;)s.insertBefore(r,o)}),Element.prototype.remove||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(r,e){var t=a.stopNot(e?this.slice(e):this,void 0,function(e,t){if(r===e)return t});return void 0===t?-1:t})},u.polyfill()}(),function(){if("object"==typeof exports)return console.log("gotoB only works in a browser!");var O=window.dale,k=window.teishi,c=window.lith,T=(window.R,window.c),A=window.B,N=k.t,L=k.l,f=window.R();(A=window.B={v:"1.2.4",B:"в",r:f,routes:f.routes,store:f.store,do:f.do,listen:f.listen,forget:f.forget}).eventlog=[],A.listen({id:"eventlog",verb:"*",path:[]},function(e){A.eventlog.unshift({verb:e.verb,path:e.path,from:e.from}),1<arguments.length&&(A.eventlog[0].args=[].slice.call(arguments,1)),A.verbose&&L("B.eventlog event #"+A.eventlog.length,A.eventlog[0])}),A.add=function(e){if(!A.prod&&!f.isPath(e,"B.add"))return!1;void 0===A.get(e)&&A.set(e,[]);var r=A.get(e);return"array"!==N(r)?L("B.add","Cannot add to something that is not an array."):(O.do(arguments,function(e,t){0!==t&&r.push(e)}),!0)},A.rem=function(e){if(!A.prod&&!f.isPath(e,"B.rem"))return!1;var t=A.get(e),r=N(t),n="array"===N(arguments[1])?arguments[1]:O.do(arguments,function(e){return e}).slice(1);return!(!A.prod&&k.stop([["target",t,["array","object"],"oneOf"],"array"===r?["keys of array target",n,"integer","each"]:["keys of object target",n,"string","each"]]))&&("array"===r?(n.sort(function(e,t){return t-e}),O.do(n,function(e){t.splice(e,1)})):O.do(n,function(e){delete t[e]}),!0)},A.get=function(r){if(r="array"===N(r)?r:O.do(arguments,function(e){return e}),A.prod||f.isPath(r,"B.get")){var n=A.store;return!1===O.stop(r,!1,function(e,t){if(t+1<r.length&&k.simple(n[e]))return!1;n=n[e]})?void 0:n}},A.set=function(n,o,i){if(!A.prod&&!f.isPath(n,"B.set"))return!1;var a=A.store;return"array"!==N(n)&&(n=[n]),!O.stop(n,!0,function(e,t){if(t+1!==n.length){var r="string"===N(n[t+1])?"object":"array";if(N(a[e])!==r){if(void 0!==a[e]&&!i)return L("B.set didn't overwrite a parent because of type mismatch. Pass a truthy third argument to force this behavior. Path",n),!0;a[e]="object"===r?{}:[]}a=a[e]}else a[e]=o})},O.do(["add","rem","set"],function(e){A.listen({id:e,verb:e,path:[]},function(t,e){if("set"===t.verb)var r=A.get(t.path);if(!0===A[t.verb].apply(null,[t.path].concat([].slice.call(arguments,1)))){if("add"===t.verb||"rem"===t.verb){A.do(t,"change",t.path);var n=[].slice.call(arguments,1);"add"===t.verb&&O.do(O.times(n.length,A.get(t.path).length-n.length),function(e){A.do(t,"change",t.path.concat(e))}),"rem"===t.verb&&("array"===N(n[0])&&(n=n[0]),O.do(n,function(e){A.do(t,"change",t.path.concat(e))}))}"set"!==t.verb||k.eq(r,e)||A.do(t,"change",t.path)}})}),A.str=function(e){var t=N(e);if(k.simple(e))return"string"===t?JSON.stringify(e):e+"";var r="array"===t?"[":"{";return r+="array"===t?O.do(e,A.str).join(", "):O.do(e,function(e,t){return JSON.stringify(t)+": "+A.str(e)}).join(", "),r+="array"===t?"]":"}"},A.ev=function(){var e=1===arguments.length?{}:arguments[0],t=1===arguments.length?arguments[0]:arguments[1];if("array"===N(t)&&"string"===N(t[0])&&(t=[t]),!A.prod&&k.stop("B.ev",[["attrs",e,"object"],["evs",t,"array"],["evs",t,"array","each"],function(){return O.do(t,function(e){return[["ev.ev",e[0],"string"],["ev.verb",e[1],"string"],f.isPath(e[2],"B.ev")]})}]))return!1;var r={},o=k.c(e);return O.do(t,function(t){O.do(t[0].split(/,\s*/),function(e){r[e]?r[e].push(t):r[e]=[t]})}),O.obj(r,e,function(e,t){var n="";return O.do(e,function(e){var r=[JSON.stringify(e[1]),JSON.stringify(e[2])];e.length<4&&(e[3]={rawArgs:"this.value"}),O.do(e.slice(3),function(e){if("object"===N(e)){var t=O.keys(e);-1===t.indexOf("args")&&-1===t.indexOf("rawArgs")?r=r.concat(A.str(e)):(-1!==t.indexOf("args")&&("object"!==N(e.args)&&void 0!==e.args||(e.args=[e.args]),r=r.concat(O.do(e.args,A.str))),-1!==t.indexOf("rawArgs")&&(r=r.concat(e.rawArgs)))}else r=r.concat(A.str(e))}),n+='B.do ({from: {ev: "'+t+'", attrs: '+A.str(o)+"}}, "+r.join(", ")+");"}),[t,n]})},A.view=function(){var e=0,t="object"===N(arguments[e])?arguments[e++]:{},n=arguments[e++],r="object"===N(arguments[e])?arguments[e++]:{},o=arguments[e];if(!A.prod&&k.stop("B.view",[f.isPath(n,"B.view"),["rfun",o,"function"],function(){return[["params.tag",r.tag,[void 0].concat(c.k.tags),"oneOf",k.test.equal],["params.attrs",r.attrs,["object","undefined"],"oneOf"],["params.listen",r.listen,["array","undefined"],"oneOf"],["params.ondraw",r.ondraw,["function","undefined"],"oneOf"],["params.onforget",r.onforget,["function","undefined"],"oneOf"],function(){return[void 0!==r.attrs,["params.attrs.id",(r.attrs||{}).id,"undefined"]]}]}]))return!1;r.attrs=r.attrs||{};var i=r.attrs.id="в"+A.count++;r.attrs["path-в"]=n.join?n.join(":"):n,r.listen&&0!==r.listen.length&&"array"!==N(r.listen[0])&&(r.listen=[r.listen]);var a=[];if(!1===O.stop(r.listen,!1,function(e,t){if(O.stopNot(e,void 0,function(e){if("object"===N(e)&&e.id)return e.id}))return L("B.view","Cannot pass `id` property in args to listener.");var r=A.listen.apply(null,e);if(!A.prod&&!1===r)return L("B.view","There was an error creating event listener #"+(t+1)+" on view with path: ",n),O.do(a,function(e){A.forget(e)}),!1;a.push(r),A.routes[r].parent||(A.routes[r].parent=i)}))return!1;A.listen("change",n,{id:i,priority:-1},function(e){A.resolve(e,i,function(){return e.from.unshift({ev:"redraw",id:i,path:n}),A.drawView(e,A.get(n),o)})});var s=O.obj(t,{verb:"change",path:n},function(e,t){return[t,e]}),u=A.drawView(s,A.get(n),o);return r.ondraw&&(A.routes[i].ondraw=r.ondraw),r.onforget&&(A.routes[i].onforget=r.onforget),A.routes[i].view=u[0],O.do(A.getChildren(u[1]),function(e){A.routes[e].priority--,A.routes[e].parent||(A.routes[e].parent=i)}),[r.tag||"div",r.attrs,["LITERAL",u[1]]]},A.mount=function(t,e){return!A.prod&&"string"!==N(t)||!t.match(/^(body|#[^\s]+)$/)?L("B.mount","target must be either 'body' or an id selector, but instead is "+t):A.prod||void 0!==T(t)?(e=c.g(e,A.prod),A.prod||!1!==e?(T.place(t,"afterBegin",e),void O.do(A.getChildren(e),function(e){A.routes[e]&&A.routes[e].ondraw&&A.routes[e].ondraw({from:[{ev:"mount",target:t}],route:A.routes[e]})})):L("B.mount","received invalid view.")):L("B.mount","target not found.")},A.unmount=function(t){if(!A.prod&&"string"!==N(t)||!t.match(/^(body|#[^\s]+)$/))return L("B.unmount","target must be either 'body' or an id selector, but instead is "+t);var e="body"===t?T(t)[0]:T(t);if(!A.prod&&!e)return L("B.unmount","target not found.");var r=function(e){e.onforget&&e.onforget({from:[{ev:"unmount",target:t}],route:e})},n=A.getChildren(e.innerHTML);O.do(n,function(e){A.routes[e]&&A.forget(e,r)}),O.do(n,function(e){var t=document.getElementById(e);t&&t.remove()})},A.drawView=function(e,t,r){var n=r(e,t),o=c.g(n,A.prod);return A.prod||!1!==o||(n=["pre",["Invalid lith: ",k.simple(n)?n.toString():JSON.stringify(n,null,"   ")]],o=c.g(n,A.prod)),[n,o]},A.getChildren=function(e){var t=(e||"").match(/id="в[0-9a-f]+/g)||[];return O.do(t,function(e){return e.slice(4)})},A.count=1,A.trample=200,A.resolvequeue=[],A.resolving=!1,A.perflogs=!1,A.resolve=function(s,u,c,e){if(A.resolving&&!e)return A.resolvequeue.push([s,u,c]);A.resolving=!0;var t=function(){var e,t=O.stopNot(A.resolvequeue,void 0,function(e,t){if(A.routes[e[1]])return t});if(void 0!==t)return e=A.resolvequeue[t],A.resolvequeue.splice(0,t+1),A.resolve.apply(null,e.concat(!0));A.resolving=!1};if(A.perflogs)var r={start:k.time()};var f=A.routes[u];c=c();A.perflogs&&(r.draw=k.time()-r.start);var l=document.getElementById(u),n=function(e){e.onforget&&e.onforget(s)};if(!l)return L("B.resolve","Attempted to redraw dangling view, omitting redraw & deleting route.",{route:{id:u,path:f.path},view:c[0]}),s.from.unshift({ev:"danglingView"}),A.forget(u,n),t();if(A.perflogs)var o=k.time();var d=A.diff(A.prediff(f.view),A.prediff(c[0]));if(A.perflogs&&(r.diff=k.time()-o),O.do(A.routes,function(e){e.parent===u&&e.id.match(/^в[0-9a-f]+$/)&&A.forget(e.id,n)}),!1===d)A.prod||L("diff took too long, trampling instead!",f.id),T("#"+u).innerHTML=c[1];else{var p=function(e,t,r){var n=g(t,"insert1",r);n?n.parentNode.insertBefore(e,n):g(t.slice(0,t.length-1),"insert2",r).appendChild(e)},g=function(n,o,i){var a=l;return O.do(n,function(e,t){if(!a){var r={action:o,position:i,diffitem:d[i].slice(0,2).join(" "),id:u,where:n,k:t,innerHTML:l.innerHTML,expectedHTML:c[1],oldView:f.view,newView:c[0],diff:O.obj(k.c(d),function(e,t){return[t,e]})};throw s.from.unshift({ev:"gotoB error",data:r}),L("gotoB redraw error! This could be caused by two things: 1) invalid markup; 2) a gotoB redraw bug. To eliminate the possibility of #1, check that the view being redrawn returns lith that represents valid HTML, taking particular care to not nest elements incorrectly (for example, an <h1> cannot go inside an <h1>). If you need help debugging the error, please open a pull request at http://github.com/fpereiro/gotoB/issues and paste the text below:\n",JSON.stringify(r,null,"   ")),new Error("gotoB redraw error!")}a=a.childNodes[e]}),a},i=[0],a=[0],h={add:{tag:null,index:null},rem:{tag:null,index:null}};O.do(d,function(e,t){if(!e[1].match(/^<opaque/))if(e[1].match(/^>/)||(d[t][2]={el:g(i,"sequence",t),old:k.c(i),New:k.c(a)}),e[1].match(/^</)){d[t][2].active=d[t][2].el===document.activeElement;var r=e[1].match(/[^\s]+/g)[0],n=e[1].match(/<.+ {.*"opaque":true.*}/);"add"!==e[0]||n||(h.rem.tag===r?(d[t][2].match=h.rem.index,d[h.rem.index][2].match=t,h.rem.tag=h.rem.index=null):(h.add.tag=r,h.add.index=t)),"rem"!==e[0]||n||(h.add.tag===r?(d[t][2].match=h.add.index,d[h.add.index][2].match=t,h.add.tag=h.add.index=null):(h.rem.tag=r,h.rem.index=t)),"add"!==e[0]&&i.push(0),"rem"!==e[0]&&a.push(0)}else e[1].match(/^>/)?("add"!==e[0]&&(i.pop(),i[i.length-1]++),"rem"!==e[0]&&(a.pop(),a[a.length-1]++)):("add"!==e[0]&&i[i.length-1]++,"rem"!==e[0]&&a[a.length-1]++)});var v,m={},b=[],y=[],w=[],j=[];O.do(d,function(e,t){if(!e[1].match(/^>/)){if(e[1].match(/^<opaque/)){if("rem"===e[0])return;return O.stopNot(O.times(t,t-1,-1),void 0,function(e){if("rem"!==d[e][0])return d[e]})[2].el.innerHTML=e[1].slice(7)}if("<"!==e[1][0]&&"rem"!==e[0]&&1<e[2].New.length){var r=g(e[2].New.slice(0,-1));"TEXTAREA"===r.tagName&&j.push([r,e[1]])}if("keep"===e[0])if(e[1].match(/<.+ {.*"opaque":true.*}/)&&(e[2].el.innerHTML=""),e[2].el){if(e[1].match(/<option/))JSON.parse(e[1].match(/{.+/)||"{}").selected&&b.push(e[2].el);p(e[2].el.parentNode.removeChild(e[2].el),e[2].New,t),e[2].active&&"a"!==e[1].match(/[^<\s]+/g)[0]&&(v=e[2].el)}else p(document.createTextNode(e[1]),e[2].New,t);else if(e[1].match(/^</)){if("rem"===e[0]&&(void 0===e[2].match||e[2].match>t)&&(m[e[2].old]=e[2].el.parentNode.removeChild(e[2].el)),"add"===e[0]){var n;if(void 0!==e[2].match){var o=d[e[2].match];m[o[2].old]||(m[o[2].old]=o[2].el),n=o[2].el;var i=O.obj(n.attributes,function(e){if(e&&e.specified)return[e.name,e.value]}),a=JSON.parse(e[1].match(/{.+/)||"{}");O.do(O.fil(i,void 0,function(e,t){if("string"===N(e)&&(e={name:t}),void 0===a[e.name])return e.name}),function(e){n.removeAttribute(e),-1!==["value","checked","selected"].indexOf(e)&&(n[e]="value"===e&&""),"selected"===e&&y.push(n)}),O.do(a,function(e,t){n.setAttribute(t,e),-1!==["value","checked","selected"].indexOf(t)&&(n[t]=e)}),n.attributes&&n.attributes.selected&&b.push(n),n.attributes&&n.attributes.checked&&w.push(n)}else n=document.createElement(e[1].match(/[^<\s]+/g)[0]),O.do(JSON.parse(e[1].match(/{.+/)||"{}"),function(e,t){(e||""===e||0===e)&&n.setAttribute(t,e)});p(n,e[2].New,t),e[2].el=n,o&&o[2].active&&"a"!==e[1].match(/[^<\s]+/g)[0]&&(v=n)}}else"add"===e[0]?(e[1]=e[1].replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#96;/g,"`"),p(document.createTextNode(e[1]),e[2].New,t)):e[2].el&&e[2].el.parentNode.removeChild(e[2].el);e[1].match(/<textarea/)&&"rem"!==e[0]&&j.push([e[2].el])}}),v&&(v.focus?v.focus():v.setActive(),v.blur(),v.focus?v.focus():v.setActive()),O.do(b,function(e){e.selected=!0}),O.do(y,function(e){e.selected=!1}),O.do(w,function(e){e.checked=!0});var x=O.fil(j,void 0,function(e){if(2===e.length)return e[0]});O.do(j,function(e){if(2===e.length)return e[0].value=e[1].replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#96;/g,"`");-1===x.indexOf(e[0])&&(e[0].value="")})}f.view=c[0],O.do(A.getChildren(T("#"+u).innerHTML),function(e){var t=A.routes[e];t.priority+=f.priority,t.parent||(t.parent=f.id),t.ondraw&&t.ondraw(s)}),f.ondraw&&f.ondraw(s),A.perflogs&&(r.total=k.time()-r.start,L("gotoB redraw performance",u,A.routes[u].path,r)),t()},A.prediff=function(e,t){if(k.simple(e))return void 0===e||""===e?t?void 0:[]:t?(0===t.length&&t.push(""),t[t.length-1].match(/^(<|>)/)&&t.push(""),t[t.length-1]+=c.g(e,A.prod)):[c.g(e,A.prod)];if(t=t||[],-1!==c.k.tags.indexOf(e[0])){t.push("<"+e[0]);var r="object"!==N(e[1])?void 0:O.obj(e[1],function(e,t){if(e||0===e)return[t,e]}),n=e[r?2:1];"style"===e[0]&&"array"===N(n)&&(n=c.css.g(n)),r&&(t[t.length-1]+=" "+JSON.stringify(r),r.opaque?t.push("<opaque"+c.g(n,A.prod)):void 0!==r.id&&(r.id+"").match(/^в[0-9a-f]+$/g)&&(n=A.routes[r.id].view));var o=t.length;if(r&&r.opaque||A.prediff(n,t),"table"===e[0]&&t[o]){if(t[o].match(/<thead/)){var i=0;O.stopNot(O.times(t.length-o,o),void 0,function(e){if(t[e].match(/</)&&i++,t[e].match(/>/)&&i--,0===i)return o=e+1})}t[o]&&null===t[o].match(/<tbody/)&&(t.splice(o,0,"<tbody"),t.push(">"))}t.push(">")}else O.do(e,function(e){A.prediff(e,t)});return t},A.diff=function(t,e){for(var r,n,o,i,a,s,u,c,f,l=[],d=0,p=Date.now();d<t.length+e.length+1;){if(A.trample&&Date.now()-p>A.trample)return!1;for(r=l[l.length-1]||{1:[0,0]},n={},l.push(n),o=-d;o<2*d-d+1;){for(a=(i=o===-d||o!==d&&r[o-1][1]<r[o+1][1]?[0,r[o+1][1]]:[0,r[o-1][1]+1,!0])[1]-o;i[1]<t.length&&a<e.length&&t[i[1]]===e[a];)i[1]++,a++,i[0]++;if(!((n[o]=i)[1]<t.length||a<e.length)){for(s={x:i[1],y:a},u=[],c=d;-1<c;)a=(f=l[c][s.x-s.y])[1]-(s.x-s.y),f[0]&&O.do(O.times(f[0]),function(e){u.unshift(["keep",t[f[1]-e]])}),f[2]?u.unshift(["rem",t[f[1]-f[0]-1]]):u.unshift(["add",e[a-f[0]-1]]),s.x=f[1]-f[0]-(f[2]?1:0),s.y=a-f[0]-(f[2]?0:1),c--;return u.shift(),u}o+=2}d++}}}();