!function(){if("object"==typeof exports)t=exports;else var t=window.dale={};var e=function(t,e){var n=typeof t;return"object"!==n&&"number"!==n?n:t instanceof Array?"array":"number"===n?isNaN(t)?"nan":isFinite(t)?t%1==0?"integer":"float":"infinity":(n=Object.prototype.toString.call(t).replace("[object ","").replace("]","").toLowerCase(),"array"===n||"date"===n||"null"===n?n:"regexp"===n?"regex":e?n:"object")},n=function(t){return function(n,r,i,o){if("do"===t)var a=r,s=!0===i,u=[],c=0;else if("fil"===t)var a=i,s=!0===o,u=[],c=0;else if("obj"!==t)var a=i,s=!0===o;else if("object"===e(r))var a=i,s=!0===o,u=r;else var a=r,s=!0===i,u={};if("function"!==e(a))return console.log(("do"===t||"obj"===t&&"object"!==e(r)?"Second":"Third")+" argument passed to dale."+t+" must be a function but instead is",a,"with type",e(a)),!1;if(void 0===n)return u;var l=e(n);"array"===l||("object"===l?"[object Arguments]"===Object.prototype.toString.call(n)&&(l="array"):(l="array",n=[n]));for(var f in n){if("array"===l)f=parseInt(f);else if(!s&&!Object.prototype.hasOwnProperty.call(n,f))continue;var d=a(n[f],f);if("do"===t)u[c++]=d;else if("fil"===t)d!==r&&(u[c++]=d);else if("stop"===t){if(d===r)return d;u=d}else if("stopNot"===t){if(d!==r)return d;u=d}else{if(void 0===d)continue;if("array"!==e(d))return void console.log("aValue returned by fun must be an array but instead is of type "+e(d));u[d[0]]=d[1]}}return u}};t.do=n("do"),t.fil=n("fil"),t.obj=n("obj"),t.stop=n("stop"),t.stopNot=n("stopNot"),t.keys=function(e,n){return t.do(e,function(t,e){return e},n)},t.times=function(t,n,r){if(0===t)return[];{if(!("integer"!==e(t)||t<0)){if(void 0===n)n=1;else if("integer"!==e(n)&&"float"!==e(n))return void console.log("start must be an integer or float.");if(void 0===r)r=1;else if("integer"!==e(r)&&"float"!==e(r))return void console.log("step must be an integer or float.");for(var i=[n];i.length<t;)n+=r,i.push(n);return i}console.log("steps must be a positive integer or zero.")}},t.acc=function(n,r,i,o){var a=arguments.length===("boolean"===e(arguments[arguments.length-1])?4:3),s=a?r:void 0,u=a?i:r,c=a?o:i;if("function"!==e(u))return console.log("fun must be a function but instead is of type",e(u)),!1;var l=!0;return t.do(n,function(t,e){if(!a&&l)return l=!1,s=t;s=u(s,t)},c),s}}(),function(){var t="object"==typeof exports,e=t?require("dale"):window.dale;if(t)n=exports;else var n=window.teishi={};n.t=function(t,e){var n=typeof t;return"object"!==n&&"number"!==n?n:t instanceof Array?"array":"number"===n?isNaN(t)?"nan":isFinite(t)?t%1==0?"integer":"float":"infinity":(n=Object.prototype.toString.call(t).replace("[object ","").replace("]","").toLowerCase(),"array"===n||"date"===n||"null"===n?n:"regexp"===n?"regex":e?n:"object")},n.s=function(){try{return JSON.stringify.apply(JSON.stringify,arguments)}catch(t){return!1}},n.p=function(){try{return JSON.parse.apply(JSON.parse,arguments)}catch(t){return!1}},n.simple=function(t){var e=n.t(t);return"array"!==e&&"object"!==e},n.complex=function(t){return!n.simple(t)},n.c=function(t,r,i){if(n.simple(t))return t;r=r||["$root"],i=i||[r,t];var o=n.t(t,!0),a="array"===o||"arguments"===o?[]:{};return e.do(t,function(t,o){if(n.simple(t))return a[o]=t;var s=e.stopNot(i,void 0,function(e,n){if(n%2!=0&&t===e)return i[n-1]});if(!s)return i.push(r.concat([o]))&&i.push(t),a[o]=n.c(t,r.concat([o]),i.concat());a[o]="CIRCULAR REFERENCE: "+s.join(".")}),a},n.time=function(){return(new Date).getTime()};var r,i=n.time(),o={end:function(){return t?"[0m":""},bold:function(){return t?"[1m":""},white:function(){return t?"[37m":""},color:function(e){if(!t)return"";for(var n=r;r===n;)n=Math.round(5*Math.random()+1);return r=n,"["+(e?"4":"3")+n+"m"}};n.l=function(){var t=o.bold();return function r(i,a){var s=n.t(i),a=a||0,u=!0;"object"===s&&"[object Arguments]"===Object.prototype.toString.call(i)&&(s="array");var c=a<2?"":"\n"+e.do(e.times(a-1),function(t){return"   "}).join("");a>0&&(t+="array"===s?o.white()+"[":o.white()+"{"),e.do(i,function(e,i){var l=n.t(e);if(0===a&&0===i&&("string"===l||"integer"===l))return u=!1,t+=o.color(!0)+e+":"+o.end()+o.bold();if(u||(t+=o.white()+(0===a?" ":", ")),u=!1,"string"===l&&a>0&&(e="'"+e+"'"),"function"===l){var f=(e+="").match(/\s+(?=}$)/);null!==f&&(e=e.replace(new RegExp(f[0],"g"),"\n")),e.length>150&&(e=e.slice(0,150)+"...\n"),a>1&&(e=e.replace(/\n/g,"array"===s?c:"\n"+(i+": ").replace(/./g," ")+c.slice(1)))}t+=o.color(),"object"===s&&(t+=c+(i.match(/^[0-9a-zA-Z_]+$/)?i:"'"+i+"'")+": "),"array"===l||"object"===l?r(e,a+1):t+="object"===s?e:c+e}),a>0&&("array"===s&&(t+=(a>1?"\n":"")+c.slice(4)+o.white()+"]"),"object"===s&&(t+=(a>1?"\n":"")+c.slice(4)+o.white()+"}"))}(n.c(arguments)),console.log("("+(n.time()-i)+"ms)",t+o.end()),!1},n.lno=function(){t=!1},n.makeTest=function(t,r){return"function"!==n.t(t)?n.l("teishi.makeTest","fun passed to teishi.makeTest should be a function but instead is",t,"with type",n.t(t)):("string"===n.t(r)&&(r=[r]),"array"!==n.t(r)?n.l("teishi.makeTest","clauses argument passed to teishi.makeTest should be an array but instead is",r,"with type",n.t(r)):"string"!==n.t(r[0])?n.l("teishi.makeTest","shouldClause passed to teishi.makeTest should be a string but instead is",r[0],"with type",n.t(r[0])):void 0===r[1]||("array"!==n.t(r[1])&&(r[1]=[r[1]]),!0===e.stopNot(r[1],!0,function(t){var e=n.t(t);return"string"===e||"function"===e||n.l("teishi.makeTest","Each finalClause passed to teishi.makeTest should be a string or a function but instead is",t,"with type",e)}))?function(i,o,a,s,u,c){var l=t(a,s);if(!0===l)return!0;if("array"===n.t(l))return l;var f=[],d=0;return void 0!==u&&(f[d++]="each of the"),o[0]&&(f[d++]=o[0]),i&&(f[d++]="passed to",f[d++]=i),f[d++]=r[0],void 0!==c&&(f[d++]="one of"),f[d++]=void 0!==c?c:s,o[1]&&(f[d++]="("+o[1]+")"),f[d++]=void 0!==u?"but one of":"but instead",void 0!==u&&(f[d++]=u),f[d++]="is",f[d++]=a,e.do(r[1],function(t){f[d++]="function"!=typeof t?t:t(a,s)}),f}:void 0)},n.test={type:n.makeTest(function(t,e){return n.t(t)===e},["should have as type",["with type",n.t]]),equal:n.makeTest(function(t,r){return function t(r,i){return n.simple(r)&&n.simple(i)?r===i:n.t(r,!0)===n.t(i,!0)&&(n.s(e.keys(r).sort())===n.s(e.keys(i).sort())&&!1!==e.stop(r,!1,function(e,n){return t(e,i[n])}))}(t,r)},"should be equal to"),notEqual:n.makeTest(function(t,r){return!function t(r,i){return n.simple(r)&&n.simple(i)?r===i:n.t(r,!0)===n.t(i,!0)&&(n.s(e.keys(r).sort())===n.s(e.keys(i).sort())&&!1!==e.stop(r,!1,function(e,n){return t(e,i[n])}))}(t,r)},"should not be equal to"),range:n.makeTest(function(t,r){return"object"!==n.t(r,!0)?["Range options object must be an object but instead is",r,"with type",n.t(r,!0)]:"{}"===n.s(r)||e.stopNot(r,!0,function(e,n){return"min"!==n&&"max"!==n&&"less"!==n&&"more"!==n?['Range options must be one of "min", "max", "less" and "more", but instead is',n]:"min"===n?t>=e:"max"===n?t<=e:"less"===n?t<e:t>e})},"should be in range"),match:n.makeTest(function(t,e){return"string"!==n.t(t)?["Invalid comparison string passed to teishi.test.match. Comparison string must be of type string but instead is",t,"with type",n.t(t)]:"regex"!==n.t(e)?["Invalid regex passed to teishi.test.match. Regex must be of type regex but instead is",e,"with type",n.t(e)]:null!==t.match(e)},"should match")},n.validateRule=function(t){var r=n.t(t);if("function"===r||"boolean"===r)return!0;if("array"!==r)return["each teishi rule must be an array or boolean or function but instead is",t,"with type",r];var i=n.t(t[0]);if("string"!==i&&("array"!==i||2!==t[0].length||"string"!==n.t(t[0][0])||"string"!==n.t(t[0][1])))return!0;if(3===t.length)return!0;if(t.length<3||t.length>5)return["Each teishi simple rule must be an array of length between 3 and 5, but instead is",t,"and has length",t.length];var o,a;return e.stopNot(t,!0,function(e,r){if(r<3)return!0;var i=n.t(e);if("string"===i){if("oneOf"!==e&&"each"!==e&&"eachOf"!==e)return["Invalid multi parameter",e,". Valid multi parameters are",["oneOf","each","eachOf"]];if(a)return["You can pass only one multi parameter to a teishi simple rule but instead you passed two:",t[3],"and",t[4]];a=e}else{if("function"!==i)return["Elements #4 and #5 of a teishi simple rule must be either a string or a function, but element","#"+(r+1),"is",e,"and has type",i];if(o)return["You can pass only one test function to a teishi simple rule but instead you passed two:",t[3],"and",t[4]];o=e}return!0})};var a=function(t,r){return void 0===r?n.l.apply(n.l,["teishi.v"].concat(t)):(t=e.do(t,function(t){return n.complex(t)?n.s(t):t+""}).join(" "),!0===r?t:(r(t),!1))};n.v=function(t,r,i){if("string"===n.t(t))var o=t,s=r,u=i;else var o="",s=t,u=r;if(void 0!==u&&!0!==u&&"function"!==n.t(u))return n.l("teishi.v","Invalid apres argument. Must be either undefined, true, or a function.");var c=n.validateRule(s);if(!0!==c)return a(c,u);var l=n.t(s);if("boolean"===l)return s;if("function"===l)return n.v(o,s(),u);if(0===s.length)return!0;var f=n.t(s[0]);if("boolean"===f&&2===s.length&&"array"===n.t(s[1]))return!1===s[0]||n.v(o,s[1],u);if("string"!==f&&("array"!==f||2!==s[0].length||"string"!==n.t(s[0][0])||"string"!==n.t(s[0][1])))return e.stopNot(s,!0,function(t){return n.v(o,t,u)});var d,p=n.t(s[3]),h=n.t(s[4]),g="function"===p?s[3]:"function"===h?s[4]:n.test.type,v="string"===p?s[3]:"string"===h?s[4]:void 0,m="array"===f?s[0]:[s[0]],b=n.t(s[1],!0),y=n.t(s[2],!0);return("each"===v||"eachOf"===v)&&("array"===b&&0===s[1].length||"object"===b&&0===Object.keys(s[1]).length||void 0===s[1])||(!0===(d="oneOf"!==v&&"eachOf"!==v||!("array"===y&&0===s[2].length||"object"===y&&0===Object.keys(s[2]).length||void 0===s[2])?void 0===v?g(o,m,s[1],s[2]):"each"===v?e.stopNot(s[1],!0,function(t){return g(o,m,t,s[2],s[1])}):"oneOf"===v?e.stop(s[2],!0,function(t){return g(o,m,s[1],t,void 0,s[2])}):e.stopNot(s[1],!0,function(t){return e.stop(s[2],!0,function(e){return g(o,m,t,e,s[1],s[2])})}):["To field of teishi rule is",s.to,"but multi attribute",v,"requires it to be non-empty, at teishi step",s])||a(d,u))},n.stop=function(){return!0!==n.v.apply(n.v,arguments)}}(),function(){var t="object"==typeof exports,e=t?require("dale"):window.dale,n=t?require("teishi"):window.teishi;if(t)r=exports;else var r=window.lith={};var i=n.t;r.k={lithbagElements:["string","integer","float","array","undefined"],tags:["!DOCTYPE HTML","LITERAL","a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","command","datalist","dd","del","details","dfn","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"],voidTags:["!DOCTYPE HTML","area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]},r.entityify=function(t){return!n.stop("lith.entityify",["Entityified string",t,"string"])&&t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/`/g,"&#96;")},r.v=function(t){var o=i(t);if("array"===o&&"string"===i(t[0])&&-1!==r.k.tags.indexOf(t[0])){var a="object"===i(t[1])?t[1]:void 0,s=t[a?2:1];return!!n.v([["lith length",t.length,{min:1,max:3},n.test.range],[void 0===a,["length of lith without attributes",t.length,{max:2},n.test.range]],[["lith attribute keys","start with an ASCII letter, underscore or colon, and be followed by letters, digits, underscores, colons, periods, dashes, extended ASCII characters, or any non-ASCII characters."],e.keys(a),/^[a-zA-Z_:][a-zA-Z_:0-9.\-\u0080-\uffff]*$/,"each",n.test.match],["lith attribute values",a,["string","integer","float","undefined","null","boolean"],"eachOf"],["lith contents",s,r.k.lithbagElements,"oneOf"]])&&"Lith"}return!!n.v([["lithbag",o,r.k.lithbagElements,"oneOf",n.test.equal],["array"===o,["lithbag element",t,r.k.lithbagElements,"eachOf"]]])&&"Lithbag"},r.g=function(t,e){if(e||r.prod)return"array"===i(t)&&-1!==r.k.tags.indexOf(t[0])?r.generateLith(t,!0):r.generateLithbag(t,!1,!0);var n=r.v(t);return!!n&&r["generate"+n](t)},r.generateLithbag=function(t,n,o){var a="";return!1!==e.stop(t,!1,function(t){if(void 0!==t){i(t);if("array"!==i(t))return a+=n?t:r.entityify(t+"");if(o)a+=r.g(t,o);else{var e=r.g(t,o);if(!1===e)return!1;a+=e}}})&&a},r.generateLith=function(t,n){var o="object"===i(t[1])?t[1]:void 0,a=t[o?2:1];if("LITERAL"===t[0])return a;var s="<"+t[0];if(e.do(o,function(t,e){(t||0===t)&&(s+=" "+r.entityify(e+"")+'="'+r.entityify(t+"")+'"')}),s+=">","array"===i(a))if(n)s+=r.g(a,n);else{var u=r.g(a);if(!1===u)return!1;s+=u}else s+=r.generateLithbag(a,"style"===t[0]||"script"===t[0],n);return-1===r.k.voidTags.indexOf(t[0])&&(s+="</"+t[0]+">"),s},r.css={},r.css.v=function(t){if(n.stop(["litc or litcbag",t,"array"]))return!1;if(0===t.length||"array"===i(t[0]))return!0;var e="object"===i(t[1])?t[1]:void 0,o=t[e?2:1];return n.v([["litc length",t.length,{min:1,max:3},n.test.range],[void 0===e,["length of litc without attributes",t.length,{max:2},n.test.range]],["litc selector",t[0],"string"],r.css.vAttributes(e),["LITERAL"!==t[0],["litc contents",o,["undefined","array"],"oneOf"]]])},r.css.vAttributes=function(t){return n.v([["litc attribute values",t,["string","integer","float","object","undefined","null","boolean"],"eachOf"]])},r.css.g=function(t,n){if(!1===r.css.v(t))return!1;if(0===t.length)return"";var o="";if("LITERAL"===t[0])return t[1];if("array"===i(t[0]))return!1!==e.stop(t,!1,function(t,e){var i=r.css.g(t,n);if(!1===i)return!1;o+=i})&&o;void 0===n&&(n="");var a="object"===i(t[1])?t[1]:void 0,s=t[a?2:1];n=e.do(n.split(/,\s*/),function(n){return e.do(t[0].split(/,\s*/),function(t){return t.match(/&/)?t.replace("&",n):n+(0===n.length?"":" ")+t}).join(", ")}).join(", "),o+=n+"{";var u=function(t){return!1!==r.css.vAttributes(t)&&e.stop(t,!1,function(t,n){if(t||0===t){var r=i(t);if("object"===r)return u(t);"integer"===r&&(t<0||t>1)&&(t+="px"),"float"!==r&&1!==t||(t=100*t+"%"),e.do(n.split(/,\s*/),function(e){o+=e+":"+t+";"})}})};if(!1===u(a))return!1;if(o+="}",s){var c=r.css.g(s,n);if(!1===c)return!1;o+=c}return o}}(),function(){var t="object"==typeof exports,e=t?require("dale"):window.dale,n=t?require("teishi"):window.teishi,r=n.t,i=n.stop,o=function(t){if(!i([["store",t,["array","object","undefined"],"oneOf"]])){var o={};return o.routes={},o.store=t||{},o.do=function(t,e){return n.simple(e)&&(e=[e]),!i("r",[["verb",t,"string"],["path",e,"array"],function(){return["path length",e.length,{min:1},n.test.range]},["path",e,["integer","string"],"eachOf"]])&&(o.mill.apply(null,arguments),!0)},o.listen=function(t,r){return t=t||{},n.simple(t.path)&&(t.path=[t.path]),!n.stop("r.radd",[["opts",t,"object"],function(){return[["opts.verb",t.verb,"string"],["opts.path",t.path,"array"],["opts.path",t.path,["integer","string"],"eachOf"],["opts.id",t.id,["string","integer","undefined"],"oneOf"],["opts.parent",t.parent,["string","integer","undefined"],"oneOf"],["opts.priority",t.priority,["undefined","integer"],"oneOf"],["opts.burn",t.burn,["undefined","boolean"],"oneOf"]]},["route function",r,"function"]])&&(t.id&&o.routes[t.id]?n.l("r.radd","A route with id",t.id,"already exists."):(t.id=t.id||o.random(),o.routes[t.id]=e.obj(["parent","priority","burn"],{id:t.id,verb:t.verb,path:t.path,rfun:r},function(e){if(t[e])return[e,t[e]]}),t.id))},o.forget=function(t){if(!o.routes[t])return n.l("Route",t,"does not exist.");delete o.routes[t],e.do(e.fil(o.routes,void 0,function(e,n){if(e.parent===t)return n}),o.forget)},o.mill=function(t,e){var n=[{verb:arguments[0],path:arguments[1]}].concat([].slice.call(arguments,2)),i=function(t){if(0!==t.length){n[0].cb=function(){i(t)};var e=t.shift();if(!o.routes[e.id])return i(t);e.burn&&o.forget(e.id),"function"!==r(e.rfun.apply(null,n))&&i(t)}};i(o.sort(o.match(t,e,o.routes)))},o.match=function(t,n,r){var i=[];return e.do(r,function(r){"*"!==t&&"*"!==r.verb&&r.verb!==t||r.path.length>n.length||e.stop(r.path,!1,function(t,e){return(void 0===n[e]||"*"===n[e]||"*"===t||n[e]===t)&&(e===r.path.length-1?(i.push(r),!1):void 0)})}),i},o.sort=function(t){return t.sort(function(t,e){var n=t.priority||0;return(e.priority||0)-n})},o.random=function(){return Math.random().toString(16).slice(2)},o}};t?module.exports=o:window.R=o}(),function(){if("object"==typeof exports)return console.log("cocholate only works in a browser!");var t=window.dale,e=window.teishi,n=e.t,r=window.c=function(i,o){if(e.stop("c",["fun",o,["function","undefined"],"oneOf"]))return!1;var a=r.find(i);if(!1===a)return!1;if(o){var s=e.c(arguments).slice(2);a=t.do(a,function(t){return o.apply(void 0,[t].concat(s))})}return"string"===n(i)&&i.match(/^[a-z]*#[^\s\[>,:]+$/)?a[0]:a};r.nodeListToArray=function(t){return[].slice.call(t)},r.setop=function(e,n,i){if("and"===e)return t.fil(n,void 0,function(t){return-1!==i.indexOf(t)?t:void 0});var o=n.slice();return"or"===e?t.do(i,function(t){-1===o.indexOf(i)&&o.push(t)}):(0===o.length&&(o=r.nodeListToArray(document.getElementsByTagName("*"))),t.do(i,function(t){var e=o.indexOf(t);-1!==e&&o.splice(e,1)})),o},r.find=function(i){var o=n(i);if(e.stop("cocholate",[["selector",i,["array","string","object"],"oneOf"],function(){return[["array"===o,["first element of array selector",i[0],[":and",":or",":not"],"oneOf",e.test.equal]],["object"===o,[["selector keys",t.keys(i),["selector","from"],"eachOf",e.test.equal],["valid HTML node",i.from,"undefined",e.test.notEqual],function(){return[["from.querySelectorAll","valid HTML node"],i.from.querySelectorAll,"function"]}]]]}]))return!1;if("string"===o)return r.nodeListToArray(document.querySelectorAll(i));if("object"===o)return r.nodeListToArray(i.from.querySelectorAll(i.selector));var a=i.shift(),s=[];return t.stop(i,!1,function(t,e){var n=r.find(t);if(!1===n)return s=!1;s=0===e&&":not"!==a?n:r.setop(a.replace(":",""),s,n)}),s},r.empty=function(e){r(e,function(e){t.do(r.nodeListToArray(e.getElementsByTagName("*")),function(t){t.remove()})})},r.fill=function(t,n){if(e.stop("c.fill",["html",n,"string"]))return!1;r.empty(t),r(t,function(t){t.innerHTML=n})},r.place=function(t,n,i){if(e.stop("c.place",[["where",n,["beforeBegin","afterBegin","beforeEnd","afterEnd"],"oneOf",e.test.equal],["html",i,"string"]]))return!1;r(t,function(t){t.insertAdjacentHTML(n,i)})},r.get=function(n,i,o){return!e.stop("c.get",["attributes",i,["string","array"],"oneOf"])&&r(n,function(e){return t.obj(i,function(t){return o?[t,e.style[t]||null]:[t,e.getAttribute(t)]})})},r.set=function(n,i,o,a){if(e.stop("c.set",[["attributes",i,"object"],[["attribute keys","start with an ASCII letter, underscore or colon, and be followed by letters, digits, underscores, colons, periods, dashes, extended ASCII characters, or any non-ASCII characters."],t.keys(i),/^[a-zA-Z_:][a-zA-Z_:0-9.\-\u0080-\uffff]*$/,"each",e.test.match],["attribute values",i,["integer","string","null"],"eachOf"]]))return!1;r(n,function(e){t.do(i,function(t,n){o?e.style[n]=null===t?"":t:null===t?e.removeAttribute(n):e.setAttribute(n,t)}),e.onchange&&!a&&e.onchange()})},r.ready=function(t){if(document.addEventListener)return document.addEventListener("DOMContentLoaded",t);document.attachEvent?document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&t()}):t()},r.cookie=function(e){return t.obj((e||document.cookie).split(/;\s+/),function(t){if(""!==t)return[(t=t.split("="))[0],t.slice(1).join("=")]})},r.ajax=function(n,r,i,o,a){if(n=n||"GET",i=i||"",o=o||{},a=a||function(){},e.stop("c.ajax",[["method",n,"string"],["path",r,"string"],["headers",o,"object"],["callback",a,"function"]]))return!1;var s=new XMLHttpRequest;return s.open(n.toUpperCase(),r,!0),e.complex(i)&&"formdata"!==e.t(i,!0)&&(o["content-type"]=o["content-type"]||"application/json",i=e.s(i)),t.do(o,function(t,e){s.setRequestHeader(e,t)}),s.onreadystatechange=function(){4===s.readyState&&(200!==s.status?a(s):a(null,s))},s.send(i),{headers:o,body:i}},r.polyfill=function(){var e=function(){return document.createElement("_")};e().insertAdjacentHTML||(HTMLElement.prototype.insertAdjacentHTML=function(t,n){var r,i,o,a=this,s=e(),u=a.parentNode;if(s.innerHTML=n,"beforeBegin"===t)for(;r=s.firstChild;)u.insertBefore(r,a);else if("afterBegin"===t)for(i=a.firstChild;r=s.lastChild;)a.insertBefore(r,i);else if("beforeEnd"===t)for(;r=s.firstChild;)a.appendChild(r);else for(o=a.nextSibling;r=s.lastChild;)u.insertBefore(r,o)}),Element.prototype.remove||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,n){var r=t.stopNot(n?this.slice(n):this,void 0,function(t,n){if(e===t)return n});return void 0===r?-1:r})},r.polyfill()}(),function(){if("object"==typeof exports)return console.log("gotoB only works in a browser!");var t=window.dale,e=window.teishi,n=window.lith,r=window.c,i=e.t,o=e.l,a=window.R(),s=window.B={v:"0.1.0",B:"в",r:a,routes:a.routes,store:a.store,do:a.do,listen:a.listen,forget:a.forget};s.debug=[],s.debug.log=function(n,r,i){return!e.stop([["from",n,"integer"],["to",r,["integer","undefined"],"oneOf"]])&&(n<0&&(n=s.debug.length+n,r=s.debug.length),r=r||n,t.fil(t.times(r-n+1,n),void 0,function(t,e){var r=s.debug[n+e];if(r)return i||console.log(n+e,r[0].verb,r[0].path,[].slice.call(r,1)),r}))},s.listen({id:"debug",verb:"*",path:"*"},function(){s.debug.push([].slice.call(arguments,0))});var u=function(t){return e.v([["path",t,"array"],function(){return["path length",t.length,{min:1},e.test.range]},["path",t,["integer","string"],"eachOf"]])};s.add=function(t,n){if(e.simple(t)&&(t=[t]),!u(t))return!1;var r=s.get(t);return!1!==r&&("array"!==i(r)?o("B.add","Cannot add to something that is not an array"):(r.push(n),!0))},s.rem=function(n,r){if(e.simple(n)&&(n=[n]),!u(n))return!1;var a=s.get(n);return e.simple(a)?o("B.rem","Cannot remove elements from simple target."):("array"===i(a)?"*"===r?a.splice(0,a.length):("array"===i(r)&&r.sort(function(t,e){return e-t}),t.do(r,function(t){a.splice(t,1)})):"*"===r?t.do(a,function(t,e){delete a[e]}):t.do(r,function(t){delete a[t]}),!0)},s.get=function(n){if(e.simple(n)&&(n=[n]),!u(n))return!1;var r=s.store;return!1===t.stop(n,!1,function(t,i){if(i+1<n.length&&e.simple(r[t]))return!1;r=r[t]})?void 0:r},s.set=function(n,r){if(e.simple(n)&&(n=[n]),!u(n))return!1;var o=s.store;return t.do(n,function(t,e){e+1===n.length?o[t]=r:(void 0===o[t]&&(o[t]="string"===i(n[e+1])?{}:[]),o=o[t])}),!0},t.do(["add","rem","get","set"],function(t){s.listen({id:t,verb:t,path:"*"},function(t){s[t.verb].apply(null,[t.path].concat([].slice.call(arguments,1)))})}),s.listen({id:"change",verb:"*",path:"*",priority:-1},function(t){-1!==["add","rem","set"].indexOf(t.verb)&&s.do("change",t.path,s.get(t.path))}),s.ev=function(n,r){if(e.stop([["attrs",n,"object"],["evs",r,["object","array"],"oneOf"],["array"===i(r),["evs",r,"object","each"]]]))return!1;"object"===i(r)&&(r=[r]);var o={};return t.do(r,function(t){o[t.ev]?o[t.ev].push(t):o[t.ev]=[t]}),t.obj(o,n,function(e,n){var r="";return t.do(e,function(e){var n=[JSON.stringify(e.verb),JSON.stringify(e.path)];n=e.args?n.concat(t.do(e.args,JSON.stringify)):n.concat(["this.value","event"]),r+="B.do ("+n.join(", ")+");"}),[n,r]})},s.view=function(r,a){if(e.stop([["params",r,"object"],["rfun",a,"function"],function(){return[[void 0!==r.tag,["params.tag",r.tag,n.k.tags,"oneOf",e.test.equal]],["params.attrs",r.attrs,["object","undefined"],"oneOf"]]}]))return!1;var c=r.tag||"div",l=r.attrs||{};if(r.path="array"===i(r.path)?r.path:[r.path],!u(r.path))return!1;var f=l.id="в"+s.count++;if(l["data-в"]=r.path.join(":"),!1===t.stop("object"===i(r.listen)?[r.listen]:r.listen,!1,function(t){if(!t)return!1;var e=s.listen(t,t.rfun);if(!1===e)return!1;s.routes[e].parent=f}))return!1;if(!1===s.listen({verb:"change",path:r.path,id:f},function(t){var e=a(t,s.get(r.path));n.v(e)&&s.resolve(f,e)}))return o("Invalid parameters passed to B.view:",r,a);var d=a({verb:"change",path:r.path},s.get(r.path));return!!n.v(d)&&(s.routes[f].view=d,s.routes[f].priority=-2,d=n.g(d),t.do(s.getChildren(d),function(t){s.routes[t].priority--,s.routes[t].parent||(s.routes[t].parent=f)}),[c,l,["LITERAL",d]])},s.getChildren=function(e){var n=(e||"").match(/id="в[0-9a-f]+/g)||[];return t.do(n,function(t){return t.slice(4)})},s.count=0,s.resolvequeue=[],s.resolving=!1,s.resolve=function(n,u,c){if(s.resolving&&!c)return s.resolvequeue.push([n,u]);s.resolving=!0;var l=function(){var e,n=t.stopNot(s.resolvequeue,void 0,function(t,e){if(s.routes[t[0]])return e});if(void 0!==n)return e=s.resolvequeue[n],s.resolvequeue.splice(0,n+1),s.resolve.apply(null,e.concat(!0));s.resolving=!1};if(!r("#"+n))return o("Attempted to redraw dangling view",n),l();var f=r("#"+n).innerHTML,d=s.routes[n],p=s.prediff(d.view),h=s.prediff(u),g=s.diff(p,h);t.do(a.routes,function(t){t.parent===n&&t.view&&s.forget(t.id)});var v=function(t,e,n){var r=m(e,"insert1",n);r?r.parentNode.insertBefore(t,r):m(e.slice(0,e.length-1),"insert2",n).appendChild(t)},m=function(e,r,i){var a=document.getElementById(n);return t.do(e,function(s,c){if(!a)throw o("BOOM! YOU FOUND A BUG IN gotoB! Please open a pull request at http://github.com/fpereiro/gotoB/issues and paste the text below:\n",JSON.stringify({debug:r,debugpos:i,item:g[i].slice(0,2).join(" "),id:n,k:c,where:e,backup:f,oldView:d.view,newView:u,diff:t.do(g,function(t,e){var n={};return n[e]=t,n})})),new Error("gotoB redraw error!");a=a.childNodes[s]}),a},b=[0],y=[0],w={add:{tag:null,index:null},rem:{tag:null,index:null}};t.do(g,function(t,n){if(t[1].match(/^>/)||(g[n][2]={el:m(b,"sequence",n),old:e.c(b),New:e.c(y)}),t[1].match(/^</)){g[n][2].active=g[n][2].el===document.activeElement;var r=t[1].match(/[^<\s]+/g)[0];"add"===t[0]&&(w.rem.tag===r?(g[n][2].match=w.rem.index,g[w.rem.index][2].match=n,w.rem.tag=w.rem.index=null):(w.add.tag=r,w.add.index=n)),"rem"===t[0]&&(w.add.tag===r?(g[n][2].match=w.add.index,g[w.add.index][2].match=n,w.add.tag=w.add.index=null):(w.rem.tag=r,w.rem.index=n)),"add"!==t[0]&&b.push(0),"rem"!==t[0]&&y.push(0)}else t[1].match(/^>/)?("add"!==t[0]&&(b.pop(),b[b.length-1]++),"rem"!==t[0]&&(y.pop(),y[y.length-1]++)):("add"!==t[0]&&b[b.length-1]++,"rem"!==t[0]&&y[y.length-1]++)});var j={};t.do(g,function(e,n){if(!e[1].match(/^>/)){if("keep"===e[0])return v(e[2].el.parentNode.removeChild(e[2].el),e[2].New,n),void(e[2].active&&"a"!==e[1].match(/[^<\s]+/g)[0]&&(e[2].el.focus?e[2].el.focus():e[2].el.setActive()));if(e[1].match(/^</)){if("add"===e[0]){var r;if(void 0!==e[2].match){var o=g[e[2].match];j[o[2].old]||(j[o[2].old]=o[2].el);var a=(r=o[2].el).attributes;"moznamedattrmap"===i(a,!0)&&(a=t.obj(a,function(t){if(t)return[t.name,t.value]}));var s=JSON.parse(e[1].match(/{.+/)||"{}");t.do(t.fil(a,void 0,function(t){if(void 0===s[t.name])return t.name}),function(t){"value"===t&&(r.value=void 0),"checked"===t&&(r.checked=!1),"selected"===t&&(r.selected=!1),r.removeAttribute(t)}),t.do(s,function(t,e){"value"===e&&(r.value=t),"checked"===e&&(r.checked=t),"selected"===e&&(r.selected=t),r.setAttribute(e,t)})}else r=document.createElement(e[1].match(/[^<\s]+/g)[0]),t.do(JSON.parse(e[1].match(/{.+/)||"{}"),function(t,e){r.setAttribute(e,t)});v(r,e[2].New,n),o&&o[2].active&&"a"!==e[1].match(/[^<\s]+/g)[0]&&(r.focus?r.focus():r.setActive())}"rem"===e[0]&&(void 0===e[2].match||e[2].match>n)&&(j[e[2].old]=e[2].el.parentNode.removeChild(e[2].el))}else"add"===e[0]?(e[1]=e[1].replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#96;/g,"`"),v(document.createTextNode(e[1]),e[2].New,n)):e[2].el.parentNode.removeChild(e[2].el)}}),d.view=u,t.do(s.getChildren(r("#"+n).innerHTML),function(t){s.routes[t].priority=s.routes[t].priority+s.routes[n].priority+1,s.routes[t].parent||(s.routes[t].parent=n)}),l()},s.prediff=function(r,o,a){if(e.simple(r))return void 0===r||""===r?o?void 0:[]:o?(o[o.length-1].match(/^(<|>)/)&&o.push(""),o[o.length-1]+=n.g(r)):[n.g(r)];if(o=o||[],"array"===i(r)&&-1!==n.k.tags.indexOf(r[0])){o.push("<"+r[0]);var u="object"===i(r[1])?r[1]:void 0,c=r[u?2:1];u&&(o[o.length-1]+=" "+JSON.stringify(u),u.id&&u.id.match(/^в[0-9a-f]+$/g)&&(c=s.routes[u.id].view));var l=o.length;s.prediff(c,o),"table"===r[0]&&o[l]&&null===o[l].match(/<tbody/)&&(o.splice(l,0,"<tbody"),o.push(">")),o.push(">")}else t.do(r,function(t){s.prediff(t,o)});return o},s.diff=function(e,n){for(var r,i,o,a,s,u,c,l,f,d=[],p=0;p<e.length+n.length+1;){for(d.push({}),r=d[d.length-2]||{1:{x:0}},i=d[d.length-1],o=-p;o<2*p-p+1;){for(a={diags:0},o===-p||o!==p&&r[o-1].x<r[o+1].x?(a.x=r[o+1].x,a.dir="d"):(a.x=r[o-1].x+1,a.dir="r"),s=a.x-o;a.x<e.length&&s<n.length&&e[a.x]===n[s];)a.x++,s++,a.diags++;if(i[o]=a,a.x>=e.length&&s>=n.length){for(u={x:a.x,y:s},c=[],l=p;l>-1;)s=(f=d[l][u.x-u.y]).x-(u.x-u.y),f.diags&&t.do(t.times(f.diags),function(t){c.unshift(["keep",e[f.x-t]])}),"r"===f.dir?c.unshift(["rem",e[f.x-f.diags-1]]):c.unshift(["add",n[s-f.diags-1]]),u.x=f.x-f.diags-("r"===f.dir?1:0),u.y=s-f.diags-("d"===f.dir?1:0),l--;return c.shift(),c}o+=2}p++}}}();