!function(){var t="object"==typeof exports;if(t)var e=exports;else var e=window.dale={};var n=function(t,e){var n=typeof t;return"object"!==n&&"number"!==n?n:t instanceof Array?"array":"number"===n?isNaN(t)?"nan":isFinite(t)?t%1===0?"integer":"float":"infinity":(n=Object.prototype.toString.call(t).replace("[object ","").replace("]","").toLowerCase(),"array"===n||"date"===n||"null"===n?n:"regexp"===n?"regex":e?n:"object")},r=function(t){return function(e,r,i,o){if("do"===t)var a=r,s=i===!0,u=[],c=0;else if("fil"===t)var a=i,s=o===!0,u=[],c=0;else if("obj"!==t)var u,a=i,s=o===!0;else if("object"===n(r))var a=i,s=o===!0,u=r;else var a=r,s=i===!0,u={};if("function"!==n(a))return console.log(("do"===t||"obj"===t&&"object"!==n(r)?"Second":"Third")+" argument passed to dale."+t+" must be a function but instead is",a,"with type",n(a)),!1;if(void 0===e)return u;var l=n(e);"array"===l||("object"===l?"[object Arguments]"===Object.prototype.toString.call(e)&&(l="array"):(l="array",e=[e]));for(var f in e){if("array"===l)f=parseInt(f);else if(!s&&!Object.prototype.hasOwnProperty.call(e,f))continue;var d=a(e[f],f);if("do"===t)u[c++]=d;else if("fil"===t)d!==r&&(u[c++]=d);else if("stop"===t){if(d===r)return d;u=d}else if("stopNot"===t){if(d!==r)return d;u=d}else{if(void 0===d)continue;if("array"!==n(d))return console.log("Value returned by fun must be an array but instead is of type "+n(d));u[d[0]]=d[1]}}return u}};e.do=r("do"),e.fil=r("fil"),e.obj=r("obj"),e.stop=r("stop"),e.stopNot=r("stopNot"),e.keys=function(t,n){return e.do(t,function(t,e){return e},n)},e.times=function(t,e,r){if(0===t)return[];if("integer"!==n(t)||t<0)return console.log("steps must be a positive integer or zero.");if(void 0===e)e=1;else if("integer"!==n(e)&&"float"!==n(e))return console.log("start must be an integer or float.");if(void 0===r)r=1;else if("integer"!==n(r)&&"float"!==n(r))return console.log("step must be an integer or float.");for(var i=[e];i.length<t;)e+=r,i.push(e);return i},e.acc=function(t,r,i,o){var a=arguments.length===("boolean"===n(arguments[arguments.length-1])?4:3),s=a?r:void 0,u=a?i:r,c=a?o:i;if("function"!==n(u))return console.log("fun must be a function but instead is of type",n(u)),!1;var l=!0;return e.do(t,function(t,e){return!a&&l?(l=!1,s=t):void(s=u(s,t))},c),s}}(),function(){var t="object"==typeof exports,e=t?require("dale"):window.dale;if(t)var n=exports;else var n=window.teishi={};n.t=function(t,e){var n=typeof t;return"object"!==n&&"number"!==n?n:t instanceof Array?"array":"number"===n?isNaN(t)?"nan":isFinite(t)?t%1===0?"integer":"float":"infinity":(n=Object.prototype.toString.call(t).replace("[object ","").replace("]","").toLowerCase(),"array"===n||"date"===n||"null"===n?n:"regexp"===n?"regex":e?n:"object")},n.s=function(){try{return JSON.stringify.apply(JSON.stringify,arguments)}catch(t){return!1}},n.p=function(){try{return JSON.parse.apply(JSON.parse,arguments)}catch(t){return!1}},n.simple=function(t){var e=n.t(t);return"array"!==e&&"object"!==e},n.complex=function(t){return!n.simple(t)},n.c=function(t,r,i){if(n.simple(t))return t;r=r||["$root"],i=i||[r,t];var o=n.t(t,!0),a="array"===o||"arguments"===o?[]:{};return e.do(t,function(t,o){if(n.simple(t))return a[o]=t;var s=e.stopNot(i,void 0,function(e,n){if(n%2!==0&&t===e)return i[n-1]});return s?void(a[o]="CIRCULAR REFERENCE: "+s.join(".")):(i.push(r.concat([o]))&&i.push(t),a[o]=n.c(t,r.concat([o]),i.concat()))}),a},n.time=function(){return Date.now()};var r,i=n.time(),o={end:function(){return t?"[0m":""},bold:function(){return t?"[1m":""},white:function(){return t?"[37m":""},color:function(e){if(!t)return"";for(var n=r;r===n;)n=Math.round(5*Math.random()+1);return r=n,"["+(e?"4":"3")+n+"m"}};n.l=function(){var t=o.bold();return function r(i,a){var s=n.t(i),a=a||0,u=!0;"object"===s&&"[object Arguments]"===Object.prototype.toString.call(i)&&(s="array");var c=a<2?"":"\n"+e.do(e.times(a-1),function(t){return"   "}).join("");a>0&&(t+="array"===s?o.white()+"[":o.white()+"{"),e.do(i,function(e,i){var l=n.t(e);if(0===a&&0===i&&("string"===l||"integer"===l))return u=!1,t+=o.color(!0)+e+":"+o.end()+o.bold();if(u||(t+=o.white()+(0===a?" ":", ")),u=!1,"string"===l&&a>0&&(e="'"+e+"'"),"function"===l){e+="";var f=e.match(/\s+(?=}$)/);null!==f&&(e=e.replace(new RegExp(f[0],"g"),"\n")),e.length>150&&(e=e.slice(0,150)+"...\n"),a>1&&(e=e.replace(/\n/g,"array"===s?c:"\n"+(i+": ").replace(/./g," ")+c.slice(1)))}t+=o.color(),"object"===s&&(t+=c+(i.match(/^[0-9a-zA-Z_]+$/)?i:"'"+i+"'")+": "),"array"===l||"object"===l?r(e,a+1):t+="object"===s?e:c+e}),a>0&&("array"===s&&(t+=(a>1?"\n":"")+c.slice(4)+o.white()+"]"),"object"===s&&(t+=(a>1?"\n":"")+c.slice(4)+o.white()+"}"))}(n.c(arguments)),console.log("("+(n.time()-i)+"ms)",t+o.end()),!1},n.lno=function(){t=!1},n.makeTest=function(t,r){if("function"!==n.t(t))return n.l("teishi.makeTest","fun passed to teishi.makeTest should be a function but instead is",t,"with type",n.t(t));if("string"===n.t(r)&&(r=[r]),"array"!==n.t(r))return n.l("teishi.makeTest","clauses argument passed to teishi.makeTest should be an array but instead is",r,"with type",n.t(r));if("string"!==n.t(r[0]))return n.l("teishi.makeTest","shouldClause passed to teishi.makeTest should be a string but instead is",r[0],"with type",n.t(r[0]));if(void 0!==r[1]){"array"!==n.t(r[1])&&(r[1]=[r[1]]);var i=e.stopNot(r[1],!0,function(t){var e=n.t(t);return"string"===e||"function"===e||n.l("teishi.makeTest","Each finalClause passed to teishi.makeTest should be a string or a function but instead is",t,"with type",e)});if(i!==!0)return}return function(i,o,a,s,u,c){var l=t(a,s);if(l===!0)return!0;if("array"===n.t(l))return l;var f=[],d=0;return void 0!==u&&(f[d++]="each of the"),o[0]&&(f[d++]=o[0]),i&&(f[d++]="passed to",f[d++]=i),f[d++]=r[0],void 0!==c&&(f[d++]="one of"),f[d++]=void 0!==c?c:s,o[1]&&(f[d++]="("+o[1]+")"),f[d++]=void 0!==u?"but one of":"but instead",void 0!==u&&(f[d++]=u),f[d++]="is",f[d++]=a,e.do(r[1],function(t){f[d++]="function"!=typeof t?t:t(a,s)}),f}},n.test={type:n.makeTest(function(t,e){return n.t(t)===e},["should have as type",["with type",n.t]]),equal:n.makeTest(function(t,r){return function t(r,i){return n.simple(r)&&n.simple(i)?r===i:n.t(r,!0)===n.t(i,!0)&&(n.s(e.keys(r).sort())===n.s(e.keys(i).sort())&&e.stop(r,!1,function(e,n){return t(e,i[n])})!==!1)}(t,r)},"should be equal to"),notEqual:n.makeTest(function(t,r){return!function t(r,i){return n.simple(r)&&n.simple(i)?r===i:n.t(r,!0)===n.t(i,!0)&&(n.s(e.keys(r).sort())===n.s(e.keys(i).sort())&&e.stop(r,!1,function(e,n){return t(e,i[n])})!==!1)}(t,r)},"should not be equal to"),range:n.makeTest(function(t,r){return"object"!==n.t(r,!0)?["Range options object must be an object but instead is",r,"with type",n.t(r,!0)]:"{}"===n.s(r)||e.stopNot(r,!0,function(e,n){return"min"!==n&&"max"!==n&&"less"!==n&&"more"!==n?['Range options must be one of "min", "max", "less" and "more", but instead is',n]:"min"===n?t>=e:"max"===n?t<=e:"less"===n?t<e:t>e})},"should be in range"),match:n.makeTest(function(t,e){return"string"!==n.t(t)?["Invalid comparison string passed to teishi.test.match. Comparison string must be of type string but instead is",t,"with type",n.t(t)]:"regex"!==n.t(e)?["Invalid regex passed to teishi.test.match. Regex must be of type regex but instead is",e,"with type",n.t(e)]:null!==t.match(e)},"should match")},n.validateRule=function(t){var r=n.t(t);if("function"===r||"boolean"===r)return!0;if("array"!==r)return["each teishi rule must be an array or boolean or function but instead is",t,"with type",r];var i=n.t(t[0]);if("string"!==i&&("array"!==i||2!==t[0].length||"string"!==n.t(t[0][0])||"string"!==n.t(t[0][1])))return!0;if(3===t.length)return!0;if(t.length<3||t.length>5)return["Each teishi simple rule must be an array of length between 3 and 5, but instead is",t,"and has length",t.length];var o,a,s=e.stopNot(t,!0,function(e,r){if(r<3)return!0;var i=n.t(e);if("string"===i){if("oneOf"!==e&&"each"!==e&&"eachOf"!==e)return["Invalid multi parameter",e,". Valid multi parameters are",["oneOf","each","eachOf"]];if(a)return["You can pass only one multi parameter to a teishi simple rule but instead you passed two:",t[3],"and",t[4]];a=e}else{if("function"!==i)return["Elements #4 and #5 of a teishi simple rule must be either a string or a function, but element","#"+(r+1),"is",e,"and has type",i];if(o)return["You can pass only one test function to a teishi simple rule but instead you passed two:",t[3],"and",t[4]];o=e}return!0});return s};var a=function(t,r){return void 0===r?n.l.apply(n.l,["teishi.v"].concat(t)):(t=e.do(t,function(t){return n.complex(t)?n.s(t):t+""}).join(" "),r===!0?t:(r(t),!1))};n.v=function(t,r,i){if("string"===n.t(t))var o=t,s=r,u=i;else var o="",s=t,u=r;if(void 0!==u&&u!==!0&&"function"!==n.t(u))return n.l("teishi.v","Invalid apres argument. Must be either undefined, true, or a function.");var c=n.validateRule(s);if(c!==!0)return a(c,u);var l=n.t(s);if("boolean"===l)return s;if("function"===l)return n.v(o,s(),u);if(0===s.length)return!0;var f=n.t(s[0]);if("boolean"===f&&2===s.length&&"array"===n.t(s[1]))return s[0]===!1||n.v(o,s[1],u);if("string"!==f&&("array"!==f||2!==s[0].length||"string"!==n.t(s[0][0])||"string"!==n.t(s[0][1])))return e.stopNot(s,!0,function(t){return n.v(o,t,u)});var d,p=n.t(s[3]),h=n.t(s[4]),g="function"===p?s[3]:"function"===h?s[4]:n.test.type,v="string"===p?s[3]:"string"===h?s[4]:void 0,m="array"===f?s[0]:[s[0]],b=n.t(s[1],!0),y=n.t(s[2],!0);return("each"===v||"eachOf"===v)&&("array"===b&&0===s[1].length||"object"===b&&0===Object.keys(s[1]).length||void 0===s[1])||(d="oneOf"!==v&&"eachOf"!==v||!("array"===y&&0===s[2].length||"object"===y&&0===Object.keys(s[2]).length||void 0===s[2])?void 0===v?g(o,m,s[1],s[2]):"each"===v?e.stopNot(s[1],!0,function(t){return g(o,m,t,s[2],s[1])}):"oneOf"===v?e.stop(s[2],!0,function(t){return g(o,m,s[1],t,void 0,s[2])}):e.stopNot(s[1],!0,function(t){return e.stop(s[2],!0,function(e){return g(o,m,t,e,s[1],s[2])})}):["To field of teishi rule is",s.to,"but multi attribute",v,"requires it to be non-empty, at teishi step",s],d===!0||a(d,u))},n.stop=function(){return n.v.apply(n.v,arguments)!==!0}}(),function(){var t="object"==typeof exports,e=t?require("dale"):window.dale,n=t?require("teishi"):window.teishi;if(t)var r=exports;else var r=window.lith={};var i=n.t;r.k={lithbagElements:["string","integer","float","array","undefined"],tags:["!DOCTYPE HTML","LITERAL","a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","command","datalist","dd","del","details","dfn","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"],voidTags:["!DOCTYPE HTML","area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]},r.entityify=function(t){return!n.stop("lith.entityify",["Entityified string",t,"string"])&&t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/`/g,"&#96;")},r.v=function(t){var o=i(t);if("array"===o&&"string"===i(t[0])&&r.k.tags.indexOf(t[0])!==-1){var a="object"===i(t[1])?t[1]:void 0,s=t[a?2:1];return!!n.v([["lith length",t.length,{min:1,max:3},n.test.range],[void 0===a,["length of lith without attributes",t.length,{max:2},n.test.range]],[["lith attribute keys","start with an ASCII letter, underscore or colon, and be followed by letters, digits, underscores, colons, periods, dashes, extended ASCII characters, or any non-ASCII characters."],e.keys(a),/^[a-zA-Z_:][a-zA-Z_:0-9.\-\u0080-\uffff]*$/,"each",n.test.match],["lith attribute values",a,["string","integer","float","undefined","null","boolean"],"eachOf"],["lith contents",s,r.k.lithbagElements,"oneOf"]])&&"Lith"}return!!n.v([["lithbag",o,r.k.lithbagElements,"oneOf",n.test.equal],["array"===o,["lithbag element",t,r.k.lithbagElements,"eachOf"]]])&&"Lithbag"},r.g=function(t,e){if(e||r.prod)return"array"===i(t)&&r.k.tags.indexOf(t[0])!==-1?r.generateLith(t,!0):r.generateLithbag(t,!1,!0);var n=r.v(t);return!!n&&r["generate"+n](t)},r.generateLithbag=function(t,n,o){var a="";return e.stop(t,!1,function(t){if(void 0!==t){i(t);if("array"!==i(t))return a+=n?t:r.entityify(t+"");if(o)a+=r.g(t,o);else{var e=r.g(t,o);if(e===!1)return!1;a+=e}}})!==!1&&a},r.generateLith=function(t,n){var o="object"===i(t[1])?t[1]:void 0,a=t[o?2:1];if("LITERAL"===t[0])return a;var s="<"+t[0];if(e.do(o,function(t,e){(t||0===t)&&(s+=" "+r.entityify(e+"")+'="'+r.entityify(t+"")+'"')}),s+=">","array"===i(a))if(n)s+=r.g(a,n);else{var u=r.g(a);if(u===!1)return!1;s+=u}else s+=r.generateLithbag(a,"style"===t[0]||"script"===t[0],n);return r.k.voidTags.indexOf(t[0])===-1&&(s+="</"+t[0]+">"),s},r.css={},r.css.v=function(t){if(n.stop(["litc or litcbag",t,"array"]))return!1;if(0===t.length||"array"===i(t[0]))return!0;var e="object"===i(t[1])?t[1]:void 0,o=t[e?2:1];return n.v([["litc length",t.length,{min:1,max:3},n.test.range],[void 0===e,["length of litc without attributes",t.length,{max:2},n.test.range]],["litc selector",t[0],"string"],r.css.vAttributes(e),["LITERAL"!==t[0],["litc contents",o,["undefined","array"],"oneOf"]]])},r.css.vAttributes=function(t){return n.v([["litc attribute values",t,["string","integer","float","object","undefined","null","boolean"],"eachOf"]])},r.css.g=function(t,n){if(r.css.v(t)===!1)return!1;if(0===t.length)return"";var o="";if("LITERAL"===t[0])return t[1];if("array"===i(t[0]))return e.stop(t,!1,function(t,e){var i=r.css.g(t,n);return i!==!1&&void(o+=i)})!==!1&&o;void 0===n&&(n="");var a="object"===i(t[1])?t[1]:void 0,s=t[a?2:1];n=e.do(n.split(/,\s*/),function(n){return e.do(t[0].split(/,\s*/),function(t){return t.match(/&/)?t.replace("&",n):n+(0===n.length?"":" ")+t}).join(", ")}).join(", "),o+=n+"{";var u=function(t){return r.css.vAttributes(t)!==!1&&e.stop(t,!1,function(t,n){if(t||0===t){var r=i(t);if("object"===r)return u(t);"integer"===r&&(t<0||t>1)&&(t+="px"),"float"!==r&&1!==t||(t=100*t+"%"),e.do(n.split(/,\s*/),function(e){o+=e+":"+t+";"})}})};if(u(a)===!1)return!1;if(o+="}",s){var c=r.css.g(s,n);if(c===!1)return!1;o+=c}return o}}(),function(){var t="object"==typeof exports,e=t?require("dale"):window.dale,n=t?require("teishi"):window.teishi,r=n.t,i=n.stop,o=function(t){if(!i([["store",t,["array","object","undefined"],"oneOf"]])){var o={};return o.routes={},o.store=t||{},o.do=function(t,e){return n.simple(e)&&(e=[e]),!i("r",[["verb",t,"string"],["path",e,"array"],function(){return["path length",e.length,{min:1},n.test.range]},["path",e,["integer","string"],"eachOf"]])&&(o.mill.apply(null,arguments),!0)},o.listen=function(t,r){return t=t||{},n.simple(t.path)&&(t.path=[t.path]),!n.stop("r.radd",[["opts",t,"object"],function(){return[["opts.verb",t.verb,"string"],["opts.path",t.path,"array"],["opts.path",t.path,["integer","string"],"eachOf"],["opts.id",t.id,["string","integer","undefined"],"oneOf"],["opts.parent",t.parent,["string","integer","undefined"],"oneOf"],["opts.priority",t.priority,["undefined","integer"],"oneOf"],["opts.burn",t.burn,["undefined","boolean"],"oneOf"]]},["route function",r,"function"]])&&(t.id&&o.routes[t.id]?n.l("r.radd","A route with id",t.id,"already exists."):(t.id=t.id||o.random(),o.routes[t.id]=e.obj(["parent","priority","burn"],{id:t.id,verb:t.verb,path:t.path,rfun:r},function(e){if(t[e])return[e,t[e]]}),t.id))},o.forget=function(t){return o.routes[t]?(delete o.routes[t],void e.do(e.fil(o.routes,void 0,function(e,n){if(e.parent===t)return n}),o.forget)):n.l("Route",t,"does not exist.")},o.mill=function(t,e){var n=[{verb:arguments[0],path:arguments[1]}].concat([].slice.call(arguments,2)),i=function(t){if(0!==t.length){n[0].cb=function(){i(t)};var e=t.shift();if(!o.routes[e.id])return i(t);e.burn&&o.forget(e.id),"function"!==r(e.rfun.apply(null,n))&&i(t)}};i(o.sort(o.match(t,e,o.routes)))},o.match=function(t,n,r){var i=[];return e.do(r,function(r){"*"!==t&&"*"!==r.verb&&r.verb!==t||r.path.length>n.length||e.stop(r.path,!1,function(t,e){return(void 0===n[e]||"*"===n[e]||"*"===t||n[e]===t)&&(e===r.path.length-1?(i.push(r),!1):void 0)})}),i},o.sort=function(t){return t.sort(function(t,e){var n=t.priority||0,r=e.priority||0;return r-n})},o.random=function(){return Math.random().toString(16).slice(2)},o}};t?module.exports=o:window.R=o}(),function(){if("object"==typeof exports)return console.log("cocholate only works in a browser!");var t=window.dale,e=window.teishi,n=e.t,r=window.c=function(i,o){if(e.stop("c",["fun",o,["function","undefined"],"oneOf"]))return!1;var a=r.find(i);if(a===!1)return!1;if(o){var s=e.c(arguments).slice(2);a=t.do(a,function(t){return o.apply(void 0,[t].concat(s))})}return"string"===n(i)&&i.match(/^[a-z]*#[^\s\[>,:]+$/)?a[0]:a};r.nodeListToArray=function(e){return t.fil(e,void 0,function(t,e){if(e.match(/^\d+$/))return t})},r.setop=function(e,n,i){if("and"===e)return t.fil(n,void 0,function(t){return i.indexOf(t)!==-1?t:void 0});var o=n.slice();return"or"===e?t.do(i,function(t){o.indexOf(i)===-1&&o.push(t)}):(0===o.length&&(o=r.nodeListToArray(document.getElementsByTagName("*"))),t.do(i,function(t){var e=o.indexOf(t);e!==-1&&o.splice(e,1)})),o},r.find=function(i){var o=n(i);if(e.stop("cocholate",[["selector",i,["array","string","object"],"oneOf"],function(){return[["array"===o,["first element of array selector",i[0],[":and",":or",":not"],"oneOf",e.test.equal]],["object"===o,[["selector keys",t.keys(i),["selector","from"],"eachOf",e.test.equal],["valid HTML node",i.from,"undefined",e.test.notEqual],function(){return[["from.querySelectorAll","valid HTML node"],i.from.querySelectorAll,"function"]}]]]}]))return!1;if("string"===o)return r.nodeListToArray(document.querySelectorAll(i));if("object"===o)return r.nodeListToArray(i.from.querySelectorAll(i.selector));var a=i.shift(),s=[];return t.stop(i,!1,function(t,e){var n=r.find(t);return n===!1?s=!1:void(s=0===e&&":not"!==a?n:r.setop(a.replace(":",""),s,n))}),s},r.empty=function(e){r(e,function(e){t.do(r.nodeListToArray(e.getElementsByTagName("*")),function(t){t.remove()})})},r.fill=function(t,n){return!e.stop("c.fill",["html",n,"string"])&&(r.empty(t),void r(t,function(t){t.innerHTML=n}))},r.place=function(t,n,i){return!e.stop("c.place",[["where",n,["beforeBegin","afterBegin","beforeEnd","afterEnd"],"oneOf",e.test.equal],["html",i,"string"]])&&void r(t,function(t){t.insertAdjacentHTML(n,i)})},r.get=function(n,i,o){return!e.stop("c.get",["attributes",i,["string","array"],"oneOf"])&&r(n,function(e){return t.obj(i,function(t){return o?[t,e.style[t]||null]:[t,e.getAttribute(t)]})})},r.set=function(n,i,o,a){return!e.stop("c.set",[["attributes",i,"object"],[["attribute keys","start with an ASCII letter, underscore or colon, and be followed by letters, digits, underscores, colons, periods, dashes, extended ASCII characters, or any non-ASCII characters."],t.keys(i),/^[a-zA-Z_:][a-zA-Z_:0-9.\-\u0080-\uffff]*$/,"each",e.test.match],["attribute values",i,["integer","string","null"],"eachOf"]])&&void r(n,function(e){t.do(i,function(t,n){o?e.style[n]=null===t?"":t:null===t?e.removeAttribute(n):e.setAttribute(n,t)}),e.onchange&&!a&&e.onchange()})},r.ready=function(t){return document.addEventListener?document.addEventListener("DOMContentLoaded",t):void(document.attachEvent?document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&t()}):t())},r.cookie=function(e){return t.obj((e||document.cookie).split(/;\s+/),function(t){if(""!==t){t=t.split("=");var e=t[0],n=t.slice(1).join("=");return[e,n]}})},r.ajax=function(n,r,i,o,a){if(n=n||"GET",i=i||"",o=o||{},a=a||function(){},e.stop("c.ajax",[["method",n,"string"],["path",r,"string"],["headers",o,"object"],["callback",a,"function"]]))return!1;var s=new XMLHttpRequest;return s.open(n.toUpperCase(),r,!0),e.complex(i)&&"formdata"!==e.t(i,!0)&&(o["content-type"]=o["content-type"]||"application/json",i=e.s(i)),t.do(o,function(t,e){s.setRequestHeader(e,t)}),s.onreadystatechange=function(){4===s.readyState&&(200!==s.status?a(s):a(null,s))},s.send(i),{headers:o,body:i}},r.polyfill=function(){var e=function(){return document.createElement("_")};e().insertAdjacentHTML||(HTMLElement.prototype.insertAdjacentHTML=function(t,n){var r,i,o,a=this,s=e(),u=a.parentNode;if(s.innerHTML=n,"beforeBegin"===t)for(;r=s.firstChild;)u.insertBefore(r,a);else if("afterBegin"===t)for(i=a.firstChild;r=s.lastChild;)a.insertBefore(r,i);else if("beforeEnd"===t)for(;r=s.firstChild;)a.appendChild(r);else for(o=a.nextSibling;r=s.lastChild;)u.insertBefore(r,o)}),Element.prototype.remove||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,n){var r=t.stopNot(n?this.slice(n):this,void 0,function(t,n){if(e===t)return n});return void 0===r?-1:r})},r.polyfill()}(),function(){if("object"==typeof exports)return console.log("gotoB only works in a browser!");var t=window.dale,e=window.teishi,n=window.lith,r=window.c,i=e.t,o=e.l,a=window.R(),s=window.B={v:"0.1.0",B:"в",r:a,routes:a.routes,store:a.store,do:a.do,listen:a.listen,forget:a.forget};s.debug=[],s.debug.log=function(n,r,i){return!e.stop([["from",n,"integer"],["to",r,["integer","undefined"],"oneOf"]])&&(n<0&&(n=s.debug.length+n,r=s.debug.length),r=r||n,t.fil(t.times(r-n+1,n),void 0,function(t,e){var r=s.debug[n+e];if(r)return i||console.log(n+e,r[0].verb,r[0].path,[].slice.call(r,1)),r}))},s.listen({id:"debug",verb:"*",path:"*"},function(){s.debug.push([].slice.call(arguments,0))});var u=function(t){return e.v([["path",t,"array"],function(){return["path length",t.length,{min:1},e.test.range]},["path",t,["integer","string"],"eachOf"]])};s.add=function(t,n){if(e.simple(t)&&(t=[t]),!u(t))return!1;var r=s.get(t);return r!==!1&&("array"!==i(r)?o("B.add","Cannot add to something that is not an array"):(r.push(n),!0))},s.rem=function(n,r){if(e.simple(n)&&(n=[n]),!u(n))return!1;var a=s.get(n);return e.simple(a)?o("B.rem","Cannot remove elements from simple target."):("array"===i(a)?"*"===r?a.splice(0,a.length):("array"===i(r)&&r.sort(function(t,e){return e-t}),t.do(r,function(t){a.splice(t,1)})):"*"===r?t.do(a,function(t,e){delete a[e]}):t.do(r,function(t){delete a[t]}),!0)},s.get=function(n){if(e.simple(n)&&(n=[n]),!u(n))return!1;var r=s.store;return t.stop(n,!1,function(t,i){return!(i+1<n.length&&e.simple(r[t]))&&void(r=r[t])})===!1?void 0:r},s.set=function(n,r){if(e.simple(n)&&(n=[n]),!u(n))return!1;var o=s.store;return t.do(n,function(t,e){e+1===n.length?o[t]=r:(void 0===o[t]&&(o[t]="string"===i(n[e+1])?{}:[]),o=o[t])}),!0},t.do(["add","rem","get","set"],function(t){s.listen({id:t,verb:t,path:"*"},function(t){s[t.verb].apply(null,[t.path].concat([].slice.call(arguments,1)))})}),s.listen({id:"change",verb:"*",path:"*",priority:-1},function(t){["add","rem","set"].indexOf(t.verb)!==-1&&s.do("change",t.path,s.get(t.path))}),s.ev=function(n,r){if(e.stop([["attrs",n,"object"],["evs",r,["object","array"],"oneOf"],["array"===i(r),["evs",r,"object","each"]]]))return!1;"object"===i(r)&&(r=[r]);var o={};return t.do(r,function(t){o[t.ev]?o[t.ev].push(t):o[t.ev]=[t]}),t.obj(o,n,function(e,n){var r="";return t.do(e,function(e){var n=[JSON.stringify(e.verb),JSON.stringify(e.path)];n=e.args?n.concat(t.do(e.args,JSON.stringify)):n.concat(["this.value","event"]),r+="B.do ("+n.join(", ")+");"}),[n,r]})},s.view=function(r,a){if(e.stop([["params",r,"object"],["rfun",a,"function"],function(){return[[void 0!==r.tag,["params.tag",r.tag,n.k.tags,"oneOf",e.test.equal]],["params.attrs",r.attrs,["object","undefined"],"oneOf"]]}]))return!1;var c=r.tag||"div",l=r.attrs||{};if(r.path="array"===i(r.path)?r.path:[r.path],!u(r.path))return!1;var f=l.id="в"+s.count++;if(l["data-в"]=r.path.join(":"),t.stop("object"===i(r.listen)?[r.listen]:r.listen,!1,function(t){if(!t)return!1;var e=s.listen(t,t.rfun);return e!==!1&&void(s.routes[e].parent=f)})===!1)return!1;if(s.listen({verb:"change",path:r.path,id:f},function(t){var e=a(t,s.get(r.path));n.v(e)&&s.resolve(f,e)})===!1)return o("Invalid parameters passed to B.view:",r,a);var d=a({verb:"change",path:r.path},s.get(r.path));return!!n.v(d)&&(s.routes[f].view=d,s.routes[f].priority=-2,d=n.g(d),t.do(s.getChildren(d),function(t){s.routes[t].priority--,s.routes[t].parent||(s.routes[t].parent=f)}),[c,l,["LITERAL",d]])},s.getChildren=function(e){var n=(e||"").match(/id="в[0-9a-f]+/g)||[];return t.do(n,function(t){return t.slice(4)})},s.count=0,s.resolvequeue=[],s.resolving=!1,s.resolve=function(n,i,u){if(s.resolving&&!u)return s.resolvequeue.push([n,i]);s.resolving=!0;var c=function(){var e,n=t.stopNot(s.resolvequeue,void 0,function(t,e){if(s.routes[t[0]])return e});return void 0!==n?(e=s.resolvequeue[n],s.resolvequeue.splice(0,n+1),s.resolve.apply(null,e.concat(!0))):void(s.resolving=!1)};if(!r("#"+n))return o("Attempted to redraw dangling view",n),c();var l=r("#"+n).innerHTML,f=s.routes[n],d=s.diff(s.prediff(f.view),s.prediff(i));t.do(a.routes,function(t){t.parent===n&&t.view&&s.forget(t.id)});var p=function(t,e,n){var r=h(e,"insert1",n);r?r.parentNode.insertBefore(t,r):h(e.slice(0,e.length-1),"insert2",n).appendChild(t)},h=function(e,a,s){var u=r("#"+n);return t.do(e,function(r,c){if(!u)throw o("BOOM! YOU FOUND A BUG IN gotoB! Please open a pull request at http://github.com/fpereiro/gotoB/issues and paste the text below:\n",JSON.stringify({debug:a,debugpos:s,item:d[s].slice(0,2).join(" "),id:n,k:c,where:e,backup:l,oldView:f.view,newView:i,diff:t.do(d,function(t,e){var n={};return n[e]=t,n})})),new Error("gotoB redraw error!");u=u.childNodes[r]}),u},g=[0],v=[0],m={add:{tag:null,index:null},rem:{tag:null,index:null}};t.do(d,function(t,n){if(t[1].match(/^>/)||(d[n][2]={el:h(g,"sequence",n),old:e.c(g),New:e.c(v)}),t[1].match(/^</)){d[n][2].active=d[n][2].el===document.activeElement;var r=t[1].match(/[^<\s]+/g)[0];"add"===t[0]&&(m.rem.tag===r?(d[n][2].match=m.rem.index,d[m.rem.index][2].match=n,m.rem.tag=m.rem.index=null):(m.add.tag=r,m.add.index=n)),"rem"===t[0]&&(m.add.tag===r?(d[n][2].match=m.add.index,d[m.add.index][2].match=n,m.add.tag=m.add.index=null):(m.rem.tag=r,m.rem.index=n)),"add"!==t[0]&&g.push(0),"rem"!==t[0]&&v.push(0)}else t[1].match(/^>/)?("add"!==t[0]&&(g.pop(),g[g.length-1]++),"rem"!==t[0]&&(v.pop(),v[v.length-1]++)):("add"!==t[0]&&g[g.length-1]++,"rem"!==t[0]&&v[v.length-1]++)});var b={};t.do(d,function(e,n){if(!e[1].match(/^>/)){if("keep"===e[0])return p(e[2].el.parentNode.removeChild(e[2].el),e[2].New,n),void(e[2].active&&"a"!==e[1].match(/[^<\s]+/g)[0]&&(e[2].el.focus?e[2].el.focus():e[2].el.setActive()));if(e[1].match(/^</)){if("add"===e[0]){var r;if(void 0!==e[2].match){var i=d[e[2].match];b[i[2].old]||(b[i[2].old]=i[2].el),r=i[2].el;var o=r.attributes,a=JSON.parse(e[1].match(/{.+/)||"{}");t.do(t.fil(o,void 0,function(t){if(void 0===a[t.name])return t.name}),function(t){"value"===t&&(r.value=void 0),"checked"===t&&(r.checked=!1),"selected"===t&&(r.selected=!1),r.removeAttribute(t)}),t.do(a,function(t,e){"value"===e&&(r.value=t),"checked"===e&&(r.checked=t),"selected"===e&&(r.selected=t),r.setAttribute(e,t)})}else r=document.createElement(e[1].match(/[^<\s]+/g)[0]),t.do(JSON.parse(e[1].match(/{.+/)||"{}"),function(t,e){r.setAttribute(e,t)});p(r,e[2].New,n),i&&i[2].active&&"a"!==e[1].match(/[^<\s]+/g)[0]&&(r.focus?r.focus():r.setActive())}"rem"===e[0]&&(void 0===e[2].match||e[2].match>n)&&(b[e[2].old]=e[2].el.parentNode.removeChild(e[2].el))}else"add"===e[0]?(e[1]=e[1].replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#96;/g,"`"),p(document.createTextNode(e[1]),e[2].New,n)):e[2].el.remove()}}),s.routes[n].view=i,t.do(s.getChildren(r("#"+n).innerHTML),function(t){s.routes[t].priority=s.routes[t].priority+s.routes[n].priority+1,s.routes[t].parent||(s.routes[t].parent=n)}),c()},s.prediff=function(r,o,a){if(e.simple(r))return void 0===r||""===r?o?void 0:[]:o?(o[o.length-1].match(/^(<|>)/)&&o.push(""),o[o.length-1]+=n.g(r)):[n.g(r)];if(o=o||[],"array"===i(r)&&n.k.tags.indexOf(r[0])!==-1){o.push("<"+r[0]);var u="object"===i(r[1])?r[1]:void 0,c=r[u?2:1];u&&(o[o.length-1]+=" "+JSON.stringify(u),u.id&&u.id.match(/^в[0-9a-f]+$/g)&&(c=s.routes[u.id].view));var l=o.length;s.prediff(c,o),"table"===r[0]&&o[l]&&null===o[l].match(/<tbody/)&&(o.splice(l,0,"<tbody"),o.push(">")),o.push(">")}else t.do(r,function(t){s.prediff(t,o)});return o},s.diff=function(e,n){var r=[];return t.stopNot(t.times(e.length+n.length+1,0),void 0,function(i){r.push({});var o=r[r.length-2]||{1:{x:0}},a=r[r.length-1];return t.stopNot(t.times(i+1,-i,2),void 0,function(s){var u={diags:0};s===-i||s!==i&&o[s-1].x<o[s+1].x?(u.x=o[s+1].x,u.dir="d"):(u.x=o[s-1].x+1,u.dir="r");for(var c=u.x-s;u.x<e.length&&c<n.length&&e[u.x]===n[c];)u.x++,c++,u.diags++;if(a[s]=u,u.x>=e.length&&c>=n.length){var l={x:u.x,y:c},f=[];return t.do(t.times(i+1,i,-1),function(i){var o=r[i][l.x-l.y],a=o.x-(l.x-l.y);o.diags&&t.do(t.times(o.diags),function(t){f.unshift(["keep",e[o.x-t]])}),"r"===o.dir?f.unshift(["rem",e[o.x-o.diags-1]]):f.unshift(["add",n[a-o.diags-1]]),l.x=o.x-o.diags-("r"===o.dir?1:0),l.y=a-o.diags-("d"===o.dir?1:0)}),f.shift(),f}})})}}();