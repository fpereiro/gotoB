!function(){if("object"==typeof exports)e=exports;else var e=window.dale={};var t=function(e,t){var n=typeof e;return"object"!==n&&"number"!==n?n:e instanceof Array?"array":"number"===n?isNaN(e)?"nan":isFinite(e)?e%1==0?"integer":"float":"infinity":(n=Object.prototype.toString.call(e).replace("[object ","").replace("]","").toLowerCase(),"array"===n||"date"===n||"null"===n?n:"regexp"===n?"regex":t?n:"object")},n=function(e){return function(n,r,i,o){if("do"===e)var a=r,s=!0===i,u=[],c=0;else if("fil"===e)var a=i,s=!0===o,u=[],c=0;else if("obj"!==e)var a=i,s=!0===o;else if("object"===t(r))var a=i,s=!0===o,u=r;else var a=r,s=!0===i,u={};if("function"!==t(a))return console.log(("do"===e||"obj"===e&&"object"!==t(r)?"Second":"Third")+" argument passed to dale."+e+" must be a function but instead is",a,"with type",t(a)),!1;if(void 0===n)return u;var l=t(n);"array"===l||("object"===l?"[object Arguments]"===Object.prototype.toString.call(n)&&(l="array"):(l="array",n=[n]));for(var f in n){if("array"===l)f=parseInt(f);else if(!s&&!Object.prototype.hasOwnProperty.call(n,f))continue;var d=a(n[f],f);if("do"===e)u[c++]=d;else if("fil"===e)d!==r&&(u[c++]=d);else if("stop"===e){if(d===r)return d;u=d}else if("stopNot"===e){if(d!==r)return d;u=d}else{if(void 0===d)continue;if("array"!==t(d))return void console.log("aValue returned by fun must be an array but instead is of type "+t(d));u[d[0]]=d[1]}}return u}};e.do=n("do"),e.fil=n("fil"),e.obj=n("obj"),e.stop=n("stop"),e.stopNot=n("stopNot"),e.keys=function(t,n){return e.do(t,function(e,t){return t},n)},e.times=function(e,n,r){if(0===e)return[];{if(!("integer"!==t(e)||e<0)){if(void 0===n)n=1;else if("integer"!==t(n)&&"float"!==t(n))return void console.log("start must be an integer or float.");if(void 0===r)r=1;else if("integer"!==t(r)&&"float"!==t(r))return void console.log("step must be an integer or float.");for(var i=[n];i.length<e;)n+=r,i.push(n);return i}console.log("steps must be a positive integer or zero.")}},e.acc=function(n,r,i,o){var a=arguments.length===("boolean"===t(arguments[arguments.length-1])?4:3),s=a?r:void 0,u=a?i:r,c=a?o:i;if("function"!==t(u))return console.log("fun must be a function but instead is of type",t(u)),!1;var l=!0;return e.do(n,function(e,t){if(!a&&l)return l=!1,s=e;s=u(s,e)},c),s}}(),function(){var e="object"==typeof exports,t=e?require("dale"):window.dale;if(e)n=exports;else var n=window.teishi={};n.t=function(e,t){var n=typeof e;return"object"!==n&&"number"!==n?n:e instanceof Array?"array":"number"===n?isNaN(e)?"nan":isFinite(e)?e%1==0?"integer":"float":"infinity":(n=Object.prototype.toString.call(e).replace("[object ","").replace("]","").toLowerCase(),"array"===n||"date"===n||"null"===n?n:"regexp"===n?"regex":t?n:"object")},n.s=function(){try{return JSON.stringify.apply(JSON.stringify,arguments)}catch(e){return!1}},n.p=function(){try{return JSON.parse.apply(JSON.parse,arguments)}catch(e){return!1}},n.simple=function(e){var t=n.t(e);return"array"!==t&&"object"!==t},n.complex=function(e){return!n.simple(e)},n.c=function(e,r,i){if(n.simple(e))return e;r=r||["$root"],i=i||[r,e];var o=n.t(e,!0),a="array"===o||"arguments"===o?[]:{};return t.do(e,function(e,o){if(n.simple(e))return a[o]=e;var s=t.stopNot(i,void 0,function(t,n){if(n%2!=0&&e===t)return i[n-1]});if(!s)return i.push(r.concat([o]))&&i.push(e),a[o]=n.c(e,r.concat([o]),i.concat());a[o]="CIRCULAR REFERENCE: "+s.join(".")}),a},n.time=function(){return(new Date).getTime()};var r,i=n.time(),o={end:function(){return e?"[0m":""},bold:function(){return e?"[1m":""},white:function(){return e?"[37m":""},color:function(t){if(!e)return"";for(var n=r;r===n;)n=Math.round(5*Math.random()+1);return r=n,"["+(t?"4":"3")+n+"m"}};n.l=function(){var e=o.bold();return function r(i,a){var s=n.t(i),a=a||0,u=!0;"object"===s&&"[object Arguments]"===Object.prototype.toString.call(i)&&(s="array");var c=a<2?"":"\n"+t.do(t.times(a-1),function(e){return"   "}).join("");a>0&&(e+="array"===s?o.white()+"[":o.white()+"{"),t.do(i,function(t,i){var l=n.t(t);if(0===a&&0===i&&("string"===l||"integer"===l))return u=!1,e+=o.color(!0)+t+":"+o.end()+o.bold();if(u||(e+=o.white()+(0===a?" ":", ")),u=!1,"string"===l&&a>0&&(t="'"+t+"'"),"function"===l){var f=(t+="").match(/\s+(?=}$)/);null!==f&&(t=t.replace(new RegExp(f[0],"g"),"\n")),t.length>150&&(t=t.slice(0,150)+"...\n"),a>1&&(t=t.replace(/\n/g,"array"===s?c:"\n"+(i+": ").replace(/./g," ")+c.slice(1)))}e+=o.color(),"object"===s&&(e+=c+(i.match(/^[0-9a-zA-Z_]+$/)?i:"'"+i+"'")+": "),"array"===l||"object"===l?r(t,a+1):e+="object"===s?t:c+t}),a>0&&("array"===s&&(e+=(a>1?"\n":"")+c.slice(4)+o.white()+"]"),"object"===s&&(e+=(a>1?"\n":"")+c.slice(4)+o.white()+"}"))}(n.c(arguments)),console.log("("+(n.time()-i)+"ms)",e+o.end()),!1},n.lno=function(){e=!1},n.makeTest=function(e,r){return"function"!==n.t(e)?n.l("teishi.makeTest","fun passed to teishi.makeTest should be a function but instead is",e,"with type",n.t(e)):("string"===n.t(r)&&(r=[r]),"array"!==n.t(r)?n.l("teishi.makeTest","clauses argument passed to teishi.makeTest should be an array but instead is",r,"with type",n.t(r)):"string"!==n.t(r[0])?n.l("teishi.makeTest","shouldClause passed to teishi.makeTest should be a string but instead is",r[0],"with type",n.t(r[0])):void 0===r[1]||("array"!==n.t(r[1])&&(r[1]=[r[1]]),!0===t.stopNot(r[1],!0,function(e){var t=n.t(e);return"string"===t||"function"===t||n.l("teishi.makeTest","Each finalClause passed to teishi.makeTest should be a string or a function but instead is",e,"with type",t)}))?function(i,o,a,s,u,c){var l=e(a,s);if(!0===l)return!0;if("array"===n.t(l))return l;var f=[],d=0;return void 0!==u&&(f[d++]="each of the"),o[0]&&(f[d++]=o[0]),i&&(f[d++]="passed to",f[d++]=i),f[d++]=r[0],void 0!==c&&(f[d++]="one of"),f[d++]=void 0!==c?c:s,o[1]&&(f[d++]="("+o[1]+")"),f[d++]=void 0!==u?"but one of":"but instead",void 0!==u&&(f[d++]=u),f[d++]="is",f[d++]=a,t.do(r[1],function(e){f[d++]="function"!=typeof e?e:e(a,s)}),f}:void 0)},n.test={type:n.makeTest(function(e,t){return n.t(e)===t},["should have as type",["with type",n.t]]),equal:n.makeTest(function(e,r){return function e(r,i){return n.simple(r)&&n.simple(i)?r===i:n.t(r,!0)===n.t(i,!0)&&(n.s(t.keys(r).sort())===n.s(t.keys(i).sort())&&!1!==t.stop(r,!1,function(t,n){return e(t,i[n])}))}(e,r)},"should be equal to"),notEqual:n.makeTest(function(e,r){return!function e(r,i){return n.simple(r)&&n.simple(i)?r===i:n.t(r,!0)===n.t(i,!0)&&(n.s(t.keys(r).sort())===n.s(t.keys(i).sort())&&!1!==t.stop(r,!1,function(t,n){return e(t,i[n])}))}(e,r)},"should not be equal to"),range:n.makeTest(function(e,r){return"object"!==n.t(r,!0)?["Range options object must be an object but instead is",r,"with type",n.t(r,!0)]:"{}"===n.s(r)||t.stopNot(r,!0,function(t,n){return"min"!==n&&"max"!==n&&"less"!==n&&"more"!==n?['Range options must be one of "min", "max", "less" and "more", but instead is',n]:"min"===n?e>=t:"max"===n?e<=t:"less"===n?e<t:e>t})},"should be in range"),match:n.makeTest(function(e,t){return"string"!==n.t(e)?["Invalid comparison string passed to teishi.test.match. Comparison string must be of type string but instead is",e,"with type",n.t(e)]:"regex"!==n.t(t)?["Invalid regex passed to teishi.test.match. Regex must be of type regex but instead is",t,"with type",n.t(t)]:null!==e.match(t)},"should match")},n.validateRule=function(e){var r=n.t(e);if("function"===r||"boolean"===r)return!0;if("array"!==r)return["each teishi rule must be an array or boolean or function but instead is",e,"with type",r];var i=n.t(e[0]);if("string"!==i&&("array"!==i||2!==e[0].length||"string"!==n.t(e[0][0])||"string"!==n.t(e[0][1])))return!0;if(3===e.length)return!0;if(e.length<3||e.length>5)return["Each teishi simple rule must be an array of length between 3 and 5, but instead is",e,"and has length",e.length];var o,a;return t.stopNot(e,!0,function(t,r){if(r<3)return!0;var i=n.t(t);if("string"===i){if("oneOf"!==t&&"each"!==t&&"eachOf"!==t)return["Invalid multi parameter",t,". Valid multi parameters are",["oneOf","each","eachOf"]];if(a)return["You can pass only one multi parameter to a teishi simple rule but instead you passed two:",e[3],"and",e[4]];a=t}else{if("function"!==i)return["Elements #4 and #5 of a teishi simple rule must be either a string or a function, but element","#"+(r+1),"is",t,"and has type",i];if(o)return["You can pass only one test function to a teishi simple rule but instead you passed two:",e[3],"and",e[4]];o=t}return!0})};var a=function(e,r){return void 0===r?n.l.apply(n.l,["teishi.v"].concat(e)):(e=t.do(e,function(e){return n.complex(e)?n.s(e):e+""}).join(" "),!0===r?e:(r(e),!1))};n.v=function(e,r,i){if("string"===n.t(e))var o=e,s=r,u=i;else var o="",s=e,u=r;if(void 0!==u&&!0!==u&&"function"!==n.t(u))return n.l("teishi.v","Invalid apres argument. Must be either undefined, true, or a function.");var c=n.validateRule(s);if(!0!==c)return a(c,u);var l=n.t(s);if("boolean"===l)return s;if("function"===l)return n.v(o,s(),u);if(0===s.length)return!0;var f=n.t(s[0]);if("boolean"===f&&2===s.length&&"array"===n.t(s[1]))return!1===s[0]||n.v(o,s[1],u);if("string"!==f&&("array"!==f||2!==s[0].length||"string"!==n.t(s[0][0])||"string"!==n.t(s[0][1])))return t.stopNot(s,!0,function(e){return n.v(o,e,u)});var d,p=n.t(s[3]),h=n.t(s[4]),g="function"===p?s[3]:"function"===h?s[4]:n.test.type,v="string"===p?s[3]:"string"===h?s[4]:void 0,m="array"===f?s[0]:[s[0]],b=n.t(s[1],!0),y=n.t(s[2],!0);return("each"===v||"eachOf"===v)&&("array"===b&&0===s[1].length||"object"===b&&0===Object.keys(s[1]).length||void 0===s[1])||(!0===(d="oneOf"!==v&&"eachOf"!==v||!("array"===y&&0===s[2].length||"object"===y&&0===Object.keys(s[2]).length||void 0===s[2])?void 0===v?g(o,m,s[1],s[2]):"each"===v?t.stopNot(s[1],!0,function(e){return g(o,m,e,s[2],s[1])}):"oneOf"===v?t.stop(s[2],!0,function(e){return g(o,m,s[1],e,void 0,s[2])}):t.stopNot(s[1],!0,function(e){return t.stop(s[2],!0,function(t){return g(o,m,e,t,s[1],s[2])})}):["To field of teishi rule is",s.to,"but multi attribute",v,"requires it to be non-empty, at teishi step",s])||a(d,u))},n.stop=function(){return!0!==n.v.apply(n.v,arguments)}}(),function(){var e="object"==typeof exports,t=e?require("dale"):window.dale,n=e?require("teishi"):window.teishi;if(e)r=exports;else var r=window.lith={};var i=n.t;r.k={lithbagElements:["string","integer","float","array","undefined"],tags:["!DOCTYPE HTML","LITERAL","a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","command","datalist","dd","del","details","dfn","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"],voidTags:["!DOCTYPE HTML","area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]},r.entityify=function(e){return!n.stop("lith.entityify",["Entityified string",e,"string"])&&e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/`/g,"&#96;")},r.v=function(e){var o=i(e);if("array"===o&&"string"===i(e[0])&&-1!==r.k.tags.indexOf(e[0])){var a="object"===i(e[1])?e[1]:void 0,s=e[a?2:1];return!!n.v([["lith length",e.length,{min:1,max:3},n.test.range],[void 0===a,["length of lith without attributes",e.length,{max:2},n.test.range]],[["lith attribute keys","start with an ASCII letter, underscore or colon, and be followed by letters, digits, underscores, colons, periods, dashes, extended ASCII characters, or any non-ASCII characters."],t.keys(a),/^[a-zA-Z_:][a-zA-Z_:0-9.\-\u0080-\uffff]*$/,"each",n.test.match],["lith attribute values",a,["string","integer","float","undefined","null","boolean"],"eachOf"],["lith contents",s,r.k.lithbagElements,"oneOf"]])&&"Lith"}return!!n.v([["lithbag",o,r.k.lithbagElements,"oneOf",n.test.equal],["array"===o,["lithbag element",e,r.k.lithbagElements,"eachOf"]]])&&"Lithbag"},r.g=function(e,t){if(t||r.prod)return"array"===i(e)&&-1!==r.k.tags.indexOf(e[0])?r.generateLith(e,!0):r.generateLithbag(e,!1,!0);var n=r.v(e);return!!n&&r["generate"+n](e)},r.generateLithbag=function(e,n,o){var a="";return!1!==t.stop(e,!1,function(e){if(void 0!==e){i(e);if("array"!==i(e))return a+=n?e:r.entityify(e+"");if(o)a+=r.g(e,o);else{var t=r.g(e,o);if(!1===t)return!1;a+=t}}})&&a},r.generateLith=function(e,n){var o="object"===i(e[1])?e[1]:void 0,a=e[o?2:1];if("LITERAL"===e[0])return a;var s="<"+e[0];if(t.do(o,function(e,t){(e||0===e)&&(s+=" "+r.entityify(t+"")+'="'+r.entityify(e+"")+'"')}),s+=">","array"===i(a))if(n)s+=r.g(a,n);else{var u=r.g(a);if(!1===u)return!1;s+=u}else s+=r.generateLithbag(a,"style"===e[0]||"script"===e[0],n);return-1===r.k.voidTags.indexOf(e[0])&&(s+="</"+e[0]+">"),s},r.css={},r.css.v=function(e){if(n.stop(["litc or litcbag",e,"array"]))return!1;if(0===e.length||"array"===i(e[0]))return!0;var t="object"===i(e[1])?e[1]:void 0,o=e[t?2:1];return n.v([["litc length",e.length,{min:1,max:3},n.test.range],[void 0===t,["length of litc without attributes",e.length,{max:2},n.test.range]],["litc selector",e[0],"string"],r.css.vAttributes(t),["LITERAL"!==e[0],["litc contents",o,["undefined","array"],"oneOf"]]])},r.css.vAttributes=function(e){return n.v([["litc attribute values",e,["string","integer","float","object","undefined","null","boolean"],"eachOf"]])},r.css.g=function(e,n){if(!1===r.css.v(e))return!1;if(0===e.length)return"";var o="";if("LITERAL"===e[0])return e[1];if("array"===i(e[0]))return!1!==t.stop(e,!1,function(e,t){var i=r.css.g(e,n);if(!1===i)return!1;o+=i})&&o;void 0===n&&(n="");var a="object"===i(e[1])?e[1]:void 0,s=e[a?2:1];n=t.do(n.split(/,\s*/),function(n){return t.do(e[0].split(/,\s*/),function(e){return e.match(/&/)?e.replace("&",n):n+(0===n.length?"":" ")+e}).join(", ")}).join(", "),o+=n+"{";var u=function(e){return!1!==r.css.vAttributes(e)&&t.stop(e,!1,function(e,n){if(e||0===e){var r=i(e);if("object"===r)return u(e);"integer"===r&&(e<0||e>1)&&(e+="px"),"float"!==r&&1!==e||(e=100*e+"%"),t.do(n.split(/,\s*/),function(t){o+=t+":"+e+";"})}})};if(!1===u(a))return!1;if(o+="}",s){var c=r.css.g(s,n);if(!1===c)return!1;o+=c}return o},r.css.media=function(e,t){return!n.stop(["selector",e,"string"])&&[["LITERAL","@media "+e+" {"],t,["LITERAL","}"]]}}(),function(){var e="object"==typeof exports,t=e?require("dale"):window.dale,n=e?require("teishi"):window.teishi,r=n.t,i=n.stop,o=function(e){if(!i([["store",e,["array","object","undefined"],"oneOf"]])){var o={};return o.routes={},o.store=e||{},o.do=function(e,t){return n.simple(t)&&(t=[t]),!i("r",[["verb",e,"string"],["path",t,"array"],function(){return["path length",t.length,{min:1},n.test.range]},["path",t,["integer","string"],"eachOf"]])&&(o.mill.apply(null,arguments),!0)},o.listen=function(e,r){return e=e||{},n.simple(e.path)&&(e.path=[e.path]),!n.stop("r.radd",[["opts",e,"object"],function(){return[["opts.verb",e.verb,"string"],["opts.path",e.path,"array"],["opts.path",e.path,["integer","string"],"eachOf"],["opts.id",e.id,["string","integer","undefined"],"oneOf"],["opts.parent",e.parent,["string","integer","undefined"],"oneOf"],["opts.priority",e.priority,["undefined","integer"],"oneOf"],["opts.burn",e.burn,["undefined","boolean"],"oneOf"]]},["route function",r,"function"]])&&(e.id&&o.routes[e.id]?n.l("r.radd","A route with id",e.id,"already exists."):(e.id=e.id||o.random(),o.routes[e.id]=t.obj(["parent","priority","burn"],{id:e.id,verb:e.verb,path:e.path,rfun:r},function(t){if(e[t])return[t,e[t]]}),e.id))},o.forget=function(e,i){if(!o.routes[e])return n.l("Route",e,"does not exist.");i&&"function"===r(i)&&i(o.routes[e]),delete o.routes[e],t.do(o.routes,function(t,n){t.parent===e&&o.forget(n,i)})},o.mill=function(e,t){var n=[{verb:arguments[0],path:arguments[1]}].concat([].slice.call(arguments,2)),i=function(e){if(0!==e.length){n[0].cb=function(){i(e)};var t=e.shift();if(!o.routes[t.id])return i(e);t.burn&&o.forget(t.id),"function"!==r(t.rfun.apply(null,n))&&i(e)}};i(o.sort(o.match(e,t,o.routes)))},o.match=function(e,n,r){var i=[];return t.do(r,function(r){"*"!==e&&"*"!==r.verb&&r.verb!==e||r.path.length>n.length||t.stop(r.path,!1,function(e,t){return(void 0===n[t]||"*"===n[t]||"*"===e||n[t]===e)&&(t===r.path.length-1?(i.push(r),!1):void 0)})}),i},o.sort=function(e){return e.sort(function(e,t){var n=e.priority||0;return(t.priority||0)-n})},o.random=function(){return Math.random().toString(16).slice(2)},o}};e?module.exports=o:window.R=o}(),function(){if("object"==typeof exports)return console.log("cocholate only works in a browser!");var e=window.dale,t=window.teishi,n=t.t,r=window.c=function(i,o){if(t.stop("c",["fun",o,["function","undefined"],"oneOf"]))return!1;var a=r.find(i);if(!1===a)return!1;if(o){var s=t.c(arguments).slice(2);a=e.do(a,function(e){return o.apply(void 0,[e].concat(s))})}return"string"===n(i)&&i.match(/^[a-z]*#[^\s\[>,:]+$/)?a[0]:a};r.nodeListToArray=function(e){return[].slice.call(e)},r.setop=function(t,n,i){if("and"===t)return e.fil(n,void 0,function(e){return-1!==i.indexOf(e)?e:void 0});var o=n.slice();return"or"===t?e.do(i,function(e){-1===o.indexOf(i)&&o.push(e)}):(0===o.length&&(o=r.nodeListToArray(document.getElementsByTagName("*"))),e.do(i,function(e){var t=o.indexOf(e);-1!==t&&o.splice(t,1)})),o},r.find=function(i){var o=n(i);if(t.stop("cocholate",[["selector",i,["array","string","object"],"oneOf"],function(){return[["array"===o,["first element of array selector",i[0],[":and",":or",":not"],"oneOf",t.test.equal]],["object"===o,[["selector keys",e.keys(i),["selector","from"],"eachOf",t.test.equal],["valid HTML node",i.from,"undefined",t.test.notEqual],function(){return[["from.querySelectorAll","valid HTML node"],i.from.querySelectorAll,"function"]}]]]}]))return!1;if("string"===o)return r.nodeListToArray(document.querySelectorAll(i));if("object"===o)return r.nodeListToArray(i.from.querySelectorAll(i.selector));var a=i.shift(),s=[];return e.stop(i,!1,function(e,t){var n=r.find(e);if(!1===n)return s=!1;s=0===t&&":not"!==a?n:r.setop(a.replace(":",""),s,n)}),s},r.empty=function(t){r(t,function(t){e.do(r.nodeListToArray(t.getElementsByTagName("*")),function(e){e.remove()})})},r.fill=function(e,n){if(t.stop("c.fill",["html",n,"string"]))return!1;r.empty(e),r(e,function(e){e.innerHTML=n})},r.place=function(e,n,i){if(t.stop("c.place",[["where",n,["beforeBegin","afterBegin","beforeEnd","afterEnd"],"oneOf",t.test.equal],["html",i,"string"]]))return!1;r(e,function(e){e.insertAdjacentHTML(n,i)})},r.get=function(n,i,o){return!t.stop("c.get",["attributes",i,["string","array"],"oneOf"])&&r(n,function(t){return e.obj(i,function(e){return o?[e,t.style[e]||null]:[e,t.getAttribute(e)]})})},r.set=function(n,i,o,a){if(t.stop("c.set",[["attributes",i,"object"],[["attribute keys","start with an ASCII letter, underscore or colon, and be followed by letters, digits, underscores, colons, periods, dashes, extended ASCII characters, or any non-ASCII characters."],e.keys(i),/^[a-zA-Z_:][a-zA-Z_:0-9.\-\u0080-\uffff]*$/,"each",t.test.match],["attribute values",i,["integer","string","null"],"eachOf"]]))return!1;r(n,function(t){e.do(i,function(e,n){o?t.style[n]=null===e?"":e:null===e?t.removeAttribute(n):t.setAttribute(n,e)}),t.onchange&&!a&&t.onchange()})},r.ready=function(e){if(document.addEventListener)return document.addEventListener("DOMContentLoaded",e);document.attachEvent?document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&e()}):e()},r.cookie=function(t){return!1===t?e.do(document.cookie.split(";s+"),function(e){return document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()),e}):e.obj((t||document.cookie).split(/;\s*/),function(e){if(""!==e)return[(e=e.split("="))[0],e.slice(1).join("=")]})},r.ajax=function(n,r,i,o,a){if(n=n||"GET",i=i||"",o=o||{},a=a||function(){},t.stop("c.ajax",[["method",n,"string"],["path",r,"string"],["headers",o,"object"],["callback",a,"function"]]))return!1;var s=new XMLHttpRequest;return s.open(n.toUpperCase(),r,!0),t.complex(i)&&"formdata"!==t.t(i,!0)&&(o["content-type"]=o["content-type"]||"application/json",i=t.s(i)),e.do(o,function(e,t){s.setRequestHeader(t,e)}),s.onreadystatechange=function(){4===s.readyState&&(200!==s.status?a(s):a(null,s))},s.send(i),{headers:o,body:i}},r.polyfill=function(){var t=function(){return document.createElement("_")};t().insertAdjacentHTML||(HTMLElement.prototype.insertAdjacentHTML=function(e,n){var r,i,o,a=this,s=t(),u=a.parentNode;if(s.innerHTML=n,"beforeBegin"===e)for(;r=s.firstChild;)u.insertBefore(r,a);else if("afterBegin"===e)for(i=a.firstChild;r=s.lastChild;)a.insertBefore(r,i);else if("beforeEnd"===e)for(;r=s.firstChild;)a.appendChild(r);else for(o=a.nextSibling;r=s.lastChild;)u.insertBefore(r,o)}),Element.prototype.remove||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,n){var r=e.stopNot(n?this.slice(n):this,void 0,function(e,n){if(t===e)return n});return void 0===r?-1:r})},r.polyfill()}(),function(){if("object"==typeof exports)return console.log("gotoB only works in a browser!");var e=window.dale,t=window.teishi,n=window.lith,r=window.c,i=t.t,o=t.l,a=window.R(),s=window.B={v:"0.4.0",B:"в",r:a,routes:a.routes,store:a.store,do:a.do,listen:a.listen,forget:a.forget};s.debug=[],s.debug.log=function(n,r,i){return!(!s.prod&&t.stop([["from",n,"integer"],["to",r,["integer","undefined"],"oneOf"]]))&&(n<0&&(n=s.debug.length+n,r=s.debug.length),r=r||n,e.fil(e.times(r-n+1,n),void 0,function(e,t){var r=s.debug[n+t];if(r)return i||console.log(n+t,r[0].verb,r[0].path,[].slice.call(r,1)),r}))},s.listen({id:"debug",verb:"*",path:"*"},function(){s.debug.push([].slice.call(arguments,0))});var u=function(e){return t.v([["path",e,"array"],function(){return["path length",e.length,{min:1},t.test.range]},["path",e,["integer","string"],"eachOf"]])};s.add=function(e,n){if(t.simple(e)&&(e=[e]),!u(e))return!1;var r=s.get(e);return!1!==r&&("array"!==i(r)?o("B.add","Cannot add to something that is not an array"):(r.push(n),!0))},s.rem=function(n,r){if(t.simple(n)&&(n=[n]),!u(n))return!1;var a=s.get(n);return t.simple(a)?o("B.rem","Cannot remove elements from simple target."):("array"===i(a)?"*"===r?a.splice(0,a.length):("array"===i(r)&&r.sort(function(e,t){return t-e}),e.do(r,function(e){a.splice(e,1)})):"*"===r?e.do(a,function(e,t){delete a[t]}):e.do(r,function(e){delete a[e]}),!0)},s.get=function(n){if(t.simple(n)&&(n=[n]),!u(n))return!1;var r=s.store;return!1===e.stop(n,!1,function(e,i){if(i+1<n.length&&t.simple(r[e]))return!1;r=r[e]})?void 0:r},s.set=function(n,r){if(t.simple(n)&&(n=[n]),!u(n))return!1;var o=s.store;return e.do(n,function(e,t){t+1===n.length?o[e]=r:(void 0===o[e]&&(o[e]="string"===i(n[t+1])?{}:[]),o=o[e])}),!0},s.equal=function(n,r){return t.simple(n)&&t.simple(r)?n===r:t.t(n,!0)===t.t(r,!0)&&(t.s(e.keys(n).sort())===t.s(e.keys(r).sort())&&e.stop(n,!1,function(e,t){return s.equal(e,r[t])}))},e.do(["add","rem","get","set"],function(e){s.listen({id:e,verb:e,path:"*"},function(e,t){if("set"===e.verb)var n=s.get(e.path);s[e.verb].apply(null,[e.path].concat([].slice.call(arguments,1))),"add"!==e.verb&&"rem"!==e.verb||s.do("change",e.path,s.get(e.path)),"set"!==e.verb||s.equal(n,t)||s.do("change",e.path,t)})}),s.ev=function(n,r){if(!s.prod&&t.stop([["attrs",n,"object"],["evs",r,["object","array"],"oneOf"],["array"===i(r),["evs",r,"object","each"]]]))return!1;"object"===i(r)&&(r=[r]);var o={};return e.do(r,function(e){o[e.ev]?o[e.ev].push(e):o[e.ev]=[e]}),e.obj(o,n,function(t,n){var r="";return e.do(t,function(t){var n=[JSON.stringify(t.verb),JSON.stringify(t.path)];n=t.args?n.concat(e.do(t.args,JSON.stringify)):n.concat(["this.value","event"]),r+="B.do ("+n.join(", ")+");"}),[n,r]})},s.view=function(r,a){if(!s.prod&&t.stop([["params",r,"object"],["rfun",a,"function"],function(){return[[void 0!==r.tag,["params.tag",r.tag,n.k.tags,"oneOf",t.test.equal]],["params.attrs",r.attrs,["object","undefined"],"oneOf"],["params.ondraw",r.ondraw,["function","undefined"],"oneOf"],["params.onforget",r.onforget,["function","undefined"],"oneOf"]]}]))return!1;var c=r.tag||"div",l=r.attrs||{};if(r.path="array"===i(r.path)?r.path:[r.path],!u(r.path))return!1;var f=l.id="в"+s.count++;if(l["data-в"]=r.path.join(":"),!1===e.stop("object"===i(r.listen)?[r.listen]:r.listen,!1,function(e){if(!e)return!1;var t=s.listen(e,e.rfun);if(!1===t)return!1;s.routes[t].parent=f}))return!1;if(!1===s.listen({verb:"change",path:r.path,id:f},function(e){var t=a(e,s.get(r.path));if(!s.prod&&!n.v(t))return o("B.view received invalid view",t,e);s.resolve(f,t),r.ondraw&&r.ondraw(r)}))return o("Invalid parameters passed to B.view:",r,a);var d=a({verb:"change",path:r.path},s.get(r.path));return s.prod||n.v(d)?(s.routes[f].view=d,s.routes[f].priority=-2,s.routes[f].onforget=r.onforget,d=n.g(d,s.prod),e.do(s.getChildren(d),function(e){s.routes[e].priority--,s.routes[e].parent||(s.routes[e].parent=f)}),r.ondraw&&r.ondraw(r),[c,l,["LITERAL",d]]):o("B.view received invalid view",d,x)},s.getChildren=function(t){var n=(t||"").match(/id="в[0-9a-f]+/g)||[];return e.do(n,function(e){return e.slice(4)})},s.count=0,s.resolvequeue=[],s.resolving=!1,s.resolve=function(n,u,c){if(s.resolving&&!c)return s.resolvequeue.push([n,u]);s.resolving=!0;var l=function(){var t,n=e.stopNot(s.resolvequeue,void 0,function(e,t){if(s.routes[e[0]])return t});if(void 0!==n)return t=s.resolvequeue[n],s.resolvequeue.splice(0,n+1),s.resolve.apply(null,t.concat(!0));s.resolving=!1};if(!r("#"+n))return o("B.resolve","Attempted to redraw dangling view",n),l();var f=r("#"+n).innerHTML,d=s.routes[n],p=s.prediff(d.view),h=s.prediff(u),g=s.diff(p,h);e.do(a.routes,function(e){e.parent===n&&e.view&&s.forget(e.id,function(e){e.onforget&&e.onforget()})});var v=function(e,t,n){var r=m(t,"insert1",n);r?r.parentNode.insertBefore(e,r):m(t.slice(0,t.length-1),"insert2",n).appendChild(e)},m=function(r,i,a){var s=document.getElementById(n);return e.do(r,function(c,l){if(!s)throw o("BOOM! YOU FOUND A BUG IN gotoB! Please open a pull request at http://github.com/fpereiro/gotoB/issues and paste the text below:\n",JSON.stringify({debug:i,debugpos:a,diffitem:g[a].slice(0,2).join(" "),id:n,where:r,k:l,backup:f,oldView:d.view,newView:u,diff:e.obj(t.c(g),function(e,t){return[t,e]})})),new Error("gotoB redraw error!");s=s.childNodes[c]}),s},b=[0],y=[0],w={add:{tag:null,index:null},rem:{tag:null,index:null}};e.do(g,function(e,n){if(!e[1].match(/^<</))if(e[1].match(/^>/)||(g[n][2]={el:m(b,"sequence",n),old:t.c(b),New:t.c(y)}),e[1].match(/^</)){g[n][2].active=g[n][2].el===document.activeElement;var r=e[1].match(/[^\s]+/g)[0],i=e[1].match(/<.+ {.*"opaque":true.*}/);"add"!==e[0]||i||(w.rem.tag===r?(g[n][2].match=w.rem.index,g[w.rem.index][2].match=n,w.rem.tag=w.rem.index=null):(w.add.tag=r,w.add.index=n)),"rem"!==e[0]||i||(w.add.tag===r?(g[n][2].match=w.add.index,g[w.add.index][2].match=n,w.add.tag=w.add.index=null):(w.rem.tag=r,w.rem.index=n)),"add"!==e[0]&&b.push(0),"rem"!==e[0]&&y.push(0)}else e[1].match(/^>/)?("add"!==e[0]&&(b.pop(),b[b.length-1]++),"rem"!==e[0]&&(y.pop(),y[y.length-1]++)):("add"!==e[0]&&b[b.length-1]++,"rem"!==e[0]&&y[y.length-1]++)});var j={};e.do(g,function(t,n){if(!t[1].match(/^>/))if(t[1].match(/^<</))"rem"!==t[0]&&(g[n-1][2].el.innerHTML=t[1].slice(1));else{if("keep"===t[0])return t[1].match(/<.+ {.*"opaque":true.*}/)&&(t[2].el.innerHTML=""),v(t[2].el.parentNode.removeChild(t[2].el),t[2].New,n),void(t[2].active&&"a"!==t[1].match(/[^<\s]+/g)[0]&&(t[2].el.focus?t[2].el.focus():t[2].el.setActive()));if(t[1].match(/^</)){if("rem"===t[0]&&(void 0===t[2].match||t[2].match>n)&&(j[t[2].old]=t[2].el.parentNode.removeChild(t[2].el)),"add"===t[0]){var r;if(void 0!==t[2].match){var o=g[t[2].match];j[o[2].old]||(j[o[2].old]=o[2].el);var a=(r=o[2].el).attributes;"moznamedattrmap"===i(a,!0)&&(a=e.obj(a,function(e){if(e)return[e.name,e.value]}));var s=JSON.parse(t[1].match(/{.+/)||"{}");e.do(e.fil(a,void 0,function(e){if(void 0===s[e.name])return e.name}),function(e){"value"===e&&(r.value=void 0),"checked"===e&&(r.checked=!1),"selected"===e&&(r.selected=!1),r.removeAttribute(e)}),e.do(s,function(e,t){"value"===t&&(r.value=e),"checked"===t&&(r.checked=e),"selected"===t&&(r.selected=e),r.setAttribute(t,e)})}else r=document.createElement(t[1].match(/[^<\s]+/g)[0]),e.do(JSON.parse(t[1].match(/{.+/)||"{}"),function(e,t){r.setAttribute(t,e)});v(r,t[2].New,n),t[2].el=r,o&&o[2].active&&"a"!==t[1].match(/[^<\s]+/g)[0]&&(r.focus?r.focus():r.setActive())}}else"add"===t[0]?(t[1]=t[1].replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#96;/g,"`"),v(document.createTextNode(t[1]),t[2].New,n)):t[2].el.parentNode.removeChild(t[2].el)}}),d.view=u,e.do(s.getChildren(r("#"+n).innerHTML),function(e){s.routes[e].priority=s.routes[e].priority+s.routes[n].priority+1,s.routes[e].parent||(s.routes[e].parent=n),s.routes[e].ondraw&&s.routes[e].ondraw()}),l()},s.prediff=function(r,o){if(t.simple(r))return void 0===r||""===r?o?void 0:[]:o?(0===o.length&&o.push(""),o[o.length-1].match(/^(<|>)/)&&o.push(""),o[o.length-1]+=n.g(r,s.prod)):[n.g(r,s.prod)];if(o=o||[],-1!==n.k.tags.indexOf(r[0])){o.push("<"+r[0]);var a="object"===i(r[1])?r[1]:void 0,u=r[a?2:1];a&&(o[o.length-1]+=" "+JSON.stringify(a),a.opaque?o.push("<"+n.g(u,s.prod)):a.id&&a.id.match(/^в[0-9a-f]+$/g)&&(u=s.routes[a.id].view));var c=o.length;a&&a.opaque||s.prediff(u,o),"table"===r[0]&&o[c]&&null===o[c].match(/<tbody/)&&(o.splice(c,0,"<tbody"),o.push(">")),o.push(">")}else e.do(r,function(e){s.prediff(e,o)});return o},s.diff=function(t,n){for(var r,i,o,a,s,u,c,l,f,d=[],p=0;p<t.length+n.length+1;){for(r=d[d.length-1]||{1:[0,0]},i={},d.push(i),o=-p;o<2*p-p+1;){for(s=(a=o===-p||o!==p&&r[o-1][1]<r[o+1][1]?[0,r[o+1][1]]:[0,r[o-1][1]+1,!0])[1]-o;a[1]<t.length&&s<n.length&&t[a[1]]===n[s];)a[1]++,s++,a[0]++;if(i[o]=a,!(a[1]<t.length||s<n.length)){for(u={x:a[1],y:s},c=[],l=p;l>-1;)s=(f=d[l][u.x-u.y])[1]-(u.x-u.y),f[0]&&e.do(e.times(f[0]),function(e){c.unshift(["keep",t[f[1]-e]])}),f[2]?c.unshift(["rem",t[f[1]-f[0]-1]]):c.unshift(["add",n[s-f[0]-1]]),u.x=f[1]-f[0]-(f[2]?1:0),u.y=s-f[0]-(f[2]?0:1),l--;return c.shift(),c}o+=2}p++}}}();