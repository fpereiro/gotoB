!function(){var d,e="object"==typeof exports;d=e?exports:window.dale={};var p=function(){return Object.prototype.toString.call(arguments).match("arguments")}(),g=function(e,t){var n=typeof e;return"function"===n?Object.prototype.toString.call(e).match(/regexp/i)?"regex":"function":"object"!==n&&"number"!==n?n:e instanceof Array?"array":"number"===n?isNaN(e)?"nan":isFinite(e)?e%1==0?"integer":"float":"infinity":null===e?"null":"array"===(n=Object.prototype.toString.call(e).replace("[object ","").replace("]","").toLowerCase())||"date"===n?n:"regexp"===n?"regex":t?!p&&"function"===n(e.callee)?"arguments":n:"object"};try{d.clog=console.log.bind(console)}catch(n){d.clog=function(){var e=d.go(arguments,function(e){return e===undefined?"undefined":e}).join(" ");window.console?window.console.log(e):alert(e)}}var t=function(f){return function(e,t,n,r){var i,o,a,u,s;if("go"===f?(o=t,a=!0===n,u=[],i=0):"fil"===f?(o=n,a=!0===r,u=[],i=0):"obj"!==f?(o=n,a=!0===r):u="object"===g(t)?(o=n,a=!0===r,t):(o=t,a=!0===n,{}),"function"!==g(o))return d.clog(("go"===f||"obj"===f&&"object"!==g(t)?"Second":"Third")+" argument passed to dale."+f+" must be a function but instead is",o,"with type",g(o)),!1;if(e===undefined)return u;s="go"===f?function(e){u[i++]=e}:"fil"===f?function(e){e!==t&&(u[i++]=e)}:"obj"===f?function(e){if(e!==undefined)return"array"!==g(e)||2!==e.length?(d.clog("array"===g(e)?"fun passed to dale.obj must return undefined or an array of length 2 but instead returned an array of length "+e.length:"fun passed to dale.obj must return undefined or an array of length 2 but instead returned a value of type "+g(e)),!(u=!1)):void(u[e[0]]=e[1])}:function(e){return u=e,"stop"===f?e===t:e!==t};var c=g(e);if("object"===c&&("[object Arguments]"!==Object.prototype.toString.call(e)&&(p||"function"!==g(e.callee))||(c="array",e=[].slice.call(e))),"array"===c)for(var l=0;l<e.length&&!s(o(e[l],parseInt(l)));l++);else if("object"===c){for(var l in e)if((a||!e.hasOwnProperty||e.hasOwnProperty(l))&&s(o(e[l],l)))break}else s(o(e,0));return u}};d.go=t("go"),d.fil=t("fil"),d.obj=t("obj"),d.stop=t("stop"),d.stopNot=t("stopNot"),d.keys=function(e,t){return d.go(e,function(e,t){return t},t)},d.times=function(e,t,n){if(0===e)return[];if("integer"!==g(e)||e<0)return d.clog("steps must be a positive integer or zero."),!1;if(t===undefined)t=1;else if("integer"!==g(t)&&"float"!==g(t))return d.clog("start must be an integer or float."),!1;if(n===undefined)n=1;else if("integer"!==g(n)&&"float"!==g(n))return d.clog("step must be an integer or float."),!1;for(var r=[t];r.length<e;)t+=n,r.push(t);return r},d.acc=function(e,t,n,r){var i=arguments.length===("boolean"===g(arguments[arguments.length-1])?4:3),o=i?t:undefined,a=i?n:t,u=i?r:n;if("function"!==g(a))return d.clog("fun must be a function but instead is of type",g(a)),!1;var s=!0;return d.go(e,function(e,t){return!i&&s?(s=!1,o=e):void(o=a(o,e))},u),o}}(),function(){var v,n="object"==typeof exports,w=n?require("dale"):window.dale;v=n?exports:window.teishi={},Array.prototype.indexOf||(Array.prototype.indexOf=function(n,r){var e=w.stopNot(this,undefined,function(e,t){if(!(r&&t<r))return n===e?t:void 0});return e===undefined?-1:e});var r=function(){return Object.prototype.toString.call(arguments).match("arguments")}();v.type=function(e,t){var n=typeof e;return"function"===n?Object.prototype.toString.call(e).match(/regexp/i)?"regex":"function":"object"!==n&&"number"!==n?n:e instanceof Array?"array":"number"===n?isNaN(e)?"nan":isFinite(e)?e%1==0?"integer":"float":"infinity":null===e?"null":"array"===(n=Object.prototype.toString.call(e).replace("[object ","").replace("]","").toLowerCase())||"date"===n?n:"regexp"===n?"regex":t?!r&&"function"===v.type(e.callee)?"arguments":n:"object"},v.str=function(){try{return JSON.stringify.apply(JSON.stringify,arguments)}catch(e){return!1}},v.parse=function(){try{return JSON.parse.apply(JSON.parse,arguments)}catch(e){return!1}},v.simple=function(e){var t=v.type(e);return"array"!==t&&"object"!==t},v.complex=function(e){return!v.simple(e)},v.copy=function(r,i){if(v.simple(r))return r;var e=v.type(r,!0),o="array"===e||"arguments"===e?[]:{};return w.go(r,function(e,t){if(v.simple(e))return o[t]=e;var n=i?i.concat():[r];return-1<n.indexOf(e)?o[t]="[Circular]":(n.push(e),o[t]=v.copy(e,n))}),o},v.eq=function(e,n){return v.simple(e)&&v.simple(n)?e===n:v.type(e,!0)===v.type(n,!0)&&(v.str(w.keys(e).sort())===v.str(w.keys(n).sort())&&!1!==w.stop(e,!1,function(e,t){return v.eq(e,n[t])}))},v.last=function(e,t){return-1===["array","arguments"].indexOf(v.type(e,!0))?v.clog("First argument passed to teishi.last must be array or arguments but instead has type "+v.type(e,!0)):t!==undefined&&("integer"!==v.type(t)||t<1)?v.clog("Second argument passed to teishi.last must be either undefined or an integer larger than 0."):e[e.length-(t||1)]},v.time=function(e){return arguments.length?new Date(e).getTime():(new Date).getTime()};var i,l=function(){return n?"[0m":""},f=function(){return n?"[1m":""},d=function(){return n?"[37m":""},p=function(e){if(!n)return"";for(var t=i;i===t;)t=Math.round(5*Math.random()+1);return"["+(e?"4":"3")+(i=t)+"m"};v.clog=function(){var s=f();!function c(e,i){var o=v.type(e),i=i||0,a=!0;"object"===o&&"[object Arguments]"===Object.prototype.toString.call(e)&&(o="array");var u=i<2?"":"\n"+w.go(w.times(i-1),function(e){return"   "}).join("");0<i&&(s+="array"===o?d()+"[":d()+"{"),w.go(e,function(e,t){var n,r=v.type(e);if(0===i&&0===t&&("string"===r||"integer"===r))return s+=p(!(a=!1))+e+":"+l()+f();a||(s+=d()+(0===i?" ":", ")),a=!1,"string"===r&&0<i&&(e="'"+e+"'"),"function"===r&&(null!==(n=(e+="").match(/\s+(?=}$)/))&&(e=e.replace(new RegExp(n[0],"g"),"\n")),150<e.length&&(e=e.slice(0,150)+"...\n"),1<i&&(e=e.replace(/\n/g,"array"===o?u:"\n"+(t+": ").replace(/./g," ")+u.slice(1)))),s+=p(),"object"===o&&(s+=u+(t.match(/^[0-9a-zA-Z_]+$/)?t:"'"+t+"'")+": "),"array"===r||"object"===r?c(e,i+1):s+="object"===o?e:u+e}),0<i&&("array"===o&&(s+=(1<i?"\n":"")+u.slice(4)+d()+"]"),"object"===o&&(s+=(1<i?"\n":"")+u.slice(4)+d()+"}"))}(v.copy(arguments));var e=new Date;return w.clog("("+e[e.toISOString?"toISOString":"toString"]()+")",s+l()),!1},v.lno=function(){n=!1},v.makeTest=function(c,l){if("function"!==v.type(c))return v.clog("teishi.makeTest","fun passed to teishi.makeTest should be a function but instead is",c,"with type",v.type(c));if("string"===v.type(l)&&(l=[l]),"array"!==v.type(l))return v.clog("teishi.makeTest","clauses argument passed to teishi.makeTest should be an array but instead is",l,"with type",v.type(l));if("string"!==v.type(l[0]))return v.clog("teishi.makeTest","shouldClause passed to teishi.makeTest should be a string but instead is",l[0],"with type",v.type(l[0]));if(l[1]!==undefined&&("array"!==v.type(l[1])&&(l[1]=[l[1]]),!0!==w.stopNot(l[1],!0,function(e){var t=v.type(e);return"string"===t||"function"===t||v.clog("teishi.makeTest","Each finalClause passed to teishi.makeTest should be a string or a function but instead is",e,"with type",t)})))return;return function(e,t,n,r,i,o){var a=c(n,r);if(!0===a)return!0;if("array"===v.type(a))return a;var u=[],s=0;return i!==undefined&&(u[s++]="each of the"),t[0]&&(u[s++]=t[0]),e&&(u[s++]="passed to",u[s++]=e),u[s++]=l[0],o!==undefined&&(u[s++]="one of"),u[s++]=o!==undefined?o:r,t[1]&&(u[s++]="("+t[1]+")"),u[s++]=i!==undefined?"but one of":"but instead",i!==undefined&&(u[s++]=i),u[s++]="is",u[s++]=n,w.go(l[1],function(e){u[s++]="function"!=typeof e?e:e(n,r)}),u}},v.test={type:v.makeTest(function(e,t){return v.type(e)===t},["should have as type",["with type",v.type]]),equal:v.makeTest(v.eq,"should be equal to"),notEqual:v.makeTest(function(e,t){return!v.eq(e,t)},"should not be equal to"),range:v.makeTest(function(n,e){return"object"!==v.type(e,!0)?["Range options object must be an object but instead is",e,"with type",v.type(e,!0)]:"{}"===v.str(e)||w.stopNot(e,!0,function(e,t){return"min"!==t&&"max"!==t&&"less"!==t&&"more"!==t?['Range options must be one of "min", "max", "less" and "more", but instead is',t]:"min"===t?e<=n:"max"===t?n<=e:"less"===t?n<e:e<n})},"should be in range"),match:v.makeTest(function(e,t){return"string"!==v.type(e)?["Invalid comparison string passed to teishi.test.match. Comparison string must be of type string but instead is",e,"with type",v.type(e)]:"regex"!==v.type(t)?["Invalid regex passed to teishi.test.match. Regex must be of type regex but instead is",t,"with type",v.type(t)]:null!==e.match(t)},"should match")},v.validateRule=function(r){var e=v.type(r);if("function"===e||"boolean"===e)return!0;if("array"!==e)return["each teishi rule must be an array or boolean or function but instead is",r,"with type",e];var i,o,t=v.type(r[0]);return"string"!==t&&("array"!==t||2!==r[0].length||"string"!==v.type(r[0][0])||"string"!==v.type(r[0][1]))||(3===r.length||(r.length<3||5<r.length?["Each teishi simple rule must be an array of length between 3 and 5, but instead is",r,"and has length",r.length]:w.stopNot(r,!0,function(e,t){if(t<3)return!0;var n=v.type(e);if("string"===n){if("oneOf"!==e&&"each"!==e&&"eachOf"!==e)return["Invalid multi parameter",e,". Valid multi parameters are",["oneOf","each","eachOf"]];if(o)return["You can pass only one multi parameter to a teishi simple rule but instead you passed two:",r[3],"and",r[4]];o=e}else{if("function"!==n)return["Elements #4 and #5 of a teishi simple rule must be either a string or a function, but element","#"+(t+1),"is",e,"and has type",n];if(i)return["You can pass only one test function to a teishi simple rule but instead you passed two:",r[3],"and",r[4]];i=e}return!0})))};var j=function(e,t){return t===undefined?v.clog.apply(v.clog,["teishi.v"].concat(e)):(e=w.go(e,function(e){return v.complex(e)?v.str(e):e+""}).join(" "),!0===t?e:(t(e),!1))};v.v=function(e,t,n,r){var i,o,a,u;if(!(u="string"===v.type(e)?(i=e,o=t,a=n,r):(i="",o=e,a=t,n))){if(a!==undefined&&!0!==a&&"function"!==v.type(a))return v.clog("teishi.v","Invalid apres argument. Must be either undefined, true, or a function.");var s=v.validateRule(o);if(!0!==s)return j(s,a)}var c=v.type(o);if("boolean"===c)return o;if("function"===c)return v.v(i,o(),a,u);if(0===o.length)return!0;var l=v.type(o[0]);if("boolean"===l&&2===o.length&&"array"===v.type(o[1]))return!1===o[0]||v.v(i,o[1],a,u);if("string"!==l&&("array"!==l||2!==o[0].length||"string"!==v.type(o[0][0])||"string"!==v.type(o[0][1])))return w.stopNot(o,!0,function(e){return v.v(i,e,a,u)});var f,d=v.type(o[3]),p=v.type(o[4]),g="function"===d?o[3]:"function"===p?o[4]:v.test.type,h="string"===d?o[3]:"string"===p?o[4]:undefined,m="array"===l?o[0]:[o[0]],y=v.type(o[1],!0),b=v.type(o[2],!0);return("each"===h||"eachOf"===h)&&("array"===y&&0===o[1].length||"object"===y&&0===w.keys(o[1]).length||o[1]===undefined)||(!0===(f="oneOf"!==h&&"eachOf"!==h||!("array"===b&&0===o[2].length||"object"===b&&0===w.keys(o[2]).length||o[2]===undefined)?h===undefined?g(i,m,o[1],o[2]):"each"===h?w.stopNot(o[1],!0,function(e){return g(i,m,e,o[2],o[1])}):"oneOf"===h?w.stop(o[2],!0,function(e){return g(i,m,o[1],e,undefined,o[2])}):w.stopNot(o[1],!0,function(t){return w.stop(o[2],!0,function(e){return g(i,m,t,e,o[1],o[2])})}):["To field of teishi rule is",o.to,"but multi attribute",h,"requires it to be non-empty, at teishi step",o])||j(f,a))},v.stop=function(){return!0!==v.v.apply(v.v,arguments)}}(),function(){var s,e="object"==typeof exports,c=e?require("dale"):window.dale,a=e?require("teishi"):window.teishi;s=e?exports:window.lith={};var l=a.type,f=a.clog;s.k={lithbagElements:["string","integer","float","array","undefined"],tags:["!DOCTYPE HTML","LITERAL","a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","command","datalist","dd","del","details","dfn","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"],voidTags:["!DOCTYPE HTML","area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]},s.entityify=function(e,t){return!(!t&&a.stop("lith.entityify",["Entityified string",e,"string"]))&&e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/`/g,"&#96;")},s.v=function(t,e){var n=l(t);if("array"===n&&-1<s.k.tags.indexOf(t[0])){var r,i="object"===l(t[1])?t[1]:undefined,o=t[i?2:1];return!0===(r=a.v([["lith length",t.length,{min:1,max:3},a.test.range],[i===undefined,["length of lith without attributes",t.length,{max:2},a.test.range]],[["lith attribute keys","start with an ASCII letter, underscore or colon, and be followed by letters, digits, underscores, colons, periods, dashes, extended ASCII characters, or any non-ASCII characters."],c.keys(i),/^[a-zA-Z_:][a-zA-Z_:0-9.\-\u0080-\uffff]*$/,"each",a.test.match],["lith attribute values",i,["string","integer","float","undefined","null","boolean"],"eachOf"],"LITERAL"===t[0]?["lith LITERAL contents",o,"string"]:["lith contents",o,s.k.lithbagElements,"oneOf"]],!!e||function(e){f("lith.v - Invalid lith",{error:e,"original input":t})}))?"Lith":!!e&&{error:r,"original input":t}}return!0===(r=a.v([["lithbag",n,s.k.lithbagElements,"oneOf",a.test.equal],["array"===n,["lithbag elements",t,s.k.lithbagElements,"eachOf"]]],!!e||function(e){f("lith.v - Invalid lithbag",{error:e,"original input":t})}))?"Lithbag":!!e&&{error:r,"original input":t}},s.g=function(e,t){if(t||s.prod)return!0!==(t||s.prod)?f("lith.g","prod or lith.prod must be true or undefined."):"array"===l(e)&&-1<s.k.tags.indexOf(e[0])?s.generateLith(e,!0):s.generateLithbag(e,!1,!0);var n=s.v(e);return!!n&&s["generate"+n](e)},s.generateLithbag=function(e,n,r){var i="";return!1!==c.stop(e,!1,function(e){if(e!==undefined){l(e);if("array"!==l(e))return i+=n?e:s.entityify(e+"",r);var t=s.g(e,r);if(!1===t)return!1;i+=t}})&&i},s.generateLith=function(e,n){var t="object"===l(e[1])?e[1]:undefined,r=e[t?2:1];if("LITERAL"===e[0])return r;var i="<"+e[0];if(c.go(t,function(e,t){!e&&0!==e||(i+=" "+s.entityify(t+"",n)+'="'+s.entityify(e+"",n)+'"')}),i+=">","array"===l(r)){var o="style"===e[0]?s.css.g(r,n):s.g(r,n);if(!1===o)return!1;i+=o}else i+=s.generateLithbag(r,"style"===e[0]||"script"===e[0],n);return-1===s.k.voidTags.indexOf(e[0])&&(i+="</"+e[0]+">"),i},s.css={},s.css.v=function(t,e){var n=a.v(["litc or litcbag",t,"array"],!!e||function(e){f("lith.css.v - Invalid litc or litcbag",{error:e,"original input":t})});if(!0!==n)return!!e&&{error:n,"original input":t};if(0===t.length||"array"===l(t[0]))return!0;var r="object"===l(t[1])?t[1]:undefined,i=t[r?2:1];return!0===(n=a.v([["litc length",t.length,{min:1,max:3},a.test.range],[r===undefined,["length of litc without attributes",t.length,{max:2},a.test.range]],["litc selector",t[0],"string"],s.css.vAttributes(r),"LITERAL"===t[0]?["litc LITERAL contents",i,"string"]:["litc contents",i,["undefined","array"],"oneOf"]],!!e||function(e){f("lith.css.v - Invalid litc",{error:e,"original input":t})}))?n:!!e&&{error:n,"original input":t}},s.css.vAttributes=function(e){return a.v([["litc attribute values",e,["string","integer","float","object","undefined","null","boolean"],"eachOf"]])},s.css.g=function(e,r,i){if(r||s.prod){if(!0!==(r||s.prod))return f("lith.css.g","prod or lith.prod must be true or undefined.");r=!0}if(!r&&!1===s.css.v(e))return!1;if(0===e.length)return"";if("LITERAL"===e[0])return e[1];var o="";if("array"===l(e[0]))return!1!==c.stop(e,!1,function(e,t){var n=s.css.g(e,r,i);if(!1===n)return!1;o+=n})&&o;i===undefined&&(i="");var t="object"===l(e[1])?e[1]:undefined,n=e[t?2:1];i=c.go(i.split(/,\s*/),function(t){return c.go(e[0].split(/,\s*/),function(e){return e.match(/&/)?e.replace("&",t):t+(0===t.length?"":" ")+e}).join(", ")}).join(", "),o+=i+"{";var a=function(e){return!1!==s.css.vAttributes(e)&&c.stop(e,!1,function(t,e){if(t||0===t){var n=l(t);if("object"===n)return a(t);"integer"===n&&(t<0||1<t)&&(t+="px"),"float"!==n&&1!==t||(t=100*t+"%"),c.go(e.split(/,\s*/),function(e){o+=e+":"+t+";"})}})};if(!1===a(t))return!1;if(o===i+"{"?o="":o+="}",n){var u=s.css.g(n,r,i);if(!1===u)return!1;o+=u}return o},s.css.media=function(e,t){return!a.stop(["selector",e,"string"])&&[["LITERAL","@media "+e+" {"],t,["LITERAL","}"]]},s.css.style=function(e,t){var n=s.css.g(["",e],t);return!1===n?n:n.slice(1,-1)}}(),function(){var e="object"==typeof exports,u=e?require("dale"):window.dale,s=e?require("teishi"):window.teishi,c=s.type,t=s.clog,n=function(e){if(!s.stop([["store",e,["array","object","undefined"],"oneOf"]])){var a={responders:{},store:e||{},log:[],error:t,count:{e:1,l:1},call:function(){var e=arguments[(o="object"===c(arguments[0])?arguments[0]:undefined)?1:0],t=arguments[o?2:1];if(s.simple(t)&&(t=[t]),!a.prod&&s.stop("r.call",[["context",o,["object","undefined"],"oneOf"],[o!==undefined,[function(){return["x.from",o.from,["string","undefined"],"oneOf"]}]],["verb",e,"string"]],function(e){o?a.error(o,"r.call",e):a.error("r.call",e)}))return!1;if(!a.prod&&!a.isPath(t))return o?a.error(o,"r.call","Invalid path. Arguments:",{verb:e,path:t}):a.error("r.call","Invalid path. Arguments:",{verb:e,path:t});var n=arguments,r=arguments.length===(o?3:2)?undefined:u.go(u.times(arguments.length-(o?3:2),o?3:2),function(e){return n[e]}),i=o?o.responder?o.responder.id+"/"+o.from:o.from:undefined,o={from:"E"+a.count.e++,verb:e,path:t,args:r};return a.logpush(i,o.from,e,t,r),a.mill(r===undefined?[o]:[o].concat(r)),o.from},respond:function(){var e,t=arguments[arguments.length-1];if(arguments.length<2)return a.error("r.respond","Too few arguments passed to r.respond");if(2===arguments.length?e=arguments[0]:((e=3===arguments.length?{}:arguments[2]).verb=arguments[0],e.path=arguments[1]),s.simple(e.path)&&(e.path=[e.path]),!a.prod&&s.stop("r.respond",[["options",e,"object"],["keys of options",u.keys(e),["verb","path","id","parent","priority","burn","match"],"eachOf",s.test.equal],function(){return[["options.verb",e.verb,["string","regex"],"oneOf"],["options.id",e.id,["string","integer","undefined"],"oneOf"],["options.parent",e.parent,["string","integer","undefined"],"oneOf"],["options.priority",e.priority,["undefined","integer"],"oneOf"],["options.burn",e.burn,["undefined","boolean"],"oneOf"],["options.match",e.match,["undefined","function"],"oneOf"]]},["responder function",t,"function"]],function(e){a.error("r.respond",e)}))return!1;if(!a.prod&&!a.isPath(e.path,!0))return a.error("r.respond","Invalid path. Options:",e);if(e.id!==undefined){if(e.id+="",!a.prod&&e.id.match(/^[R|E]\d+$/))return a.error("r.respond","If you pass an id for a responder, it cannot be an `L` or an `E` followed by digits, since that is the form that recalc gives to auto-generated ids.");if(!a.prod&&a.responders[e.id])return a.error("r.respond","A responder with id",e.id,"already exists.")}else e.id="R"+a.count.l;return e.rfun=t,e.index=a.count.l++,(a.responders[e.id]=e).id},forget:function(n,r){if(!a.prod&&r!==undefined&&"function"!==c(r))return a.error("r.forget","Second argument to r.forget must be a function or undefined. Id is:",n);if(!a.prod&&!a.responders[n])return a.error("r.forget","responder",n,"does not exist.");var e=a.responders[n];delete a.responders[n],r&&r(e),u.go(a.responders,function(e,t){e.parent===n&&a.forget(t,r)})},isPath:function(e,t){return s.v([["path",e,["array","integer","string"].concat(t?"regex":[]),"oneOf"],["path",e,["integer","string"].concat(t?"regex":[]),"eachOf"]],function(){})},compare:function(e,t){return"*"===e||"*"===t||("regex"===c(t)?null!==(e+"").match(t):e===t)},logpush:function(e,t,n,r,i){a.log&&a.log.push({t:s.time(),from:e,id:t,verb:n,path:r,args:i})},mill:function(n){var r=function(e){if(0!==e.length){n[0].cb=function(){r(e)};var t=e.shift();if(n[0].responder=t,!a.responders[t.id])return r(e);a.logpush(n[0].from,t.id,t.verb,t.path,n.slice(1).length?n.slice(1):undefined),t.burn&&a.forget(t.id),"function"!==c(t.rfun.apply(null,n))&&r(e)}};r(a.sort(a.match(n[0].verb,n[0].path,n.slice(1),a.responders)))},match:function(e,r,t,n){var i=[];return u.go(n,function(n){if(!n.disabled){if(n.match)return!0===n.match({verb:e,path:r,args:t},n)?i.push(n):undefined;if(a.compare(e,n.verb)&&r.length===n.path.length)return 0===r.length&&0===n.path.length?i.push(n):void(u.stop(r,!1,function(e,t){return a.compare(r[t],n.path[t])})&&i.push(n))}}),i},sort:function(e){return e.sort(function(e,t){var n=(t.priority||0)-(e.priority||0);return 0!=n?n:e.index-t.index})}};return a}};e?module.exports=n:window.R=n}(),function(){if("object"==typeof exports)return console.log("cocholate only works in a browser!");var u=window.dale,s=window.teishi,c=s.type,l=s.clog;document.createElement("_").insertAdjacentHTML||(HTMLElement.prototype.insertAdjacentHTML=function(e,t){var n=document.createElement("div");for(n.innerHTML=t;n.firstChild;)"beforeBegin"===e?this.parentNode.insertBefore(n.firstChild,this):"afterBegin"===e?this.insertBefore(n.firstChild,this.firstChild):"beforeEnd"===e?this.appendChild(n.firstChild):this.parentNode.insertBefore(n.firstChild,this.nextElementSibling)});var f=window.c=function(e,t){if(s.stop("c",["fun",t,["function","undefined"],"oneOf"]))return!1;var n,r=e&&e.nodeName,i=r?[e]:f.find(e);return!1!==i&&(t&&(n=u.go(arguments,function(e){return e}).slice(2),i=u.go(i,function(e){return t.apply(undefined,[e].concat(n))})),r||"body"===e||"string"===c(e)&&e.match(/^[a-z0-9]*#[^\s\[>,:]+$/)?i[0]:i)};f.nodeListToArray=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t},f.setop=function(e,t,n){if("and"===e)return u.fil(t,undefined,function(e){return-1<n.indexOf(e)?e:undefined});var r=t.slice();return"or"===e?u.go(n,function(e){-1===r.indexOf(n)&&r.push(e)}):(0===r.length&&(r=f.nodeListToArray(document.getElementsByTagName("*"))),u.go(n,function(e){var t=r.indexOf(e);-1<t&&r.splice(t,1)})),r},f.find=function(t){var e=c(t);if(s.stop("cocholate",[["selector",t,["array","string","object"],"oneOf"],function(){return[["array"===e,["first element of array selector",t[0],[":and",":or",":not"],"oneOf",s.test.equal]],["object"===e,[["selector keys",u.keys(t),["selector","from"],"eachOf",s.test.equal],["selector.selector",t.selector,["array","string"],"oneOf"],function(){return!("object"!==c(t.from)||document.querySelectorAll&&!t.from.querySelectorAll)||l("teishi.v","selector.from passed to cocholate must be a DOM element.")}]]]}]))return!1;if("array"!==e){if(document.querySelectorAll&&"string"===e)return f.nodeListToArray(document.querySelectorAll(t));if(document.querySelectorAll&&"object"===e)return f.nodeListToArray(t.from.querySelectorAll(t.selector));var n=t.from?t.from:document;if("*"!==(t="string"===e?t:t.selector)&&!t.match(/^[a-z0-9]*(#|\.)?[^,>\[\]]+$/i))return l("The selector "+t+" is not supported in IE <= 7 or Firefox <= 3.");var r=t.match("#")?"id":t.match(/\./)?"class":undefined,i=2!==(t=t.split(/#|\./)).length&&r?undefined:t[0].toUpperCase();return u.fil(f.nodeListToArray(n.getElementsByTagName(i||"*")),undefined,function(e){if(!("class"===r&&-1===(e.className||"").split(/\s/).indexOf(s.last(t))||"id"===r&&e.id!==s.last(t)))return e})}var o=t.shift(),a=[];return u.stop(t,!1,function(e,t){var n=f.find(e);if(!1===n)return a=!1;a=0===t&&":not"!==o?n:f.setop(o.replace(":",""),a,n)}),a},f.empty=function(e){f(e,function(e){e.innerHTML=""})},f.fill=function(e,t){if(s.stop("c.fill",["html",t,"string"]))return!1;f(e,function(e){e.innerHTML=t})},f.place=function(e,t,n){if(s.stop("c.place",[["where",t,["beforeBegin","afterBegin","beforeEnd","afterEnd"],"oneOf",s.test.equal],["html",n,"string"]]))return!1;f(e,function(e){e.insertAdjacentHTML(t,n)})},f.get=function(e,n,r){if(s.stop("c.get",["attributes",n,["string","array","undefined"],"oneOf"]))return!1;var i=[null,"",!1,0,"false"];return f(e,function(t){return n!==undefined?u.obj(n,function(e){return r?[e,t.style[e]||null]:[e,t.getAttribute(e)]}):r?u.obj(t.style.length?u.times(t.style.length,0):u.keys(t.style),function(e){return t.style.length?[t.style[e],t.style[t.style[e]]]:-1===i.indexOf(t.style[e])?[e,t.style[e]]:void 0}):u.obj(t.attributes,{"class":t["class"]||t.className},function(e,t){if(e&&e.nodeName&&-1===i.indexOf(e.nodeValue))return[e.nodeName,e.nodeValue]})})},f.set=function(e,t,r,i){if(s.stop("c.set",[["attributes",t,"object"],[["attribute keys","start with an ASCII letter, underscore or colon, and be followed by letters, digits, underscores, colons, periods, dashes, extended ASCII characters, or any non-ASCII characters."],u.keys(t),/^[a-zA-Z_:][a-zA-Z_:0-9.\-\u0080-\uffff]*$/,"each",s.test.match],["attribute values",t,["integer","float","string","null"],"eachOf"]]))return!1;f(e,function(n){u.go(t,function(e,t){r?n.style[t]=null===e?"":e:null===e?n.removeAttribute(t):n.setAttribute(t,e)}),n.onchange&&!i&&n.onchange()})},f.fire=function(e,r){if(s.stop("c.fire",["event type",r,"string"]))return!1;f(e,function(e){var t;try{t=new Event(r)}catch(n){t=document.createEvent?document.createEvent("Event"):document.createEventObject(),document.createEvent&&t.initEvent(r,!1,!1)}return e.dispatchEvent?e.dispatchEvent(t):e.fireEvent?e.fireEvent("on"+r,t):l("c.fire error","Unfortunately, this browser supports neither EventTarget.dispatchEvent nor element.fireEvent.")})},f.ready=function(e){if(window.addEventListener)return window.addEventListener("load",e,!1);if(window.attachEvent)return window.attachEvent("onload",e);var t=setInterval(function(){"complete"===document.readyState&&(e()||clearInterval(t))},10)},f.cookie=function(e){return!1===e?u.go(document.cookie.split(/;\s*/),function(e){return document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()),e}):u.obj((e||document.cookie).split(/;\s*/),function(e){if(""!==e)return[(e=e.split("="))[0],e.slice(1).join("=")]})},f.ajax=function(e,t,n,r,i){if(e=e||"GET",n=n||{},r=r||"",i=i||function(){},s.stop("c.ajax",[["method",e,"string"],["path",t,"string"],["headers",n,"object"],["callback",i,"function"]]))return!1;var o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return o.open(e.toUpperCase(),t,!0),s.complex(r)&&"formdata"!==c(r,!0)&&(n["content-type"]=n["content-type"]||"application/json",r=s.str(r)),u.go(n,function(e,t){o.setRequestHeader(t,e)}),o.onreadystatechange=function(){if(4===o.readyState){if(200!==o.status&&304!==o.status)return i(o);var r,e={xhr:o,headers:u.obj(o.getAllResponseHeaders().split(/\r?\n/),function(e){if(""!==e){var t=e.match(/^[^:]+/)[0],n=e.replace(t,"").replace(/:\s+/,"");return t.match(/^content-type/i)&&n.match(/application\/json/i)&&(r=!0),[t,n]}})};e.body=r?s.parse(o.responseText):o.responseText,i(null,e)}},o.send(r),{headers:n,body:r,xhr:o}},f.loadScript=function(e,r){return r=r||function(){},f.ajax("get",e,{},"",function(e,t){if(e)return r(e);var n=document.createElement("script");try{n.appendChild(document.createTextNode(t.body))}catch(e){n.text=t.body}document.body.appendChild(n),r(null,t)})},f.test=function(r){if(s.stop("c.test",[["tests",r,"array"],["tests",r,"array","each"],u.go(r,function(e,t){return[["test length",e.length,{min:2,max:3},s.test.range],["test #"+(t+1)+" tag",e[0],"string"],2===e.length?["test #"+(t+1)+" check",e[1],"function"]:[["test #"+(t+1)+" action",e[1],"function"],["test #"+(t+1)+" check",e[2],"function"]]]})]))return!1;var i=s.time(),o=function(e){var t=r[e];if(!t)return l("c.test","All tests finished successfully ("+(s.time()-i)+" ms)");var n=function(){if(!1===t[2===t.length?1:2]())throw new Error("c.test: Test failed: "+t[0]);o(e+1)};if(l("c.test","Running test:",t[0]),2===t.length)return n();t[1](function(e){if(e===undefined)return n();if("integer"!==c(e)||e<0)throw new Error("c.test: wait parameter must zero or a positive integer but instead is "+e);setTimeout(n,e)})!==undefined&&n()};o(0)}}(),function(){if("object"==typeof exports)return console.log("gotoÐ² only works in a browser!");var b=window.dale,u=window.teishi,c=window.lith,s=window.R(),o=window.c,v=u.type,w=window.B={v:"2.0.0",B:"Ð²",t:(new Date).getTime(),r:s,responders:s.responders,store:s.store,log:s.log,call:s.call,respond:s.respond,forget:s.forget};s.error=w.error=function(){var e="object"===v(arguments[0])?arguments[0]:undefined,t=b.go(arguments,function(e){return e}).slice(e?1:0);return w.call.apply(null,[e||{},"error"].concat(t)),!1},w.respond({id:"error",verb:"error",path:[],match:function(e){return"error"===e.verb}},function(){document.body.innerHTML+=c.g(["div",{id:"eventlog-snackbar",style:c.css.style({position:"fixed","font-weight":"bold",opacity:"0.8",top:0,left:.1,width:.8,padding:10,color:"white","background-color":"black","z-index":"10001","text-align":"center"})},"There was an error."],!0),setTimeout(function(){o("#eventlog-snackbar")&&document.body.removeChild(o("#eventlog-snackbar"))},3e3),w.eventlog()}),w.eventlog=function(){o("#eventlog")&&document.body.removeChild(o("#eventlog"));var n={},r=["#fe6f6c","#465775","#e086c3","#8332ac","#462749","#044389","#59c9a6","#ffad05","#7cafc4","#5b6c5d"];document.body.innerHTML+=c.g(["table",{id:"eventlog"},[["style",["#eventlog",{"border-collapse":"collapse","font-family":"monospace","font-size":18,position:"absolute","right, top":4,width:Math.min(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,800),"z-index":"10000",border:"solid 4px #4488DD"},["th, td",{"padding-left, padding-right":10,"border-bottom, border-right":"solid 1px black"}]]],["tr",b.go(["#","ms","id","from","verb","path","args"],function(e){return["th",{style:c.css.style({"background-color":"#efefef"})},e]})],b.go(w.log,function(e,t){return n[e.from&&e.from.match(/^E\d+$/)?e.id+"/"+e.from:e.id]=t,["tr",{style:c.css.style({"background-color":{0:"#fcfcfc",1:"#efefef"}[t%2]})},b.go(["#"+(t+1),e.t-w.t,e.id,e.from,e.verb,e.path.join(":"),b.go(e.args,w.str).join(", ")],function(e,t){return 1===t?["td",e/1e3+(e%1e3?"":".0")+(e%100?"":"0")+(e%10?"":"0")+"s"]:2!==t&&3!==t?["td",e]:["td",{onclick:e===undefined?"":'c ("tr") ['+(n[e]+1)+"].scrollIntoView ()",style:c.css.style({cursor:"pointer","font-weight":"bold",color:r[parseInt(n[e])%r.length]})},e===undefined?"":e]})]})]],!0),o("tr")[w.log.length].scrollIntoView()},w.get=function(){var n="array"===v(arguments[0])?arguments[0]:b.go(arguments,function(e){return e});if(!w.prod&&!s.isPath(n))return w.error("B.get","Invalid path:",n)||undefined;var r=w.store;return!1===b.stop(n,!1,function(e,t){return!(t<n.length-1&&u.simple(r[e]))&&void(r=r[e])})?undefined:r},w.set=function(){var e="object"===v(arguments[0])?arguments[0]:undefined,r=arguments[e?1:0],i=arguments[e?2:1];if(!w.prod&&!s.isPath(r))return w.error(e||{},"B.set","Invalid path:",r);if("array"!==v(r)&&(r=[r]),0===r.length)return!w.prod&&u.simple(i)?w.error(e||{},"B.set","Cannot set B.store to something that is not an array or object."):(w.store=i,!0);var t="string"===v(r[0])?"object":"array";v(w.store)!==t&&(w.store="object"==t?{}:[]);var o=w.store;return b.go(r,function(e,t){if(t===r.length-1)return o[e]=i;var n="string"===v(r[t+1])?"object":"array";v(o[e])!==n&&(o[e]="object"==n?{}:[]),o=o[e]}),!0},w.add=function(){var n="object"===v(arguments[0])?arguments[0]:undefined,e=arguments[n?1:0];if(!w.prod&&!s.isPath(e))return w.error(n||{},"B.add","Invalid path:",e);w.get(e)===undefined&&w.set(e,[]);var r=w.get(e);return w.prod||"array"===v(r)?(b.go(arguments,function(e,t){(n?1:0)<t&&r.push(e)}),!0):w.error(n||{},"B.add","Cannot add to something that is not an array. Path:",e)},w.rem=function(){var t="object"===v(arguments[0])?arguments[0]:undefined,n=arguments[t?1:0];if(!w.prod&&!s.isPath(n))return w.error(t||{},"B.rem","Invalid path:",n);var r=w.get(n),e=v(r),i="array"===v(arguments[t?2:1])?arguments[t?2:1]:b.go(arguments,function(e){return e}).slice(t?2:1);return!(!w.prod&&u.stop("B.rem",[["type of target",e,["array","object","undefined"],"oneOf",u.test.equal],"array"===e?["keys of array target",i,"integer","each"]:[],"object"===e?["keys of object target",i,"string","each"]:[]],function(e){w.error(t||{},"B.rem",e,"Path:",n)}))&&("object"===e&&b.go(i,function(e){delete r[e]}),"array"===e&&(i=i.slice().sort(function(e,t){return t-e}),b.go(i,function(e){r.splice(e,1)})),!0)},b.go(["add","rem","set"],function(n){w.respond({id:n,verb:n,path:[],match:function(e,t){return s.compare(e.verb,t.verb)}},function(e){var t="set"===n?w.get(e.path):u.copy(w.get(e.path));!1!==w[e.verb].apply(null,[e,e.path].concat(b.go(arguments,function(e){return e}).slice(1)))&&(u.eq(t,w.get(e.path))||w.call(e,"change",e.path,w.get(e.path),t))})}),w.changeResponder=function(t,n){return!!s.compare(t.verb,n.verb)&&(0===t.path.length||0===n.path.length||b.stop(b.times(Math.min(t.path.length,n.path.length),0),!1,function(e){return s.compare(t.path[e],n.path[e])}))},w.str=function(e){var t=v(e);return"array"!==t&&"object"!==t?"string"===t?u.str(e):e+"":"array"===t?"["+b.go(e,w.str).join(", ")+"]":"{"+b.go(e,function(e,t){return u.str(t)+": "+w.str(e)}).join(", ")+"}"},w.evh=function(e){return b.obj(o.get(e),function(e,t){if(!t.match(/^on/))return[t,e]})},w.ev=function(){var t;if(t="array"===v(arguments[0])?arguments:0===arguments.length?[]:[b.go(arguments,function(e){return e})],!w.prod&&u.stop("B.ev",b.go(t,function(e){return[["ev",e,"array"],function(){return[["ev.verb",e[0],"string"],function(){return!!s.isPath(e[1])||w.error("B.ev","Invalid path:",e[1],"Events:",t)}]}]}),function(e){w.error("B.ev",e,"Events:",t)}))return!1;var n='var id = B.call ("ev", event.type, B.evh (this));';return b.go(t,function(e){n+=' B.call ({"from": id}, '+b.go(2===e.length?e.concat({raw:"this.value"}):e,function(e,t){return 1<t&&"object"===v(e)&&"string"===v(e.raw)?e.raw:w.str(e)}).join(", ")+");"}),n},w.mount=function(e,t){if(!w.prod&&"string"!==v(e)||!e.match(/^(body|[a-z0-9]*#[^\s\[>,:]+)$/))return w.error("B.mount","Target must be either 'body' or an id selector, but instead is "+e);var n="body"===e?document.body:document.getElementById(e.replace(/.*#/g,""));if(!w.prod){if(!n)return w.error("B.mount","Target not found:",e);if("function"!==v(t))return w.error("B.mount","fun must be a function but instead is",t)}var r=t();if(!w.prod){var i=w.validateLith(r);if("Lith"!==i&&"Lithbag"!==i)return w.error("B.mount","function returned invalid lith or lithbag",i)}o.place(e,"afterBegin",c.g(r,!0))},w.unmount=function(e){if(!w.prod&&"string"!==v(e)||!e.match(/^(body|[a-z0-9]*#[^\s\[>,:]+)$/))return w.error("B.unmount","Target must be either 'body' or an id selector, but instead is "+e);var t="body"===e?document.body:document.getElementById(e.replace(/.*#/g,""));if(!w.prod&&!t)return w.error("B.unmount","Target not found:",e);o({selector:"*",from:t},function(e){e.id&&e.id.match(/^Ð²[0-9a-f]+$/g)&&w.responders[e.id]&&w.forget(e.id)}),t.innerHTML=""},w.view=function(r,i){if("array"===v(r)&&"array"!==v(r[0])&&(r=[r]),!w.prod&&u.stop("B.view",[b.stopNot(r,!1,function(e){return!!s.isPath(e)||w.error("B.view","Invalid path:",e,"Arguments",{paths:r})}),["fun",i,"function"]],function(e){w.error("B.view",e,{paths:r})}))return!1;var o=w.B+w.internal.count++,a=function(){var e=w.internal.count,n=[],t=i.apply(null,b.go(r,w.get));return w.prod||"Lith"===w.validateLith(t)?(b.go(b.times(w.internal.count-e,e),function(e){var t=w.responders[w.B+e];t.priority--,t.parent||(n.push(t.id),t.parent=o)}),"object"!==v(t[1])&&t.splice(1,0,{}),t[1].id=o,t[1].paths=b.go(r,function(e){return e.join(":")}).join(", "),w.responders[o].elem=t,w.responders[o].children=n,t):w.error("B.view","Function must return a lith element but instead is:",t,"Arguments:",{paths:r})};return w.respond("change",[],{id:o,priority:-1,match:function(t){return b.stop(r,!0,function(e){return w.changeResponder(t,{verb:"change",path:e})})}},function(e){var t=w.responders[o].elem,n=w.responders[o].children;a()&&w.redraw(e,o,t,n)}),a()},w.internal={count:1,timeout:200,queue:[],redrawing:!1},w.validateLith=function(e){var t=c.v(e,!0);if("Lith"!==t&&"Lithbag"!==t)return t;if("Lith"!==t)return b.stopNot(e,undefined,function(e){if("array"===v(e)){var t=w.validateLith(e);return"Lith"!==t&&"Lithbag"!==t?t:void 0}})||"Lithbag";if("array"!==v(u.last(e)))return"Lith";var n="style"===e[0]?w.validateLitc(u.last(e)):w.validateLith(u.last(e));return"Lith"===n||"Lithbag"===n||!0===n?"Lith":n},w.validateLitc=function(e){var t=c.css.v(e,!0);return!0!==t?t:"array"===v(e[0])?b.stopNot(e,!0,w.validateLitc):"array"!==v(u.last(e))||w.validateLitc(u.last(e))},w.redraw=function(e,t,n,r,i){if(w.internal.redrawing&&!i)return w.internal.queue.push([e,t,n,r]);w.internal.redrawing=!0;var o=w.responders[t],a=document.getElementById(t),u=(new Date).getTime();if(!w.prod&&!a)return w.forget(t),w.error(e,"B.redraw","Attempted to redraw dangling element, omitting redraw & deleting responder.",{responder:o});var s=w.diff(w.prediff(n),w.prediff(o.elem));b.go(r,function(e){w.forget(e)}),!1===s?document.getElementById(t).innerHTML=c.g(o.elem,!0):w.applyDiff(e,o,a,s),w.call(e,"redraw",{responder:o,t:(new Date).getTime()-u,diffLength:!1!==s&&s.length}),b.stopNot(w.internal.queue,undefined,function(){var e=w.internal.queue.shift();if(w.responders[e[1]])return e})?w.redraw.apply(null,next.concat(!0)):w.internal.redrawing=!1},w.prediff=function(e,t){if("array"!==v(e)||"LITERAL"===e[0]){if(e===undefined||""===e)return;return"L"!==t[t.length-1][0]?t.push("L "+c.g(e,!0)):t[t.length-1]+=c.g(e,!0)}if(t=t||[],-1===c.k.tags.indexOf(e[0]))return b.go(e,function(e){w.prediff(e,t)});e[1]&&e[1].id&&(e[1].id+"").match(/^Ð²[0-9a-f]+$/g)&&(e=w.responders[e[1].id].elem);var n,r,i="object"!==v(e[1])?undefined:b.obj(e[1],function(e,t){if(e!==undefined&&null!==e&&""!==e)return[t,e]}),o=e[i?2:1];return t.push("O "+e[0]),i&&(t[t.length-1]+=" "+JSON.stringify(i)),i&&i.opaque?t.push("Q "+c.g(o,!0),"C "+e[0]):("table"===e[0]&&(n=t.length),w.prediff(o,t),"table"===e[0]&&t[n]&&(t[n].match(/^O thead/)&&(r=0,b.stopNot(b.times(t.length-n,n),undefined,function(e){if("O"===t[e][0]&&r++,"C"===t[e][0]&&r--,0===r)return n=e+1})),t[n]&&!t[n].match(/^O tbody/)&&(t.splice(n,0,"O tbody"),t.push("C tbody"))),t.push("C "+e[0])),t},w.applyDiff=function(a,e,u,s){var c=function(e,t,n){var r=l(t,"insert1",n);r?r.parentNode.insertBefore(e,r):l(t.slice(0,t.length-1),"insert2",n).appendChild(e)},l=function(n,r,i){var o=u;return b.go(n,function(e,t){if(o)return o=o.childNodes[e];throw w.prod||w.error(a,"redraw",{action:r,position:i,diffitem:s[i].slice(0,2).join(" "),id:id,where:n,k:t,innerHTML:u.innerHTML}),new Error("gotoB redraw error!")}),o},i=(b.stopNot(u.parentNode.childNodes,undefined,function(e,t){if(e===u)return t}),[initialPosition]),o=[initialPosition],f={add:{tag:null,index:null},rem:{tag:null,index:null}};b.go(s,function(e,t){var n,r;e[1].match(/^<opaque/)||(e[1].match(/^>/)||(s[t][2]={el:l(i,"sequence",t),old:i.slice(),New:o.slice()}),e[1].match(/^</)?(s[t][2].active=s[t][2].el===document.activeElement,n=e[1].match(/[^\s]+/g)[0],r=e[1].match(/<.+ {.*"opaque":true.*}/),"add"!==e[0]||r||(f.rem.tag===n?(s[t][2].match=f.rem.index,s[f.rem.index][2].match=t,f.rem.tag=f.rem.index=null):(f.add.tag=n,f.add.index=t)),"rem"!==e[0]||r||(f.add.tag===n?(s[t][2].match=f.add.index,s[f.add.index][2].match=t,f.add.tag=f.add.index=null):(f.rem.tag=n,f.rem.index=t)),"add"!==e[0]&&i.push(0),"rem"!==e[0]&&o.push(0)):e[1].match(/^>/)?("add"!==e[0]&&(i.pop(),i[i.length-1]++),"rem"!==e[0]&&(o.pop(),o[o.length-1]++)):("add"!==e[0]&&i[i.length-1]++,"rem"!==e[0]&&o[o.length-1]++))});var d,p={},g=[],h=[],m=[],y=[];b.go(s,function(e,t){if(!e[1].match(/^>/)){if(e[1].match(/^<opaque/)){if("rem"===e[0])return;return b.stopNot(b.times(t,t-1,-1),undefined,function(e){if("rem"!==s[e][0])return s[e]})[2].el.innerHTML=e[1].slice(7)}var n,r,i,o,a;"<"!==e[1][0]&&"rem"!==e[0]&&1<e[2].New.length&&("TEXTAREA"===(n=l(e[2].New.slice(0,-1))).tagName&&y.push([n,e[1]])),"keep"===e[0]?(e[1].match(/<.+ {.*"opaque":true.*}/)&&(e[2].el.innerHTML=""),e[2].el?(e[1].match(/<option/)&&JSON.parse(e[1].match(/{.+/)||"{}").selected&&g.push(e[2].el),c(e[2].el.parentNode.removeChild(e[2].el),e[2].New,e[2].New[e[2].New.length-1]),e[2].active&&"a"!==e[1].match(/[^<\s]+/g)[0]&&(d=e[2].el)):c(document.createTextNode(e[1]),e[2].New,e[2].New[e[2].New.length-1])):e[1].match(/^</)?("rem"===e[0]&&(e[2].match===undefined||e[2].match>t)&&(p[e[2].old]=e[2].el.parentNode.removeChild(e[2].el)),"add"===e[0]&&(e[2].match!==undefined?(i=s[e[2].match],p[i[2].old]||(p[i[2].old]=i[2].el),r=i[2].el,o=b.obj(r.attributes,function(e){if(e&&e.specified)return[e.name,e.value]}),a=JSON.parse(e[1].match(/{.+/)||"{}"),b.go(b.fil(o,undefined,function(e,t){if("string"===v(e)&&(e={name:t}),a[e.name]===undefined)return e.name}),function(e){r.removeAttribute(e),-1<["value","checked","selected"].indexOf(e)&&(r[e]="value"===e&&""),"selected"===e&&h.push(r)}),b.go(a,function(e,t){r.setAttribute(t,e),-1<["value","checked","selected"].indexOf(t)&&(r[t]=e)}),r.attributes&&r.attributes.selected&&g.push(r),r.attributes&&r.attributes.checked&&m.push(r)):(r=document.createElement(e[1].match(/[^<\s]+/g)[0]),b.go(JSON.parse(e[1].match(/{.+/)||"{}"),function(e,t){!e&&""!==e&&0!==e||r.setAttribute(t,e)})),c(r,e[2].New,e[2].New[e[2].New.length-1]),e[2].el=r,i&&i[2].active&&"a"!==e[1].match(/[^<\s]+/g)[0]&&(d=r))):"add"===e[0]?(e[1]=e[1].replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#96;/g,"`"),c(document.createTextNode(e[1]),e[2].New,e[2].New[e[2].New.length-1])):e[2].el&&e[2].el.parentNode.removeChild(e[2].el),e[1].match(/<textarea/)&&"rem"!==e[0]&&y.push([e[2].el])}}),d&&(d.focus?d.focus():d.setActive(),d.blur(),d.focus?d.focus():d.setActive()),b.go(g,function(e){e.selected=!0}),b.go(h,function(e){e.selected=!1}),b.go(m,function(e){e.checked=!0});var t=b.fil(y,undefined,function(e){if(2===e.length)return e[0]});b.go(y,function(e){return 2===e.length?e[0].value=e[1].replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#96;/g,"`"):void(-1===t.indexOf(e[0])&&(e[0].value=""))})},w.diff=function(t,e){for(var n,r,i,o,a,u,s,c,l,f=[],d=0,p=(new Date).getTime();d<t.length+e.length+1;){if(w.internal.timeout&&(new Date).getTime()-p>w.internal.timeout)return!1;for(n=f[f.length-1]||{1:[0,0]},r={},f.push(r),i=-d;i<2*d-d+1;){for(a=(o=i===-d||i!==d&&n[i-1][1]<n[i+1][1]?[0,n[i+1][1]]:[0,n[i-1][1]+1,!0])[1]-i;o[1]<t.length&&a<e.length&&t[o[1]]===e[a];)o[1]++,a++,o[0]++;if(!((r[i]=o)[1]<t.length||a<e.length)){for(u={x:o[1],y:a},s=[],c=d;-1<c;)a=(l=f[c][u.x-u.y])[1]-(u.x-u.y),l[0]&&b.go(b.times(l[0]),function(e){s.unshift(["keep",t[l[1]-e]])}),l[2]?s.unshift(["rem",t[l[1]-l[0]-1]]):s.unshift(["add",e[a-l[0]-1]]),u.x=l[1]-l[0]-(l[2]?1:0),u.y=a-l[0]-(l[2]?0:1),c--;return s.shift(),s}i+=2}d++}}}();