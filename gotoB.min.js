!function(){if("object"==typeof exports)var c=exports;else c=window.dale={};var d=function(t,e){var n=typeof t;return"object"!==n&&"number"!==n?n:t instanceof Array?"array":"number"===n?isNaN(t)?"nan":isFinite(t)?t%1==0?"integer":"float":"infinity":"array"===(n=Object.prototype.toString.call(t).replace("[object ","").replace("]","").toLowerCase())||"date"===n||"null"===n?n:"regexp"===n?"regex":e?n:"object"},t=function(f){return function(t,e,n,r){if("do"===f)var o=e,i=!0===n,a=[],s=0;else if("fil"===f)o=n,i=!0===r,a=[],s=0;else if("obj"!==f)o=n,i=!0===r;else if("object"===d(e))o=n,i=!0===r,a=e;else o=e,i=!0===n,a={};if("function"!==d(o))return console.log(("do"===f||"obj"===f&&"object"!==d(e)?"Second":"Third")+" argument passed to dale."+f+" must be a function but instead is",o,"with type",d(o)),!1;if(void 0===t)return a;var u=d(t);for(var c in"array"===u||("object"===u?"[object Arguments]"===Object.prototype.toString.call(t)&&(u="array",t=[].slice.call(t)):(u="array",t=[t])),t){if("array"===u)c=parseInt(c);else if(!i&&!Object.prototype.hasOwnProperty.call(t,c))continue;var l=o(t[c],c);if("do"===f)a[s++]=l;else if("fil"===f)l!==e&&(a[s++]=l);else if("stop"===f){if(l===e)return l;a=l}else if("stopNot"===f){if(l!==e)return l;a=l}else{if(void 0===l)continue;if("array"!==d(l))return void console.log("Value returned by fun must be an array but instead is of type "+d(l));a[l[0]]=l[1]}}return a}};c.do=t("do"),c.fil=t("fil"),c.obj=t("obj"),c.stop=t("stop"),c.stopNot=t("stopNot"),c.keys=function(t,e){return c.do(t,function(t,e){return e},e)},c.times=function(t,e,n){if(0===t)return[];if(!("integer"!==d(t)||t<0)){if(void 0===e)e=1;else if("integer"!==d(e)&&"float"!==d(e))return void console.log("start must be an integer or float.");if(void 0===n)n=1;else if("integer"!==d(n)&&"float"!==d(n))return void console.log("step must be an integer or float.");for(var r=[e];r.length<t;)e+=n,r.push(e);return r}console.log("steps must be a positive integer or zero.")},c.acc=function(t,e,n,r){var o=arguments.length===("boolean"===d(arguments[arguments.length-1])?4:3),i=o?e:void 0,a=o?n:e,s=o?r:n;if("function"!==d(a))return console.log("fun must be a function but instead is of type",d(a)),!1;var u=!0;return c.do(t,function(t,e){if(!o&&u)return u=!1,i=t;i=a(i,t)},s),i}}(),function(){var n="object"==typeof exports,m=n?require("dale"):window.dale;if(n)var b=exports;else b=window.teishi={};b.t=function(t,e){var n=typeof t;return"object"!==n&&"number"!==n?n:t instanceof Array?"array":"number"===n?isNaN(t)?"nan":isFinite(t)?t%1==0?"integer":"float":"infinity":"array"===(n=Object.prototype.toString.call(t).replace("[object ","").replace("]","").toLowerCase())||"date"===n||"null"===n?n:"regexp"===n?"regex":e?n:"object"},b.s=function(){try{return JSON.stringify.apply(JSON.stringify,arguments)}catch(t){return!1}},b.p=function(){try{return JSON.parse.apply(JSON.parse,arguments)}catch(t){return!1}},b.simple=function(t){var e=b.t(t);return"array"!==e&&"object"!==e},b.complex=function(t){return!b.simple(t)},b.c=function(t,r,o){if(b.simple(t))return t;r=r||["$root"],o=o||[r,t];var e=b.t(t,!0),i="array"===e||"arguments"===e?[]:{};return m.do(t,function(n,t){if(b.simple(n))return i[t]=n;var e=m.stopNot(o,void 0,function(t,e){if(e%2!=0&&n===t)return o[e-1]});if(!e)return o.push(r.concat([t]))&&o.push(n),i[t]=b.c(n,r.concat([t]),o.concat());i[t]="CIRCULAR REFERENCE: "+e.join(".")}),i},b.eq=function(t,n){return b.simple(t)&&b.simple(n)?t===n:b.t(t,!0)===b.t(n,!0)&&(b.s(m.keys(t).sort())===b.s(m.keys(n).sort())&&!1!==m.stop(t,!1,function(t,e){return b.eq(t,n[e])}))},b.time=function(){return(new Date).getTime()};var r,l=function(){return n?"[0m":""},f=function(){return n?"[1m":""},d=function(){return n?"[37m":""},p=function(t){if(!n)return"";for(var e=r;r===e;)e=Math.round(5*Math.random()+1);return"["+(t?"4":"3")+(r=e)+"m"};b.l=function(){var c=f();return function o(t,i){var a=b.t(t),s=(i=i||0,!0);"object"===a&&"[object Arguments]"===Object.prototype.toString.call(t)&&(a="array");var u=i<2?"":"\n"+m.do(m.times(i-1),function(t){return"   "}).join("");0<i&&(c+="array"===a?d()+"[":d()+"{"),m.do(t,function(t,e){var n=b.t(t);if(0===i&&0===e&&("string"===n||"integer"===n))return c+=p(!(s=!1))+t+":"+l()+f();if(s||(c+=d()+(0===i?" ":", ")),s=!1,"string"===n&&0<i&&(t="'"+t+"'"),"function"===n){var r=(t+="").match(/\s+(?=}$)/);null!==r&&(t=t.replace(new RegExp(r[0],"g"),"\n")),150<t.length&&(t=t.slice(0,150)+"...\n"),1<i&&(t=t.replace(/\n/g,"array"===a?u:"\n"+(e+": ").replace(/./g," ")+u.slice(1)))}c+=p(),"object"===a&&(c+=u+(e.match(/^[0-9a-zA-Z_]+$/)?e:"'"+e+"'")+": "),"array"===n||"object"===n?o(t,i+1):c+="object"===a?t:u+t}),0<i&&("array"===a&&(c+=(1<i?"\n":"")+u.slice(4)+d()+"]"),"object"===a&&(c+=(1<i?"\n":"")+u.slice(4)+d()+"}"))}(b.c(arguments)),console.log("("+(new Date).toISOString()+")",c+l()),!1},b.lno=function(){n=!1},b.makeTest=function(c,l){if("function"!==b.t(c))return b.l("teishi.makeTest","fun passed to teishi.makeTest should be a function but instead is",c,"with type",b.t(c));if("string"===b.t(l)&&(l=[l]),"array"!==b.t(l))return b.l("teishi.makeTest","clauses argument passed to teishi.makeTest should be an array but instead is",l,"with type",b.t(l));if("string"!==b.t(l[0]))return b.l("teishi.makeTest","shouldClause passed to teishi.makeTest should be a string but instead is",l[0],"with type",b.t(l[0]));if(void 0!==l[1]&&("array"!==b.t(l[1])&&(l[1]=[l[1]]),!0!==m.stopNot(l[1],!0,function(t){var e=b.t(t);return"string"===e||"function"===e||b.l("teishi.makeTest","Each finalClause passed to teishi.makeTest should be a string or a function but instead is",t,"with type",e)})))return;return function(t,e,n,r,o,i){var a=c(n,r);if(!0===a)return!0;if("array"===b.t(a))return a;var s=[],u=0;return void 0!==o&&(s[u++]="each of the"),e[0]&&(s[u++]=e[0]),t&&(s[u++]="passed to",s[u++]=t),s[u++]=l[0],void 0!==i&&(s[u++]="one of"),s[u++]=void 0!==i?i:r,e[1]&&(s[u++]="("+e[1]+")"),s[u++]=void 0!==o?"but one of":"but instead",void 0!==o&&(s[u++]=o),s[u++]="is",s[u++]=n,m.do(l[1],function(t){s[u++]="function"!=typeof t?t:t(n,r)}),s}},b.test={type:b.makeTest(function(t,e){return b.t(t)===e},["should have as type",["with type",b.t]]),equal:b.makeTest(b.eq,"should be equal to"),notEqual:b.makeTest(function(t,e){return!b.eq(t,e)},"should not be equal to"),range:b.makeTest(function(n,t){return"object"!==b.t(t,!0)?["Range options object must be an object but instead is",t,"with type",b.t(t,!0)]:"{}"===b.s(t)||m.stopNot(t,!0,function(t,e){return"min"!==e&&"max"!==e&&"less"!==e&&"more"!==e?['Range options must be one of "min", "max", "less" and "more", but instead is',e]:"min"===e?t<=n:"max"===e?n<=t:"less"===e?n<t:t<n})},"should be in range"),match:b.makeTest(function(t,e){return"string"!==b.t(t)?["Invalid comparison string passed to teishi.test.match. Comparison string must be of type string but instead is",t,"with type",b.t(t)]:"regex"!==b.t(e)?["Invalid regex passed to teishi.test.match. Regex must be of type regex but instead is",e,"with type",b.t(e)]:null!==t.match(e)},"should match")},b.validateRule=function(r){var t=b.t(r);if("function"===t||"boolean"===t)return!0;if("array"!==t)return["each teishi rule must be an array or boolean or function but instead is",r,"with type",t];var o,i,e=b.t(r[0]);return"string"!==e&&("array"!==e||2!==r[0].length||"string"!==b.t(r[0][0])||"string"!==b.t(r[0][1]))||(3===r.length||(r.length<3||5<r.length?["Each teishi simple rule must be an array of length between 3 and 5, but instead is",r,"and has length",r.length]:m.stopNot(r,!0,function(t,e){if(e<3)return!0;var n=b.t(t);if("string"===n){if("oneOf"!==t&&"each"!==t&&"eachOf"!==t)return["Invalid multi parameter",t,". Valid multi parameters are",["oneOf","each","eachOf"]];if(i)return["You can pass only one multi parameter to a teishi simple rule but instead you passed two:",r[3],"and",r[4]];i=t}else{if("function"!==n)return["Elements #4 and #5 of a teishi simple rule must be either a string or a function, but element","#"+(e+1),"is",t,"and has type",n];if(o)return["You can pass only one test function to a teishi simple rule but instead you passed two:",r[3],"and",r[4]];o=t}return!0})))};var y=function(t,e){return void 0===e?b.l.apply(b.l,["teishi.v"].concat(t)):(t=m.do(t,function(t){return b.complex(t)?b.s(t):t+""}).join(" "),!0===e?t:(e(t),!1))};b.v=function(t,e,n){if("string"===b.t(t))var r=t,o=e,i=n;else r="",o=t,i=e;if(void 0!==i&&!0!==i&&"function"!==b.t(i))return b.l("teishi.v","Invalid apres argument. Must be either undefined, true, or a function.");var a=b.validateRule(o);if(!0!==a)return y(a,i);var s=b.t(o);if("boolean"===s)return o;if("function"===s)return b.v(r,o(),i);if(0===o.length)return!0;var u=b.t(o[0]);if("boolean"===u&&2===o.length&&"array"===b.t(o[1]))return!1===o[0]||b.v(r,o[1],i);if("string"!==u&&("array"!==u||2!==o[0].length||"string"!==b.t(o[0][0])||"string"!==b.t(o[0][1])))return m.stopNot(o,!0,function(t){return b.v(r,t,i)});var c,l=b.t(o[3]),f=b.t(o[4]),d="function"===l?o[3]:"function"===f?o[4]:b.test.type,p="string"===l?o[3]:"string"===f?o[4]:void 0,g="array"===u?o[0]:[o[0]],h=b.t(o[1],!0),v=b.t(o[2],!0);return("each"===p||"eachOf"===p)&&("array"===h&&0===o[1].length||"object"===h&&0===Object.keys(o[1]).length||void 0===o[1])||(!0===(c="oneOf"!==p&&"eachOf"!==p||!("array"===v&&0===o[2].length||"object"===v&&0===Object.keys(o[2]).length||void 0===o[2])?void 0===p?d(r,g,o[1],o[2]):"each"===p?m.stopNot(o[1],!0,function(t){return d(r,g,t,o[2],o[1])}):"oneOf"===p?m.stop(o[2],!0,function(t){return d(r,g,o[1],t,void 0,o[2])}):m.stopNot(o[1],!0,function(e){return m.stop(o[2],!0,function(t){return d(r,g,e,t,o[1],o[2])})}):["To field of teishi rule is",o.to,"but multi attribute",p,"requires it to be non-empty, at teishi step",o])||y(c,i))},b.stop=function(){return!0!==b.v.apply(b.v,arguments)}}(),function(){var t="object"==typeof exports,s=t?require("dale"):window.dale,o=t?require("teishi"):window.teishi;if(t)var u=exports;else u=window.lith={};var c=o.t,i=o.l;u.k={lithbagElements:["string","integer","float","array","undefined"],tags:["!DOCTYPE HTML","LITERAL","a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","command","datalist","dd","del","details","dfn","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"],voidTags:["!DOCTYPE HTML","area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]},u.entityify=function(t){return!o.stop("lith.entityify",["Entityified string",t,"string"])&&t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/`/g,"&#96;")},u.v=function(e){var t=c(e);if("array"===t&&"string"===c(e[0])&&-1!==u.k.tags.indexOf(e[0])){var n="object"===c(e[1])?e[1]:void 0,r=e[n?2:1];return!!o.v([["lith length",e.length,{min:1,max:3},o.test.range],[void 0===n,["length of lith without attributes",e.length,{max:2},o.test.range]],[["lith attribute keys","start with an ASCII letter, underscore or colon, and be followed by letters, digits, underscores, colons, periods, dashes, extended ASCII characters, or any non-ASCII characters."],s.keys(n),/^[a-zA-Z_:][a-zA-Z_:0-9.\-\u0080-\uffff]*$/,"each",o.test.match],["lith attribute values",n,["string","integer","float","undefined","null","boolean"],"eachOf"],["lith contents",r,u.k.lithbagElements,"oneOf"]],function(t){i("lith.v - Invalid lith",{error:t,"original input":e})})&&"Lith"}return!!o.v([["lithbag",t,u.k.lithbagElements,"oneOf",o.test.equal],["array"===t,["lithbag elements",e,u.k.lithbagElements,"eachOf"]]],function(t){i("lith.v - Invalid lithbag",{error:t,"original input":e})})&&"Lithbag"},u.g=function(t,e){if(e||u.prod)return!0!==(e||u.prod)?i("lith.g","prod or lith.prod must be true or undefined."):"array"===c(t)&&-1!==u.k.tags.indexOf(t[0])?u.generateLith(t,!0):u.generateLithbag(t,!1,!0);var n=u.v(t);return!!n&&u["generate"+n](t)},u.generateLithbag=function(t,n,r){var o="";return!1!==s.stop(t,!1,function(t){if(void 0!==t){c(t);if("array"!==c(t))return o+=n?t:u.entityify(t+"");if(r)o+=u.g(t,r);else{var e=u.g(t,r);if(!1===e)return!1;o+=e}}})&&o},u.generateLith=function(t,e){var n="object"===c(t[1])?t[1]:void 0,r=t[n?2:1];if("LITERAL"===t[0])return r;var o="<"+t[0];if(s.do(n,function(t,e){(t||0===t)&&(o+=" "+u.entityify(e+"")+'="'+u.entityify(t+"")+'"')}),o+=">","array"===c(r))if(e)o+="style"===t[0]?u.css.g(r):u.g(r,e);else{var i="style"===t[0]?u.css.g(r):u.g(r);if(!1===i)return!1;o+=i}else o+=u.generateLithbag(r,"style"===t[0]||"script"===t[0],e);return-1===u.k.voidTags.indexOf(t[0])&&(o+="</"+t[0]+">"),o},u.css={},u.css.v=function(e){if(o.stop(["litc or litcbag",e,"array"],function(t){i("lith.css.v - Invalid litc or litcbag",{error:t,"original input":e})}))return!1;if(0===e.length||"array"===c(e[0]))return!0;var t="object"===c(e[1])?e[1]:void 0,n=e[t?2:1];return o.v([["litc length",e.length,{min:1,max:3},o.test.range],[void 0===t,["length of litc without attributes",e.length,{max:2},o.test.range]],["litc selector",e[0],"string"],u.css.vAttributes(t),["LITERAL"!==e[0],["litc contents",n,["undefined","array"],"oneOf"]]],function(t){i("lith.css.v - Invalid litc",{error:t,"original input":e})})},u.css.vAttributes=function(t){return o.v([["litc attribute values",t,["string","integer","float","object","undefined","null","boolean"],"eachOf"]])},u.css.g=function(t,r){if(!1===u.css.v(t))return!1;if(0===t.length)return"";var o="";if("LITERAL"===t[0])return t[1];if("array"===c(t[0]))return!1!==s.stop(t,!1,function(t,e){var n=u.css.g(t,r);if(!1===n)return!1;o+=n})&&o;void 0===r&&(r="");var e="object"===c(t[1])?t[1]:void 0,n=t[e?2:1];r=s.do(r.split(/,\s*/),function(e){return s.do(t[0].split(/,\s*/),function(t){return t.match(/&/)?t.replace("&",e):e+(0===e.length?"":" ")+t}).join(", ")}).join(", "),o+=r+"{";var i=function(t){return!1!==u.css.vAttributes(t)&&s.stop(t,!1,function(e,t){if(e||0===e){var n=c(e);if("object"===n)return i(e);"integer"===n&&(e<0||1<e)&&(e+="px"),"float"!==n&&1!==e||(e=100*e+"%"),s.do(t.split(/,\s*/),function(t){o+=t+":"+e+";"})}})};if(!1===i(e))return!1;if(o+="}",n){var a=u.css.g(n,r);if(!1===a)return!1;o+=a}return o},u.css.media=function(t,e){return!o.stop(["selector",t,"string"])&&[["LITERAL","@media "+t+" {"],e,["LITERAL","}"]]}}(),function(){var t="object"==typeof exports,i=t?require("dale"):window.dale,o=t?require("teishi"):window.teishi,s=o.t,u=o.l,e=function(t){if(!o.stop([["store",t,["array","object","undefined"],"oneOf"]])){var a={routes:{}};return a.store=t||{},a.isPath=function(t,e){return o.v(e,[["path",t,["array","integer","string"],"oneOf"],["path",t,["integer","string"],"eachOf"]])},a.do=function(){var t="object"===s(arguments[0])?arguments[0]:void 0,e=arguments[t?1:0],n=arguments[t?2:1];o.simple(n)&&(n=[n]);var r=[t||{},e,n].concat([].slice.call(arguments,t?3:2));return!o.stop("r.do",[[void 0!==t,[function(){return[["x.from",t.from,["array","object","undefined"],"oneOf"],["array"===s(t.from),[function(){return["x.from",t.from,"object","each"]}]]]}]],["verb",e,"string"],a.isPath(n,"r.do")])&&(a.mill.apply(null,r),!0)},a.listen=function(){var t,e=arguments[arguments.length-1];if(arguments.length<2)return u("r.listen","Too few arguments passed to r.listen");if(2===arguments.length?t=arguments[0]:((t=3===arguments.length?{}:arguments[2]).verb=arguments[0],t.path=arguments[1]),o.simple(t.path)&&(t.path=[t.path]),o.stop("r.listen",[["options",t,"object"],["keys of options",i.keys(t),["verb","path","id","parent","priority","burn"],"eachOf",o.test.equal],function(){return[["options.verb",t.verb,"string"],a.isPath(t.path,"r.listen"),["options.id",t.id,["string","integer","undefined"],"oneOf"],["options.parent",t.parent,["string","integer","undefined"],"oneOf"],["options.priority",t.priority,["undefined","integer"],"oneOf"],["options.burn",t.burn,["undefined","boolean"],"oneOf"]]},["route function",e,"function"]]))return!1;if(t.id){if(a.routes[t.id])return u("r.listen","A route with id",t.id,"already exists.")}else t.id=a.random();return t.rfun=e,(a.routes[t.id]=t).id},a.forget=function(n,r){if(!a.routes[n])return u("Route",n,"does not exist.");var t=a.routes[n];delete a.routes[n],r&&"function"===s(r)&&r(t),i.do(a.routes,function(t,e){t.parent===n&&a.forget(e,r)})},a.mill=function(t,e,n){var r;(r=t.from?"object"===s(t.from)?[t.from]:t.from.slice(0):[]).unshift({date:(new Date).toISOString(),verb:e,path:n});var o=[{verb:e,path:n,from:r}].concat([].slice.call(arguments,3));3<arguments.length&&(o[0].args=[].slice.call(arguments,3),r[0].args=[].slice.call(arguments,3));var i=function(t){if(0!==t.length){o[0].cb=function(){i(t)};var e=t.shift();if(o[0].route=e,!a.routes[e.id])return i(t);e.burn&&a.forget(e.id),"function"!==s(e.rfun.apply(null,o))&&i(t)}};i(a.sort(a.match(e,n,a.routes)))},a.match=function(t,r,e){var o=[];return i.do(e,function(n){if(!("*"!==t&&"*"!==n.verb&&n.verb!==t||n.path.length>r.length))return 0===n.path.length?o.push(n):void i.stop(n.path,!1,function(t,e){return(void 0===r[e]||"*"===r[e]||"*"===t||r[e]===t)&&(e===n.path.length-1?(o.push(n),!1):void 0)})}),o},a.sort=function(t){return t.sort(function(t,e){var n=t.priority||0;return(e.priority||0)-n})},a.random=function(){return Math.random().toString(16).slice(2)},a}};t?module.exports=e:window.R=e}(),function(){if("object"==typeof exports)return console.log("cocholate only works in a browser!");var a=window.dale,s=window.teishi,i=s.t,u=window.c=function(t,e){if(s.stop("c",["fun",e,["function","undefined"],"oneOf"]))return!1;var n=u.find(t);if(!1===n)return!1;if(e){var r=s.c(arguments).slice(2);n=a.do(n,function(t){return e.apply(void 0,[t].concat(r))})}return"string"===i(t)&&t.match(/^[a-z]*#[^\s\[>,:]+$/)?n[0]:n};u.nodeListToArray=function(t){return[].slice.call(t)},u.setop=function(t,e,n){if("and"===t)return a.fil(e,void 0,function(t){return-1!==n.indexOf(t)?t:void 0});var r=e.slice();return"or"===t?a.do(n,function(t){-1===r.indexOf(n)&&r.push(t)}):(0===r.length&&(r=u.nodeListToArray(document.getElementsByTagName("*"))),a.do(n,function(t){var e=r.indexOf(t);-1!==e&&r.splice(e,1)})),r},u.find=function(t){var e=i(t);if(s.stop("cocholate",[["selector",t,["array","string","object"],"oneOf"],function(){return[["array"===e,["first element of array selector",t[0],[":and",":or",":not"],"oneOf",s.test.equal]],["object"===e,[["selector keys",a.keys(t),["selector","from"],"eachOf",s.test.equal],["valid HTML node",t.from,"undefined",s.test.notEqual],function(){return[["from.querySelectorAll","valid HTML node"],t.from.querySelectorAll,"function"]}]]]}]))return!1;if("string"===e)return u.nodeListToArray(document.querySelectorAll(t));if("object"===e)return u.nodeListToArray(t.from.querySelectorAll(t.selector));var r=t.shift(),o=[];return a.stop(t,!1,function(t,e){var n=u.find(t);if(!1===n)return o=!1;o=0===e&&":not"!==r?n:u.setop(r.replace(":",""),o,n)}),o},u.empty=function(t){u(t,function(t){a.do(u.nodeListToArray(t.getElementsByTagName("*")),function(t){t.remove()})})},u.fill=function(t,e){if(s.stop("c.fill",["html",e,"string"]))return!1;u.empty(t),u(t,function(t){t.innerHTML=e})},u.place=function(t,e,n){if(s.stop("c.place",[["where",e,["beforeBegin","afterBegin","beforeEnd","afterEnd"],"oneOf",s.test.equal],["html",n,"string"]]))return!1;u(t,function(t){t.insertAdjacentHTML(e,n)})},u.get=function(t,n,r){return!s.stop("c.get",["attributes",n,["string","array"],"oneOf"])&&u(t,function(e){return a.obj(n,function(t){return r?[t,e.style[t]||null]:[t,e.getAttribute(t)]})})},u.set=function(t,e,r,o){if(s.stop("c.set",[["attributes",e,"object"],[["attribute keys","start with an ASCII letter, underscore or colon, and be followed by letters, digits, underscores, colons, periods, dashes, extended ASCII characters, or any non-ASCII characters."],a.keys(e),/^[a-zA-Z_:][a-zA-Z_:0-9.\-\u0080-\uffff]*$/,"each",s.test.match],["attribute values",e,["integer","string","null"],"eachOf"]]))return!1;u(t,function(n){a.do(e,function(t,e){r?n.style[e]=null===t?"":t:null===t?n.removeAttribute(e):n.setAttribute(e,t)}),n.onchange&&!o&&n.onchange()})},u.ready=function(t){if(document.addEventListener)return document.addEventListener("DOMContentLoaded",t);document.attachEvent?document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&t()}):t()},u.cookie=function(t){return!1===t?a.do(document.cookie.split(/;\s*/),function(t){return document.cookie=t.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()),t}):a.obj((t||document.cookie).split(/;\s*/),function(t){if(""!==t)return[(t=t.split("="))[0],t.slice(1).join("=")]})},u.ajax=function(t,e,n,r,o){if(t=t||"GET",r=r||"",n=n||{},o=o||function(){},s.stop("c.ajax",[["method",t,"string"],["path",e,"string"],["headers",n,"object"],["callback",o,"function"]]))return!1;var i=new XMLHttpRequest;return i.open(t.toUpperCase(),e,!0),s.complex(r)&&"formdata"!==s.t(r,!0)&&(n["content-type"]=n["content-type"]||"application/json",r=s.s(r)),a.do(n,function(t,e){i.setRequestHeader(e,t)}),i.onreadystatechange=function(){if(4===i.readyState){if(200!==i.status)return o(i);var e,t={xhr:i,headers:a.obj(i.getAllResponseHeaders().split("\r\n"),function(t){return(t=t.split(/:\s+/))[0].match(/^content-type/i)&&t[1].match("application/json")&&(e=!0),t})};t.body=e?s.p(i.responseText):i.responseText,o(null,t)}},i.send(r),{headers:n,body:r,xhr:i}},u.polyfill=function(){var u=function(){return document.createElement("_")};u().insertAdjacentHTML||(HTMLElement.prototype.insertAdjacentHTML=function(t,e){var n,r,o,i=this,a=u(),s=i.parentNode;if(a.innerHTML=e,"beforeBegin"===t)for(;n=a.firstChild;)s.insertBefore(n,i);else if("afterBegin"===t)for(r=i.firstChild;n=a.lastChild;)i.insertBefore(n,r);else if("beforeEnd"===t)for(;n=a.firstChild;)i.appendChild(n);else for(o=i.nextSibling;n=a.lastChild;)s.insertBefore(n,o)}),Element.prototype.remove||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(n,t){var e=a.stopNot(t?this.slice(t):this,void 0,function(t,e){if(n===t)return e});return void 0===e?-1:e})},u.polyfill()}(),function(){if("object"==typeof exports)return console.log("gotoB only works in a browser!");var m=window.dale,b=window.teishi,c=window.lith,y=(window.R,window.c),w=window.B,j=b.t,O=b.l,l=window.R();(w=window.B={v:"1.2.0",B:"в",r:l,routes:l.routes,store:l.store,do:l.do,listen:l.listen,forget:l.forget}).eventlog=[],w.listen({id:"eventlog",verb:"*",path:[]},function(t){w.eventlog.unshift({verb:t.verb,path:t.path,from:t.from}),1<arguments.length&&(w.eventlog[0].args=[].slice.call(arguments,1)),w.verbose&&O("B.eventlog event #"+w.eventlog.length,w.eventlog[0])}),w.add=function(t){if(!w.prod&&!l.isPath(t,"B.add"))return!1;void 0===w.get(t)&&w.set(t,[]);var n=w.get(t);return"array"!==j(n)?O("B.add","Cannot add to something that is not an array."):(m.do(arguments,function(t,e){0!==e&&n.push(t)}),!0)},w.rem=function(t){if(!w.prod&&!l.isPath(t,"B.rem"))return!1;var e=w.get(t),n=j(e),r="array"===j(arguments[1])?arguments[1]:m.do(arguments,function(t){return t}).slice(1);return!(!w.prod&&b.stop([["target",e,["array","object"],"oneOf"],"array"===n?["keys of array target",r,"integer","each"]:["keys of object target",r,"string","each"]]))&&("array"===n?(r.sort(function(t,e){return e-t}),m.do(r,function(t){e.splice(t,1)})):m.do(r,function(t){delete e[t]}),!0)},w.get=function(n){if(n="array"===j(n)?n:m.do(arguments,function(t){return t}),w.prod||l.isPath(n,"B.get")){var r=w.store;return!1===m.stop(n,!1,function(t,e){if(e+1<n.length&&b.simple(r[t]))return!1;r=r[t]})?void 0:r}},w.set=function(r,o,i){if(!w.prod&&!l.isPath(r,"B.set"))return!1;var a=w.store;return"array"!==j(r)&&(r=[r]),!m.stop(r,!0,function(t,e){if(e+1!==r.length){var n="string"===j(r[e+1])?"object":"array";if(j(a[t])!==n){if(void 0!==a[t]&&!i)return O("B.set didn't overwrite a parent because of type mismatch. Pass a truthy third argument to force this behavior. Path",r),!0;a[t]="object"===n?{}:[]}a=a[t]}else a[t]=o})},m.do(["add","rem","set"],function(t){w.listen({id:t,verb:t,path:[]},function(e,t){if("set"===e.verb)var n=w.get(e.path);if(!0===w[e.verb].apply(null,[e.path].concat([].slice.call(arguments,1)))){if("add"===e.verb||"rem"===e.verb){w.do(e,"change",e.path);var r=[].slice.call(arguments,1);"add"===e.verb&&m.do(m.times(r.length,w.get(e.path).length-r.length),function(t){w.do(e,"change",e.path.concat(t))}),"rem"===e.verb&&("array"===j(r[0])&&(r=r[0]),m.do(r,function(t){w.do(e,"change",e.path.concat(t))}))}"set"!==e.verb||b.eq(n,t)||w.do(e,"change",e.path)}})}),w.str=function(t){var e=j(t);if(b.simple(t))return"string"===e?JSON.stringify(t):t+"";var n="array"===e?"[":"{";return n+="array"===e?m.do(t,w.str).join(", "):m.do(t,function(t,e){return JSON.stringify(e)+": "+w.str(t)}).join(", "),n+="array"===e?"]":"}"},w.ev=function(){var t=1===arguments.length?{}:arguments[0],e=1===arguments.length?arguments[0]:arguments[1];if("array"===j(e)&&"string"===j(e[0])&&(e=[e]),!w.prod&&b.stop("B.ev",[["attrs",t,"object"],["evs",e,"array"],["evs",e,"array","each"],function(){return m.do(e,function(t){return[["ev.ev",t[0],"string"],["ev.verb",t[1],"string"],l.isPath(t[2],"B.ev")]})}]))return!1;var n={},o=b.c(t);return m.do(e,function(e){m.do(e[0].split(/,\s*/),function(t){n[t]?n[t].push(e):n[t]=[e]})}),m.obj(n,t,function(t,e){var r="";return m.do(t,function(t){var n=[JSON.stringify(t[1]),JSON.stringify(t[2])];t.length<4&&(t[3]={rawArgs:"this.value"}),m.do(t.slice(3),function(t){if("object"===j(t)){var e=m.keys(t);-1===e.indexOf("args")&&-1===e.indexOf("rawArgs")?n=n.concat(w.str(t)):(-1!==e.indexOf("args")&&("object"!==j(t.args)&&void 0!==t.args||(t.args=[t.args]),n=n.concat(m.do(t.args,w.str))),-1!==e.indexOf("rawArgs")&&(n=n.concat(t.rawArgs)))}else n=n.concat(w.str(t))}),r+='B.do ({from: {ev: "'+e+'", attrs: '+w.str(o)+"}}, "+n.join(", ")+");"}),[e,r]})},w.view=function(){var t=0,e="object"===j(arguments[t])?arguments[t++]:{},r=arguments[t++],n="object"===j(arguments[t])?arguments[t++]:{},o=arguments[t];if(!w.prod&&b.stop("B.view",[l.isPath(r,"B.view"),["rfun",o,"function"],function(){return[["params.tag",n.tag,[void 0].concat(c.k.tags),"oneOf",b.test.equal],["params.attrs",n.attrs,["object","undefined"],"oneOf"],["params.listen",n.listen,["array","undefined"],"oneOf"],["params.ondraw",n.ondraw,["function","undefined"],"oneOf"],["params.onforget",n.onforget,["function","undefined"],"oneOf"],function(){return[void 0!==n.attrs,["params.attrs.id",(n.attrs||{}).id,"undefined"]]}]}]))return!1;n.attrs=n.attrs||{};var i=n.attrs.id="в"+w.count++;n.attrs["path-в"]=r.join?r.join(":"):r,n.listen&&0!==n.listen.length&&"array"!==j(n.listen[0])&&(n.listen=[n.listen]);var a=[];if(!1===m.stop(n.listen,!1,function(t,e){if(m.stopNot(t,void 0,function(t){if("object"===j(t)&&t.id)return t.id}))return O("B.view","Cannot pass `id` property in args to listener.");var n=w.listen.apply(null,t);if(!w.prod&&!1===n)return O("B.view","There was an error creating event listener #"+(e+1)+" on view with path: ",r),m.do(a,function(t){w.forget(t)}),!1;a.push(n),w.routes[n].parent||(w.routes[n].parent=i)}))return!1;w.listen("change",r,{id:i,priority:-1},function(t){w.resolve(t,i,function(){return t.from.unshift({ev:"redraw",id:i,path:r}),w.drawView(t,w.get(r),o)})});var s=m.obj(e,{verb:"change",path:r},function(t,e){return[e,t]}),u=w.drawView(s,w.get(r),o);return n.ondraw&&(w.routes[i].ondraw=n.ondraw),n.onforget&&(w.routes[i].onforget=n.onforget),w.routes[i].view=u[0],m.do(w.getChildren(u[1]),function(t){w.routes[t].priority--,w.routes[t].parent||(w.routes[t].parent=i)}),[n.tag||"div",n.attrs,["LITERAL",u[1]]]},w.mount=function(e,t){return!w.prod&&"string"!==j(e)||!e.match(/^(body|#[^\s]+)$/)?O("B.mount","target must be either 'body' or an id selector, but instead is "+e):w.prod||void 0!==y(e)?(t=c.g(t,w.prod),w.prod||!1!==t?(y.place(e,"afterBegin",t),void m.do(w.getChildren(t),function(t){w.routes[t]&&w.routes[t].ondraw&&w.routes[t].ondraw({from:[{ev:"mount",target:e}],route:w.routes[t]})})):O("B.mount","received invalid view.")):O("B.mount","target not found.")},w.unmount=function(e){if(!w.prod&&"string"!==j(e)||!e.match(/^(body|#[^\s]+)$/))return O("B.unmount","target must be either 'body' or an id selector, but instead is "+e);var t="body"===e?y(e)[0]:y(e);if(!w.prod&&!t)return O("B.unmount","target not found.");var n=function(t){t.onforget&&t.onforget({from:[{ev:"unmount",target:e}],route:t})},r=w.getChildren(t.innerHTML);m.do(r,function(t){w.routes[t]&&w.forget(t,n)}),m.do(r,function(t){var e=document.getElementById(t);e&&e.remove()})},w.drawView=function(t,e,n){var r=n(t,e),o=c.g(r,w.prod);return w.prod||!1!==o||(r=["pre",["Invalid lith: ",b.simple(r)?r.toString():JSON.stringify(r,null,"   ")]],o=c.g(r,w.prod)),[r,o]},w.getChildren=function(t){var e=(t||"").match(/id="в[0-9a-f]+/g)||[];return m.do(e,function(t){return t.slice(4)})},w.count=1,w.trample=200,w.resolvequeue=[],w.resolving=!1,w.resolve=function(s,u,c,t){if(w.resolving&&!t)return w.resolvequeue.push([s,u,c]);w.resolving=!0;var e=function(){var t,e=m.stopNot(w.resolvequeue,void 0,function(t,e){if(w.routes[t[1]])return e});if(void 0!==e)return t=w.resolvequeue[e],w.resolvequeue.splice(0,e+1),w.resolve.apply(null,t.concat(!0));w.resolving=!1},l=w.routes[u],f=(c=c(),document.getElementById(u)),n=function(t){t.onforget&&t.onforget(s)};if(!f)return O("B.resolve","Attempted to redraw dangling view, omitting redraw & deleting route.",{route:{id:u,path:l.path},view:c[0]}),s.from.unshift({ev:"danglingView"}),w.forget(u,n),e();var d=w.diff(w.prediff(l.view),w.prediff(c[0]));if(m.do(w.routes,function(t){t.parent===u&&t.id.match(/^в[0-9a-f]+$/)&&w.forget(t.id,n)}),!1===d)w.prod||O("diff took too long, trampling instead!",l.id),y("#"+u).innerHTML=c[1];else{var a=function(t,e,n){var r=o(e,"insert1",n);r?r.parentNode.insertBefore(t,r):o(e.slice(0,e.length-1),"insert2",n).appendChild(t)},o=function(r,o,i){var a=f;return m.do(r,function(t,e){if(!a){var n={action:o,position:i,diffitem:d[i].slice(0,2).join(" "),id:u,where:r,k:e,innerHTML:f.innerHTML,expectedHTML:c[1],oldView:l.view,newView:c[0],diff:m.obj(b.c(d),function(t,e){return[e,t]})};throw s.from.unshift({ev:"gotoB error",data:n}),O("BOOM! YOU FOUND A BUG IN gotoB! Please open a pull request at http://github.com/fpereiro/gotoB/issues and paste the text below:\n",JSON.stringify(n)),new Error("gotoB redraw error!")}a=a.childNodes[t]}),a},i=[0],p=[0],g={add:{tag:null,index:null},rem:{tag:null,index:null}};m.do(d,function(t,e){if(!t[1].match(/^<</))if(t[1].match(/^>/)||(d[e][2]={el:o(i,"sequence",e),old:b.c(i),New:b.c(p)}),t[1].match(/^</)){d[e][2].active=d[e][2].el===document.activeElement;var n=t[1].match(/[^\s]+/g)[0],r=t[1].match(/<.+ {.*"opaque":true.*}/);"add"!==t[0]||r||(g.rem.tag===n?(d[e][2].match=g.rem.index,d[g.rem.index][2].match=e,g.rem.tag=g.rem.index=null):(g.add.tag=n,g.add.index=e)),"rem"!==t[0]||r||(g.add.tag===n?(d[e][2].match=g.add.index,d[g.add.index][2].match=e,g.add.tag=g.add.index=null):(g.rem.tag=n,g.rem.index=e)),"add"!==t[0]&&i.push(0),"rem"!==t[0]&&p.push(0)}else t[1].match(/^>/)?("add"!==t[0]&&(i.pop(),i[i.length-1]++),"rem"!==t[0]&&(p.pop(),p[p.length-1]++)):("add"!==t[0]&&i[i.length-1]++,"rem"!==t[0]&&p[p.length-1]++)});var h,v={};m.do(d,function(t,e){if(!t[1].match(/^>/))if(t[1].match(/^<</))"rem"!==t[0]&&(d[e-1][2].el.innerHTML=t[1].slice(1));else{if("keep"===t[0])return t[1].match(/<.+ {.*"opaque":true.*}/)&&(t[2].el.innerHTML=""),a(t[2].el.parentNode.removeChild(t[2].el),t[2].New,e),void(t[2].active&&"a"!==t[1].match(/[^<\s]+/g)[0]&&(h=t[2].el));if(t[1].match(/^</)){if("rem"===t[0]&&(void 0===t[2].match||t[2].match>e)&&(v[t[2].old]=t[2].el.parentNode.removeChild(t[2].el)),"add"===t[0]){var n;if(void 0!==t[2].match){var r=d[t[2].match];v[r[2].old]||(v[r[2].old]=r[2].el);var o=(n=r[2].el).attributes;"moznamedattrmap"===j(o,!0)&&(o=m.obj(o,function(t){if(t)return[t.name,t.value]}));var i=JSON.parse(t[1].match(/{.+/)||"{}");m.do(m.fil(o,void 0,function(t,e){if("string"===j(t)&&(t={name:e}),void 0===i[t.name])return t.name}),function(t){"value"===t&&(n.value=null),"checked"===t&&(n.checked=!1),"selected"===t&&(n.selected=!1),n.removeAttribute(t)}),m.do(i,function(t,e){"value"===e&&(n.value=t),"checked"===e&&(n.checked=t),"selected"===e&&(n.selected=t),n.setAttribute(e,t)}),n.value!==i.value&&(n.value=void 0===i.value?null:i.value)}else n=document.createElement(t[1].match(/[^<\s]+/g)[0]),m.do(JSON.parse(t[1].match(/{.+/)||"{}"),function(t,e){(t||""===t||0===t)&&n.setAttribute(e,t)});a(n,t[2].New,e),t[2].el=n,r&&r[2].active&&"a"!==t[1].match(/[^<\s]+/g)[0]&&(h=n)}}else"add"===t[0]?(t[1]=t[1].replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#96;/g,"`"),a(document.createTextNode(t[1]),t[2].New,e)):t[2].el&&t[2].el.parentNode.removeChild(t[2].el)}})}h&&(h.focus?h.focus():h.setActive(),h.blur(),h.focus?h.focus():h.setActive()),l.view=c[0],m.do(w.getChildren(y("#"+u).innerHTML),function(t){var e=w.routes[t];e.priority+=l.priority,e.parent||(e.parent=l.id),e.ondraw&&e.ondraw(s)}),l.ondraw&&l.ondraw(s),e()},w.prediff=function(t,e){if(b.simple(t))return void 0===t||""===t?e?void 0:[]:e?(0===e.length&&e.push(""),e[e.length-1].match(/^(<|>)/)&&e.push(""),e[e.length-1]+=c.g(t,w.prod)):[c.g(t,w.prod)];if(e=e||[],-1!==c.k.tags.indexOf(t[0])){e.push("<"+t[0]);var n="object"===j(t[1])?t[1]:void 0,r=t[n?2:1];"style"===t[0]&&"array"===j(r)&&(r=c.css.g(r)),n&&(e[e.length-1]+=" "+JSON.stringify(n),n.opaque?e.push("<"+c.g(r,w.prod)):n.id&&n.id.match(/^в[0-9a-f]+$/g)&&(r=w.routes[n.id].view));var o=e.length;if(n&&n.opaque||w.prediff(r,e),"table"===t[0]&&e[o]){if(e[o].match(/<thead/)){var i=0;m.stopNot(m.times(e.length-o,o),void 0,function(t){if(e[t].match(/</)&&i++,e[t].match(/>/)&&i--,0===i)return o=t+1})}e[o]&&null===e[o].match(/<tbody/)&&(e.splice(o,0,"<tbody"),e.push(">"))}e.push(">")}else m.do(t,function(t){w.prediff(t,e)});return e},w.diff=function(e,t){for(var n,r,o,i,a,s,u,c,l,f=[],d=0,p=Date.now();d<e.length+t.length+1;){if(w.trample&&Date.now()-p>w.trample)return!1;for(n=f[f.length-1]||{1:[0,0]},r={},f.push(r),o=-d;o<2*d-d+1;){for(a=(i=o===-d||o!==d&&n[o-1][1]<n[o+1][1]?[0,n[o+1][1]]:[0,n[o-1][1]+1,!0])[1]-o;i[1]<e.length&&a<t.length&&e[i[1]]===t[a];)i[1]++,a++,i[0]++;if(!((r[o]=i)[1]<e.length||a<t.length)){for(s={x:i[1],y:a},u=[],c=d;-1<c;)a=(l=f[c][s.x-s.y])[1]-(s.x-s.y),l[0]&&m.do(m.times(l[0]),function(t){u.unshift(["keep",e[l[1]-t]])}),l[2]?u.unshift(["rem",e[l[1]-l[0]-1]]):u.unshift(["add",t[a-l[0]-1]]),s.x=l[1]-l[0]-(l[2]?1:0),s.y=a-l[0]-(l[2]?0:1),c--;return u.shift(),u}o+=2}d++}}}();